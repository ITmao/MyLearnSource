Horn.Field=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Field",field:null,hidden:null,checkGroup:null,defValue:"",defHiddenValue:"",init:function(g){Horn.Field.superclass.init.apply(this,arguments);if(this.field==undefined){this.hidden=this.el.children("input[type='hidden']");if(this.hidden.length){this.field=this.hidden.next("input[type]")}else{this.field=this.el.children("input[type]");if(this.field.length==0){this.field=this.el.children("textarea")}}}this.name=this.field.attr("name")||this.name;this.checkGroup={};var d=this,c=this.field.attr("group");if(c){var f=c.split(";");$(f).each(function(i,j){d.checkGroup[j]=true})}this.initEvents();this.defHiddenValue="";this.defValue="";if(this.hidden.length>0){this.defHiddenValue=this.params.defValue||this.hidden.val()||""}if(this.field.length>0){this.defValue=this.params.defValue||this.field.val()||""}if(this.params.hidden&&this.params.hidden==true){this.hide()}if(this.params.maxlength){var b=parseInt(this.params.maxlength,10);if(b>0){if(this.field.val()!=undefined&&d.getStrlen(this.field.val())>b){var e=this.field.val().substr(0,b);this.field.val(e);var a=this.field.prev(":hidden");if(a){a.val(e)}this.params.value=e}}}var h=this.getIEVersion();if(h!=-1&&h<10){if(this.params.emptyText&&this.params.emptyText!=""){this.field.val(this.params.emptyText)}}this.field.keyup(function(){var j=$(this);var i=parseInt(d.params.maxlength,10);if(i>0){if(d.getStrlen(j.val())>i){j.val(d.getSubstring(j.val(),i))}}});this.field.focus(function(){var i=d.getIEVersion();if(i!=-1&&i<10){if(d.params.emptyText&&d.params.emptyText!=""){if(d.field.val()==d.params.emptyText){d.field.val("")}}}});this.field.blur(function(){var k=$(this);var i=parseInt(d.params.maxlength,10);var j=$(this).parent("div.typefield");if(i>0){if(j){if($(this).attr("inputType")=="cardNo"){if(d.getStrlen(k.val())>(i+2)){k.val(d.getSubstring(k.val(),i+2))}}else{if(d.getStrlen(k.val())>(i+1)){k.val(d.getSubstring(k.val(),i+1))}}}else{if(d.getStrlen(k.val())>i){k.val(d.getSubstring(k.val(),i))}}}var l=d.getIEVersion();if(l!=-1&&l<10){if(d.params.emptyText&&d.params.emptyText!=""){if(k.val()==""){d.field.val(d.params.emptyText)}}}})},getStrlen:function(e){var b=Horn.Field.DEFAULT_CH_NUM;var a=0;for(var d=0;d<e.length;d++){var f=e.charCodeAt(d);if((f>=1&&f<=126)||(65376<=f&&f<=65439)){a++}else{a+=b}}return a},getSubstring:function(g,f){var e="";var b=Horn.Field.DEFAULT_CH_NUM;var a=0;for(var d=0;d<g.length;d++){var h=g.charCodeAt(d);if((h>=1&&h<=126)||(65376<=h&&h<=65439)){a++}else{a+=b}if(a<=f){e=e+g[d]}}return e},getIEVersion:function(){var c=-1;if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}else{if(navigator.appName=="Netscape"){var a=navigator.userAgent;var b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}}return c},getEventTarget:function(){this.hidden=this.el.children("input[type='hidden']");if(this.hidden.length){this.field=this.hidden.next("input[type]")}else{this.field=this.el.children("input[type]");if(this.field.length==0){this.field=this.el.children("textarea")}}return this.field},checkRegx:null,initEvents:function(){var a=this;a.checkRegx=[];var b=this.field.attr("checkstr");if(b){a.checkRegx=b.split(";")}this.field.blur(function(){a.validate();var d=a.field.val();if(d!=null&&d!=""){d=d+"";d=d.replace(/(^\s*)|(\s*$)/g,"")}if(a.COMPONENT_CLASS=="Field"||a.COMPONENT_CLASS=="Password"){a.field.val(d)}var c=a.el.attr("class");if(c!="hc_password"&&c!="hc_passwordgroup"){a.field.attr("title",d)}})},validate:function(){var a=this;var b=a.getIEVersion();if(b!=-1&&b<10){if(a.params.emptyText&&a.params.emptyText!=""&&a.field.val()==a.params.emptyText){a.field.val("")}}if(!this.skipValid){Horn.Validate.onValid({data:[Horn.Validate,a]})}},addGroup:function(a){this.checkGroup[a]=true},removeGroup:function(a){this.checkGroup[a]=false},inGroup:function(a){return !!this.checkGroup[a]},get:function(){if(this.hidden&&this.hidden.length){return this.hidden}return this.field},addRule:function(f){var c=this.get();var b=c.attr(Horn.Validate.CHECK);if(b){if(b.indexOf(f)>-1){return}b+=Horn.Validate.CHECKSEP+f}else{b=f}c.attr(Horn.Validate.CHECK,b);if(f&&f.indexOf(Horn.Validate.REQUIRED)>-1){var a=this.el.parent().parent(".g-unit-wrap");var d=a.children("label");var e=$("span.m-verify-symbol",d);if(!e.length){e=$("<span>",{"class":"m-verify-symbol",html:"*"});d.prepend(e)}else{e.html("*")}}this.removeError();this.field.removeClass("m-verify-success")},removeRule:function(d){var b=this.get();var a=b.attr(Horn.Validate.CHECK);if(a&&a.indexOf(d)>-1){var c=a.split(Horn.Validate.CHECKSEP);c=$.grep(c,function(f,e){return f&&f!=d});b.attr(Horn.Validate.CHECK,c.join(";"));this.removeError();this.setNotRequired()}},skipValid:false,show:function(){this.skipValid=false;var a=this.el.parent().parent(".g-unit-wrap");if(this.el.attr("type")=="hidden"){return}if(a.css("display")=="none"){a.css("display","block")}if(a.css("visibility")=="hidden"){a.css("visibility","visible")}},hide:function(b){this.skipValid=true;b=b||"display";var a=this.el.parent().parent(".g-unit-wrap");if(b=="display"){a.css("display","none")}else{a.css("visibility","hidden")}if(this.err){this.removeError()}},setLabel:function(b){var a=this.el.parent().parent();var c=$("label",a);var d=$("span.m-verify-symbol",c);c.attr("title",b);if(!d.length){c.html(b)}else{c.html('<span class="m-verify-symbol">*</span>'+b)}},getLabel:function(){var a=this.el.parent().parent();var b=$("label",a);return b.attr("title")},setRequired:function(a){if(a===false){this.setNotRequired();return}this.addRule(Horn.Validate.REQUIRED)},setNotRequired:function(){var a=this.el.parent().parent(".g-unit-wrap");var b=$("label",a);var c=$("span.m-verify-symbol",b);this.removeRule(Horn.Validate.REQUIRED);this.field.removeClass("m-verify-error");c.html("")},setEnable:function(b){var a=this.field;var c=this.hidden;var d=a.next("input[type='text']");if(b){a.removeAttr("disabled");d.removeAttr("disabled");if(c){c.removeAttr("disabled")}}else{a.attr("disabled","disabled");d.attr("disabled","disabled");if(c){c.attr("disabled","disabled")}}},setDisabled:function(a){if(a===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(a){if(a===false){this.field.removeAttr("readonly");this.readonly=false}else{this.field.attr("readonly","readonly");this.readonly=true}},setValue:function(a){if(a!=null&&a!=""){a=a+"";a=a.replace(/(^\s*)|(\s*$)/g,"")}this.field.val(a);this.hidden.val(a);this.validate()},getValue:function(){var a=this.get();var b=a.val();if(b!=null&&b!=""){b=b+"";b=b.replace(/(^\s*)|(\s*$)/g,"")}return b},reset:function(a){var b="";if(this.hidden&&this.hidden.length>0){b=a?"":this.defHiddenValue}else{b=a?"":this.defValue}this.setValue(b)},clearValue:function(){if(this.cal1){var b=this.name1;var a=this.name2;this.setValue({name1:null,name2:null})}else{this.setValue("")}},bind:function(c,d,b){var a=this.get();if($.type(d)=="function"){a.bind(c,d)}else{a.bind(c,d,b)}},isValid:function(){return !this.err},err:false,msgDiv:null,showError:function(a){var b=this.field;b.removeClass("m-verify-success");b.addClass("m-verify-error");a=$.type(a)=="boolean"?"校验错误":a;if(!this.msgDiv){this.msgDiv=$('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">'+a+"</div>");c.css("display","block");this.err=true},removeError:function(){this.field.removeClass("m-verify-error");var b=this.get();var a=b.attr(Horn.Validate.CHECK);if(a){if(this.isValid){this.field.addClass("m-verify-success")}}this.err=false;var c=this.msgDiv;if(c){c.remove()}delete this.msgDiv},mutiName:function(){return false}});$.extend(Horn.Field,{get:function(a,b){if(jQuery.type(a)!="string"){var c=$(a);a=c.attr("name");b=c.attr("alias");if(!a){var d=c.prev("input[type='hidden'][name]");a=d.attr("name");b=d.attr("alias")}}var e=Horn.getComp(a,b);return e},addRule:function(a,d,b){var c=this.get(a,b);c.addRule(d)},removeRule:function(a,d,b){var c=this.get(a,b);c.removeRule(d)},show:function(a,b){var c=this.get(a,b);c.show()},hide:function(a,b){var c=this.get(a,b);c.hide("display")},hidden:function(a,b){var c=this.get(a,b);c.hide("visibility")},setRequired:function(a,b){var c=this.get(a,b);c.setRequired()},setNotRequired:function(a,b){var c=this.get(a,b);c.setNotRequired()},setEnable:function(b,a,c){var d=this.get(b,c);d.setEnable(a)},setReadonly:function(a,d,b){var c=this.get(a,b);c.setReadonly(d)},setLabel:function(b,a,c){var d=this.get(b,c);d.setLabel(a)},getLabel:function(a,b){var c=this.get(a,b);return c.getLabel()},setValue:function(a,c,b){var d=this.get(a,b);if(d){d.setValue(c)}else{this.getField(a,b).val(c)}},getValue:function(a,b,c){var d=this.get(a,b);if(d){return d.getValue()}else{return this.getField(a,b,c).val()}},reset:function(a,b){var c=this.get(a,b);if(c){c.reset()}else{this.getField(a,b).each(function(){this.reset()})}},clearValue:function(a,b){var c=this.get(a,b);if(c){c.clearValue()}else{this.getField(a,b).val("")}},bind:function(a,b,d,e,c){var f=this.get(a,b);f.bind(d,e,c)},getSelector:function(b,c){var a="";if(b){a+="[name='"+b+"']"}if(c){a+="[alias='"+c+"']"}return"input"+a+",textarea"+a},getField:function(b,c,d){var f=Horn.getCurrent();c=c||"";var e=null;if(!d){d=f.find("form");if(jQuery.type(b)=="string"){var a=Horn.Field.getSelector(b,c);e=$(a,d)||$(a);if(!c){e=e.not(":disabled")}}else{e=$(b,d)}return e}else{return d.findField(b,c)}},findFieldCompsIn:function(b){var a=[];this.findFieldsIn(b).each(function(c,d){var e=Horn.getCompByEl($(d));if(e){a.push(e)}});return $(a)},findFieldsIn:function(a){return $(a).find(this.TYPES.join(","))},findInputComp:function(a){return $(a).parents(this.TYPES.join(",")).first().comp()},TYPES:[],regFieldType:function(a,b){Horn.regUI(a,b);this.TYPES.push(a)}});Horn.apply(Horn.Field,{DEFAULT_CH_NUM:2});Horn.Field.regFieldType("div.hc_textfield._text",Horn.Field);Horn.Field.regFieldType("div.hc_textarea",Horn.Field);