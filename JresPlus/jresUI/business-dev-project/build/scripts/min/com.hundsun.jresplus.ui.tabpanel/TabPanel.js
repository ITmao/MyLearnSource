var isFirstClick=true;var firstTab=null;(function(H){Horn.TabPanel=Horn.extend(Horn.Base,{maxTabCn:30,tabWidth:121,minTabHeight:undefined,init:function(){Horn.TabPanel.superclass.init.apply(this,arguments);var _this=this;this.maxTabCn=this.params.maxTabCn?this.params.maxTabCn:this.maxTabCn;var tabWidth=(this.params.width||this.tabWidth||"")+"";this.tabWidth=tabWidth.match(/[px|%]+$/)?tabWidth:tabWidth+"px";this.isFormValidate=this.params.isFormValidate==="false"?false:!!this.params.isFormValidate;var tabPanel=this.el;this.tabsDiv=tabPanel.children("div.h_tabpanel-tabs");this.contentsDiv=tabPanel.children("div.h_tabpanel-contents");this.tabWrap=this.tabsDiv.children("div.h_tabpanel-wrap");this.tabWrapUl=this.tabWrap.children("ul");this.leftScroller=this.tabsDiv.children(".h_tabscroller-left");this.rightScroller=this.tabsDiv.children(".h_tabscroller-right");this.topScroller=this.tabsDiv.children(".h_tabscroller-top");this.bottomScroller=this.tabsDiv.children(".h_tabscroller-bottom");var tempTabsUl=tabPanel.children("ul");if(tempTabsUl.size()>this.maxTabCn){tempTabsUl.splice(this.maxTabCn);Horn.Msg.alert("提示","最多只能添加"+this.maxTabCn+"个页签！")}if(this.params.height&&this.params.height!=""){this.contentsDiv.css("height",this.params.height);this.contentsDiv.css("overflow","auto")}if(this.params.width&&this.params.width!=""){this.topScroller.css("width",this.params.width);this.bottomScroller.css("width",this.params.width)}tempTabsUl.children("li[ref]").appendTo(this.tabWrapUl).each(function(i,o){var tab=$(o);var ref=tab.attr("ref");var content=$("[ref_target="+ref+"]",tabPanel);var contentId=content.attr("id");if(!contentId){contentId=Horn.id("tab-panel-content-");content.attr("id",contentId)}_this.contentsDiv.get(0).appendChild(content.get(0));tab.bind("click",function(){if(!isFirstClick){if($(this).data("content")!=firstTab.data("content")){_this.activate(firstTab)}}_this.activate($(this))}).data({content:content}).css("width",_this.tabWidth);if(_this.tabWidth){var icon=tab.children(".h_tab-icon");var title=tab.children(".h_tab-title");title.css({width:parseInt(_this.tabWidth)-icon.outerWidth()})}});tempTabsUl.remove();this.tabChange=function(){};if(this.params.tabChange){var tabChangeObj=Horn.Util.getFunObj(this.params.tabChange);if($.type(tabChangeObj.fn)=="function"){this.tabChange=tabChangeObj.fn}}initScrollerEvents.call(this);initTabPosition.call(this,this.params.position);firstTab=this.tabWrapUl.children("li:eq(0)");calculateScrollLength.call(this);firstTab.addClass("h_cur").click();isFirstClick=false;firstTab.data("content").show();$(window).bind("resizes",function(){locateScroller.call(_this.tabWrap);moveToCenter.call(_this,_this.getCurrentTab())});locateScroller.call(this.tabWrap)},getCurrentTab:function(){if(!this.currentTabName){var _this=this;this.tabWrapUl.children("li").each(function(i,o){var curTab=$(this).attr("class");if(curTab.indexOf("h_cur")>-1){_this.currentTabName=$(this).attr("ref")}})}return this.getTab(this.currentTabName)},getTab:function(o){if($.type(o)!="object"){return this.tabWrapUl.children("li[ref='"+o+"']")}return o&&o.length?o:$(o)},addTab:function(params){if(!params.url){Horn.Msg.alert("提示","页签url必填，请检查！");return}var _this=this;var maxTabCn=params.maxTabCn?params.maxTabCn:this.maxTabCn;var tabWidth=params.width?params.width:this.tabWidth||"auto";if(params.name&&this.getTab(params.name).length){this.activate(params.name);return}if(this.tabWrapUl.children("li").length>=maxTabCn){Horn.Msg.alert("提示","最多只能添加"+maxTabCn+"个页签");return}var tabPanel=this.el;var tabWrapUl=this.tabWrapUl;var ref=params.name||("h_tab-uldiv-"+new Date().getTime());var refID=Horn.id("tab-uldiv-");if(!params.title){params.title="未命名页签"}var newTab=createTab(ref,params.title,tabWidth).appendTo(tabWrapUl);var newContent=createContent(ref,refID).appendTo(this.contentsDiv);newTab.data("content",newContent).click(function(){_this.activate($(this))});if(this.tabWidth){var icon=newTab.children(".h_tab-icon");var title=newTab.children(".h_tab-title");title.css({width:parseInt(_this.tabWidth)-icon.outerWidth()})}this.position=this.params.position||"top";this.isVertical=this.position=="left"||this.position=="right";this.tabWrap.data("isVertical",this.isVertical);var tabWrapUl=this.tabWrapUl;if(this.isVertical){var liWidth=tabWrapUl.children("li:eq(0)").width();this.contentsDiv.css("margin-"+this.position,this.tabsDiv.outerWidth())}newContent.attr("lazyload",params.url||"");whenTabEdit.call(this);this.activate(ref);return ref},removeTab:function(name){var tab=this.getTab(name);if(!tab||!tab.length){return}if(isActive(tab)){var closestTab=getClosest(tab);if(!closestTab||!closestTab.length){Horn.Msg.alert("提示","至少要有一个页签");return}this.activate(closestTab)}tab.data("content").remove();tab.remove();whenTabEdit.call(this)},closeTab:function(name){this.removeTab(name)},renderTab:function(content,bp){content.children().remove();if((bp.html&&bp.html.length>3)||(bp.jsCode&&bp.jsCode.length>3)){BigPipe.onArrive(bp);Horn.setCurrent(content);BigPipe.start();Horn.init()}content.data("loaded",true)},activate:function(name){var tab=this.getTab(name);if(tab&&tab.length&&tab.is(":visible")){selectTab.call(this,tab)}},locate:function(o){this.activate(o)},enable:function(name){var tab=this.getTab(name).show();whenTabEdit.call(this);this.activate(tab)},disable:function(name){var tab=this.getTab(name);if(!tab||!tab.length){return}if(isActive(tab)){var closestTab=getClosest(tab);if(!closestTab||!closestTab.length){Horn.Msg.alert("提示","至少要有一个页签");return}this.activate(closestTab)}tab.hide().data("content").hide();whenTabEdit.call(this)},doLayout:function(){}});function selectTab(tab){if(!tab||!tab.length){return false}var ref=tab.attr("ref");var currentTab=this.getCurrentTab();if(currentTab&&currentTab.length){if(currentTab.attr("ref")!=ref){var currentContent=currentTab.data("content");if(!whenTabChange.call(this,currentTab,currentContent)){return}currentTab.removeClass("h_cur");currentContent.hide();this.tabChange(currentTab,tab)}else{}}this.currentTabName=ref;tab.addClass("h_cur");var content=tab.data("content").show();var url=content.attr("lazyload");if(url&&!content.data("loaded")){var contentId=content.attr("id");url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+contentId;var _this=this;requestPage.call(this,{id:contentId,url:url,content:content,success:function(){moveToCenter.call(_this,tab)}})}else{moveToCenter.call(this,tab)}}function moveToCenter(tab,noDelay){var tabWrap=this.tabWrap;tabWrap.stop(false,true);scroll.call(this,calculateActualScroll.call(this,tab,tabWrap),noDelay)}function isCoverByScroller(tab){var tabOffset=tab.offset();var d=8;if(this.isVertical){var topScroller=this.topScroller;var bottomScroller=this.bottomScroller;var tabHeight=tab.outerHeight();var coverByTopScroller=topScroller.is(":visible")&&tabOffset.top<=topScroller.offset().top+topScroller.outerHeight()+d;var coverByBottomScroller=bottomScroller.is(":visible")&&tabOffset.top+tabHeight+d>=bottomScroller.offset().top;return coverByTopScroller||coverByBottomScroller}else{var leftScroller=this.leftScroller;var rightScroller=this.rightScroller;var tabWidth=tab.outerWidth();var coverByLeftScroller=leftScroller.is(":visible")&&tabOffset.left<=leftScroller.offset().left+leftScroller.outerWidth()+d;var coverByRightScroller=rightScroller.is(":visible")&&tabOffset.left+tabWidth+d>=rightScroller.offset().left;return coverByLeftScroller||coverByRightScroller}}function calculateActualScroll(tab,tabWrap){var actualScroll=0;var scrollLength=tabWrap.data("scrollLength");if(isCoverByScroller.call(this,tab)){if(this.isVertical){var tabHeight=tab.outerHeight();var wrapHeight=tabWrap.outerHeight();var p1=tab.position().top;var p2=(wrapHeight-tabHeight)/2;var scrollTop=this.tabWrap.scrollTop()+p1-p2;actualScroll=scrollTop+wrapHeight>scrollLength?(scrollLength-wrapHeight):scrollTop}else{var tabWidth=tab.outerWidth();var wrapWidth=tabWrap.outerWidth();var p1=tab.position().left;var p2=(wrapWidth-tabWidth)/2;var scrollLeft=this.tabWrap.scrollLeft()+p1-p2;actualScroll=scrollLeft+wrapWidth>scrollLength?(scrollLength-wrapWidth):scrollLeft}}else{actualScroll=this.isVertical?tabWrap.scrollTop():tabWrap.scrollLeft()}return actualScroll}function scroll(distance,noDelay){if(this.isVertical){scrollTop.call(this.tabWrap,distance,noDelay)}else{scrollLeft.call(this.tabWrap,distance,noDelay)}}function scrollLeft(distance,noDelay){var wrapWidth=this.outerWidth();var scrollLength=this.data("scrollLength");distance=distance!=undefined?distance:this.scrollLeft();distance=distance+wrapWidth>scrollLength?(scrollLength-wrapWidth):distance;this.animate({scrollLeft:distance},noDelay?0:250,function(){locateScroller.call($(this))})}function scrollTop(distance,noDelay){var scrollLength=this.data("scrollLength");var wrapHeight=this.outerHeight();distance=distance!=undefined?distance:this.scrollTop();distance=distance+wrapHeight>scrollLength?(scrollLength-wrapHeight):distance;this.animate({scrollTop:distance},noDelay?0:250,function(){locateScroller.call($(this))})}function locateScroller(){if(this.data("isVertical")){var topScroller=this.siblings(".h_tabscroller-top");var bottomScroller=this.siblings(".h_tabscroller-bottom");var scrollTop=this.scrollTop();if(scrollTop==0){topScroller.hide()}else{topScroller.show()}if((scrollTop+this.outerHeight())<this.data("scrollLength")){bottomScroller.css("top",135);bottomScroller.show()}else{bottomScroller.hide()}}else{var leftScroller=this.siblings(".h_tabscroller-left");var rightScroller=this.siblings(".h_tabscroller-right");var scrollLeft=this.scrollLeft();if(scrollLeft==0){leftScroller.hide()}else{leftScroller.show()}if((scrollLeft+this.outerWidth())<this.data("scrollLength")){rightScroller.show()}else{rightScroller.hide()}}}function calculateScrollLength(){var v=this.isVertical;var tabWrap=this.tabWrap;var tabWrapUl=tabWrap.children("ul");var tabsTotalLength=0;tabWrapUl.children("li:visible").each(function(i,o){var $this=$(this);var margin,size;if(v){margin=parseInt($this.css("margin-top"))+parseInt($this.css("margin-bottom"));size=$this.outerHeight()}else{margin=parseInt($this.css("margin-left"))+parseInt($this.css("margin-right"));size=$this.outerWidth()}tabsTotalLength+=size+margin});tabsTotalLength+=(v?20:40);tabWrap.data("scrollLength",tabsTotalLength);return tabsTotalLength}function initScrollerEvents(){var tabWrap=this.tabWrap;this.leftScroller.click(function(){scrollLeft.call(tabWrap,tabWrap.scrollLeft()-150)});this.rightScroller.click(function(){scrollLeft.call(tabWrap,tabWrap.scrollLeft()+150)});this.topScroller.click(function(){scrollTop.call(tabWrap,tabWrap.scrollTop()-104)});this.bottomScroller.click(function(){scrollTop.call(tabWrap,tabWrap.scrollTop()+104)})}function isActive(tab){return tab.hasClass("h_cur")}function getClosest(jq){if(!jq||!jq.length){return undefined}var closest=jq.nextAll(":visible:first");return closest.length?closest:jq.prevAll(":visible:first")}function requestPage(params){var _this=this;$.ajax(params.url,{type:"get",error:function(xhr,textStatus,errorThrown){_this.renderTab(params.content,{html:"",id:params.id||"",css:[],js:[],jsCode:""});if(params.callback){params.callback()}},success:function(reqData,textStatus,jqXHR){_this.renderTab(params.content,eval("("+reqData+")"));if(params.success){params.success()}if(params.callback){params.callback()}}})}function whenTabChange(tab,content){if(!this.isFormValidate){return true}if(!Horn.Validate.isFormValidate(content)){var title=tab.attr("title");if(title!="该页签下有未验证通过的内容"){tab.attr("title","该页签下有未验证通过的内容").append('<span class="h_tabli-error"></span>')}tab.data("content").show();return false}tab.attr("title",tab.attr("tipMsg")).find("span.h_tabli-error").remove();return true}function whenTabEdit(){calculateScrollLength.call(this);scroll.call(this)}function createTab(ref,title,width){var tab=[];tab.push('<li ref="'+ref+'" title="'+title+'" tipMsg="'+title+'"');tab.push(' class="h_tabpanel-wrap-li" style="width:'+width+'"><a href="javascript:void(0)">');tab.push('<span class="h_tab-arrow"></span>');tab.push('<span class="h_tab-icon"></span>');tab.push('<span class="h_tab-title">'+title+"</span>");tab.push("</a></li>");return $(tab.join(""))}function createContent(ref,refID){return $('<div style="display: block" class="h_tabpanel-content" ref_target="'+ref+'" id="'+refID+'"></div>')}function initTabPosition(p){this.position=p||this.params.position||"top";this.isVertical=this.position=="left"||this.position=="right";this.tabWrap.data("isVertical",this.isVertical);var _this=this;var tabWrapUl=this.tabWrapUl;if(this.isVertical){var liWidth=tabWrapUl.children("li:eq(0)").width();tabWrapUl.children("li").width(liWidth);tabWrapUl.width("auto").width(tabWrapUl.width()-1);this.contentsDiv.css("margin-"+this.position,this.tabsDiv.outerWidth())}var height=(this.params.height||"")+"";if(height){height=height.match(/[px|%]+$/)?height:height+"px";if(this.isVertical){tabWrapUl.height(5000);this.tabWrap.height(parseInt(height)+2)}this.tabWrap.unbind().mousewheel(function(event,delta){event.preventDefault();var $this=$(this);var scrollOffset=_this.isVertical?$this.scrollTop():$this.scrollLeft();if(delta>0){scroll.call(_this,scrollOffset-80,true)}else{scroll.call(_this,scrollOffset+80,true)}})}else{if(this.params.tabFloat){this.tabsDiv.floatTop()}}}$.extend(Horn.TabPanel,{DATANAME:"h_tabpanel",get:function(name){var arr=Horn.data(Horn.TabPanel.DATANAME);var tabPanel=arr[0];return tabPanel},locate:function(obj){Horn.TabPanel.get().locate(obj)},activate:function(obj){Horn.TabPanel.get().activate(obj)},enable:function(obj){Horn.TabPanel.get().enable(obj)},disable:function(obj){Horn.TabPanel.get().disable(obj)}});Horn.regUI("div.h_tabpanel",Horn.TabPanel)})(Horn);(function(d){d.extend(d.fn,{floatLeft:function(){return this._float("left")},floatTop:function(){return this._float("top")},floatRight:function(){return this._float("right")},floatBottom:function(){return this._float("bottom")},floatCenter:function(){return this.floatLeft().floatTop().floatRight().floatBottom()},_float:function(l){return this.each(function(){b.call(d(this),null,l)})},cancelFloat:function(){return k.call(this)}});function a(m){var n=document,l=n.compatMode=="BackCompat"?n.body:n.documentElement;if(m=="width"){return l.clientWidth}else{if(m=="height"){return l.clientHeight}}return undefined}function b(n,m){n=n||d(window);var l=this;n.scroll(d.data(this[0],"scrollOnFloat",function(){if(!l.data("hasFloat")){f.call(l)}var p=d(this);var q=l.data(),u=q.offset;var s=p.scrollTop(),t=p.scrollLeft();var o,r=undefined;switch(m){case"left":o=t-u.left;r="right";break;case"top":o=s-u.top;r="bottom";break;case"right":o=u.left+l.outerWidth()-t-a("width");r="left";break;case"bottom":o=u.top+l.outerHeight()-s-a("height");r="top";break;default:o=t-u.left;r="right"}if(q.fixed[r]){return}if(o>0){g.call(l,m,{left:t,top:s},r)}else{e.call(l,m)}}))}function k(m){var l=this;m=m||["top","left","bottom","right"];d.each(m,function(o,n){e.call(l,n)});d(window).unbind("resize",this.data("resizeOnFloat")).unbind("scroll",this.data("scrollOnFloat"))}function f(){this.data({hasFloat:true,isAbsolute:this.css("position")=="absolute",page:undefined,fixed:{},style:this.attr("style"),offset:this.offset()});var l=this;d(window).resize(d.data(this[0],"resizeOnFloat",function(){if(l.css("position")=="fixed"){var o=l.next(),n=o.offset(),m=l.data("fixed");if(!m.left&&!m.right){l.css("left",n.left)}else{if(!m.top&&!m.bottom){l.css("top",n.top)}}l.css({width:o.width()}).data({offset:o.offset()})}else{l.data({offset:l.offset()})}}))}function g(m,l,q){var p=this.data(),r=p.offset;var o=c(this,m);if(o){this.css(o,0)}else{if(!p.fixed[m]){var n=this.outerWidth();if(!p.isAbsolute){this.clone().css("visibility","hidden").insertAfter(this)}this.css({position:"fixed",marginLeft:"auto",marginTop:"auto",width:n,zIndex:99999})}this.css({left:r.left-l.left,top:r.top-l.top})}p.fixed[m]=true;this.css(m,0);if(q){this.css(q,"auto")}}function e(l){var m=this.data();if(m.fixed&&m.fixed[l]){m.fixed[l]=false;if(c(this,l)==undefined){if(!m.isAbsolute){this.next().remove()}this.removeAttr("style").attr("style",m.style)}}}function c(m,l){var n=undefined;var q=m.data("fixed");for(var o in q){if(l!=o&&q[o]){n=o;break}}return n}function i(l){l+="";l=l?l:"0px";l=l.replace(/^\s+|\s+$/g,"");return l.match(/[px|%|auto]+$/)?l:l+"px"}function j(l){return l?Horn.paramCaches[l.attr("paramcacheid")]||{}:{}}function h(m,l){if(m.currentStyle){return m.currentStyle[l]}else{return getComputedStyle(m,false)[l]}}})(jQuery);(function(n,p,u){var w=n([]),s=n.resizes=n.extend(n.resizes,{}),o,l="setTimeout",m="resizes",t=m+"-special-event",v="delay",r="throttleWindow";s[v]=250;s[r]=true;n.event.special[m]={setup:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.add(a);n.data(this,t,{w:a.width(),h:a.height()});if(w.length===1){q()}},teardown:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.not(a);a.removeData(t);if(!w.length){clearTimeout(o)}},add:function(b){if(!s[r]&&this[l]){return false}var c;function a(d,h,g){var f=n(this),e=n.data(this,t);e.w=h!==u?h:f.width();e.h=g!==u?g:f.height();c.apply(this,arguments)}if(n.isFunction(b)){c=b;return a}else{c=b.handler;b.handler=a}}};function q(){o=p[l](function(){w.each(function(){var d=n(this),a=d.width(),b=d.height(),c=n.data(this,t);if(a!==c.w||b!==c.h){d.trigger(m,[c.w=a,c.h=b])}});q()},s[v])}})(jQuery,this);