(function(a,b){a.CheckboxGroup=a.extend(Horn.Field,{COMPONENT_CLASS:"CheckboxGroup",checkboxs:null,init:function(){Horn.CheckboxGroup.superclass.init.apply(this,arguments);var f=this;this.name=this.el.attr("name");this.alias=this.el.attr("alias")||"";var e=this.el.children("div").children("label").find("input:checkbox");if(e.length>0){var c=e.first().attr("group");if(c){var d=c.split(";");b(d).each(function(g,h){f.checkGroup[h]=true})}}this.checkboxs={};this.el.children("div").children("label").find("input:checkbox").each(function(g,h){var i=b(h);var j=i.val();f.checkboxs[j]=i}).click(function(){if(b(this).prop("checked")){b(this).attr("checked",true)}else{b(this).attr("checked",false)}var g=b(this).attr(Horn.Validate.CHECK);if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var h=f.el.children("div").children("label").find("input:checkbox[checked]");if(h&&h.size()>0){f.removeError()}else{f.showError()}}});if(this.params.value){this.setValue(this.params.value)}if(this.params.readonly){this.setReadonly(true)}if(this.params.disabled){this.setDisabled(true)}this.defValue=this.params.defValue||this.params.value||""},getEventTarget:function(){return this.el.children("div").children("label").find("input:checkbox")},setValue:function(e){var d=this;if(!b.isArray(e)){e=e.toString().split(",")}for(var c in d.checkboxs){d.checkboxs[c].prop("checked",false)}b(e).each(function(f,g){var h=d.checkboxs[g];if(h){h.prop("checked",true)}});this.validate()},getValue:function(){var c="";this.el.children("div").children("label").find("input:checkbox").each(function(d,g){var f=b(g).attr("value");var e=b(g).prop("checked");if(e){if(d!=0){c+=","}c+=f}});return c},reset:function(){this.setValue(this.defValue)},clearValue:function(){this.setValue("")},setEnable:function(c){var d=this;this.el.children("div").children("label").find("input:checkbox").each(function(e,f){if(c===false){b(f).attr("disabled","disabled")}else{b(f).removeAttr("disabled")}})},setDisabled:function(c){if(c===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(c){var d=this;this.el.children("div").children("label").find("input:checkbox").each(function(e,f){if(c===false){d.readonly=false;b(f).removeAttr("onclick");b(f).bind("click",function(){setTimeout(function(){var g=b(f).attr(Horn.Validate.CHECK);if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var h=d.el.children("div").children("label").find("input:checkbox[checked]");if(h&&h.size()>0){d.removeError()}else{d.showError()}}},10)})}else{d.readonly=true;if(d.el.children("div").children("label").find("input:checkbox[checked]").length==0){b(f).unbind("click")}b(f).get(0).onclick=function(){return false}}})},validate:function(){if(!this.skipValid&&this.checkRegx&&this.checkRegx.length>0){var d=this;if(d.disabled===true){d.err=false;return}var c=this.el.children("div").children("label").find("input:checkbox[checked]");if(c&&c.size()<1){Horn.Validate.addError(d,Horn.Validate.regexEnum.requiredMessage)}else{Horn.Validate.removeError(d)}}},showError:function(){var d=this;if(!this.msgDiv){this.msgDiv=b('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">当前复选框不能为空</div>');c.css("display","block");d.el.addClass("m-verify-error");d.el.removeClass("m-verify-success");d.err=true},removeError:function(){var e=this;e.el.removeClass("m-verify-error");e.el.addClass("m-verify-success");e.err=false;var d=this.msgDiv;if(d){d.remove()}var c=this.el.parent().parent(".g-unit-wrap").children(".unit-label");delete this.msgDiv},addRule:function(g){if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var h=this;var d=h.el.children("div").children("label").find("input:checkbox[check*=required]");if(d&&d.size()>0){return}else{h.err=true;this.checkRegx=g.split(";");var c=h.el.children("div").children("label").find("input:checkbox");c.each(function(i,k){var j=b(k).attr(Horn.Validate.CHECK);if(j){if(j.indexOf(g)>-1){return}j+=Horn.Validate.CHECKSEP+g}else{j=g}b(k).attr(Horn.Validate.CHECK,j)});if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var e=this.el.parent().parent(".g-unit-wrap").children(".unit-label");var f=b("span.m-verify-symbol",e);if(!f.length){f=b("<span>",{"class":"m-verify-symbol",html:"*"});e.prepend(f)}else{f.html("*")}}}}else{return}},removeRule:function(f){var h=this;var c=h.el.children("div").children("label").find("input:checkbox");c.each(function(i,l){var j=b(l).attr(Horn.Validate.CHECK);if(j&&j.indexOf(f)>-1){var k=j.split(Horn.Validate.CHECKSEP);k=b.grep(k,function(n,m){return n&&n!=f});b(l).attr(Horn.Validate.CHECK,k.join(";"))}b(l).unbind("click")});this.checkRegx=[];if(f&&f.indexOf(Horn.Validate.REQUIRED)>-1){this.el.removeClass("m-verify-success");this.el.removeClass("m-verify-error");var d=this.el.parent().parent(".g-unit-wrap").children(".unit-label");var e=b("span.m-verify-symbol",d);if(e){e.remove()}var g=this.msgDiv;if(g){g.remove()}}}});a.Field.regFieldType("div.hc_checkbox-group",a.CheckboxGroup)})(Horn,jQuery);