var optGridId=null;Horn.DataGrid=Horn.extend(Horn.Base,{COMPONENT_CLASS:"DataGrid",id:"dyncGrid",name:"dyncGrid",title:"",data:null,selectModel:"normal",autoLoad:false,baseParams:{},items:[],url:"",emptyMsg:"",numbercolumn:false,rowSelect:false,hasPage:false,toolbar:null,pagebar:null,frozen:null,frozenObj:null,clickFlag:null,td_number:'<td style="width:40px;"><div style="TEXT-aLIGN: center;width:40px;">{count}</div></td>',td_check:'<td style="width:36px;"><div class="hc-datagrid-cell-check" style="TEXT-aLIGN: center;width:36px;"><input type="{CHECK_TYPE}"  id="{CHECKBOX_ID}"></div></td>',td:'<td style="display:{XDATAGRID_TD_HIDDEN};WIDTH:{XDATAGRID_TD_WIDTH}px"><div  class="hc-datagrid-cell" style="TEXT-ALIGN:{XDATAGRID_TD_ALIGN};WIDTH:{XDATAGRID_DIV_WIDTH}px;overflow: visible;">{XDATAGRID_TD_VAL}</div></td>',tr:'<tr id="{TR_ID}"  class="{TR_CLASS}">',tr_end:"</tr>",row_class:"u-table-bg",pageinfo:{totalPagesText:"页，每页{pagesize}条,共{pages}页",displayMsg:"当前显示{from}到{to}，共{total}条记录"},reqPageNo:1,reqPageSize:10,delimiter:",",selecteds:[],lastSelect:null,allCheckboxId:"allcb_datagrid_id",numberColWidth:40,bindFormName:null,initParams:function(c){var e=setDefaultValue;e(c,"numbercolumn",false);e(c,"selectModel","normal");e(c,"items",[]);e(c,"hasPage",false);e(c,"rowSelect",false);e(c,"autoLoad",false);Horn.apply(this,c);if(!c.frozen){c.frozen=[]}if(typeof c.frozen=="object"){this.frozenObjs=[];for(var b=0;b<c.frozen.length;b++){for(var d=0;d<c.items.length;d++){var a=c.items[d];if(a.name==c.frozen[b]){this.frozenObjs.push(a)}}}this.frozenObj=this.frozenObjs[0]}else{for(var d=0;d<c.items.length;d++){var a=c.items[d];if(a.name==c.frozen){this.frozenObj=a;this.frozenObjs=[this.frozenObj];break}}}if(!this.params.pageConfig){this.params.pageConfig={}}if(this.params.bindFormName){this.bindFormName=this.params.bindFormName}if(this.params.id&&this.params.id!=""){this.id=this.params.id}else{if(this.params.name&&this.params.name!=""){this.id=this.params.name}}if(this.hasPage&&this.hasPage==true){this.createPagebar()}if(c.width){this.setWidth(c.width)}if(c.height){this.setHeight(c.height)}},init:function(e){this.name=this.params.name||this.name;Horn.DataGrid.superclass.init.apply(this,arguments);this.initParams(this.params);var g=this;$.each(this.params.events||[],function(h,j){g[j.event.toLowerCase()]=j["function"]});this.dataTable=$("#data_"+this.id).children("table");this.head_dataTable=$("#head_"+this.id);this.title=this.params.title||null;this.titleEl=null;if(this.title){this.titleEl=$("#wrap_"+this.id).children("div.u-datagrid-header").children("h4")}this.ths=this.head_dataTable.children("tbody").find("td");this.trs=this.dataTable.children("tbody").children("tr");this.frozenTable=$("#freeze_data_"+this.id).children("table");this.fro_trs=this.frozenTable.children("tbody").children("tr");this.fro_ths=$("#freez_head_"+this.id).children("tbody").find("td");var a=$("#freez_head_"+this.id);var f=$("#head_"+this.id);for(var c=1;this.frozenObjs&&c<this.frozenObjs.length;c++){var b=this.frozenObjs[c];var d=f.find("div[name="+b.name+"]").parent();d.appendTo(a.find("tr"));f.find("[flag=frozen]").after(d.clone().attr("flag","frozen")).removeAttr("flag")}this.fro_header=a;this.header=f;this.processReqConf();this.initToolbarEvents();if(this.params.autoLoad&&this.params.autoLoad==true){this.autoLoad=this.params.autoLoad;this.load()}else{if(this.data){this.loadFlag="staticData";this.storgedData=this.data.rows?this.data.rows:this.data;this.reqPage(this.reqPageNo,this.reqPageSize)}else{this.pageBtnDisabled(true)}}},processReqConf:function(){var b=this.params.pageConfig["pageNo"];var a=this.params.pageConfig["pageSize"];var c=$("#pageSize_"+this.id);if(a){c.val(a)}this.reqPageNo=this.reqPageNo?this.reqPageNo:b;this.reqPageSize=this.reqPageSize?this.reqPageSize:a},setButtonDisabled:function(a,b){var c=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul").children("li");c.each(function(f,d){var e=$(this).children("a");var g=e.attr("name");if(g==a){if(b){e.addClass("f-disabled");e.attr("onclick","javascript:return false;")}else{e.removeClass("f-disabled");e.attr("onclick",e.attr("event"))}return}})},initToolbarEvents:function(){var a=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul").children("li");a.each(function(d,b){var c=$(this).children("a");if(c.hasClass("f-disabled")){c.attr("onclick","javascript:return false;")}})},staticInitPagebar:function(){if(this.hasPage){var a=this.storgedData.length;if(this.pagebar){this.pagebar.setTotalCount(a);this.pagebar.calPage_(this.reqPageNo,this.reqPageSize,a);this.setPageInfo()}this.reqPageNo=this.reqPageNo+1}},reCalRowHeight:function(){var c=22;var b=this.params.height;if(!b){return}var a=this.currentPageSize;var d=c*a<b?b/a:22;this.setHeight(b)},initSelectEvents:function(){var a=1;var c=this;var b=$("#"+this.allCheckboxId);this.trs.each(function(f,d){var h=$(d),e=h.find("#cb_"+c.id+"_"+a);a++;if(c.rowSelect==false){e.change(function(){if(this.checked){c.selectRow(f+1,h)}else{c.unSelectRow(f+1,h)}})}else{var g=this.clickFlag;h.bind("click",function(i){clearTimeout(g);g=setTimeout(function(){if($.isEmptyObject(c.selecteds)){if(c.frozenObj){$(c.fro_trs[f]).find("#cb_"+c.id+"_"+(f+1)).prop("checked",true);$(c.fro_trs[f]).addClass("u-table-selected")}c.selectRow(f+1,h)}else{if(!c.selecteds.hasOwnProperty(f+1)){if(c.frozenObj){$(c.fro_trs[f]).find("#cb_"+c.id+"_"+(f+1)).prop("checked",true);$(c.fro_trs[f]).addClass("u-table-selected")}c.selectRow(f+1,h)}else{if(c.frozenObj){$(c.fro_trs[f]).find("#cb_"+c.id+"_"+(f+1)).prop("checked",false);$(c.fro_trs[f]).removeClass("u-table-selected")}c.unSelectRow(f+1,h)}}if(b&&c.selectModel=="multi"){c.stateTest()}},10)})}});if(this.frozenObj){a=1;this.fro_trs.each(function(f,d){var h=$(d);var e=h.find("#cb_"+c.id+"_"+a);a++;if(c.rowSelect==false){e.change(function(){if(this.checked){e.checked=true;h.addClass("u-table-selected");c.selectRow(f+1,$(c.trs[f]))}else{e.checked=false;h.removeClass("u-table-selected");c.unSelectRow(f+1,$(c.trs[f]))}if(b&&c.selectModel=="multi"){c.stateTest()}})}else{var g=this.clickFlag;h.bind("click",function(i){clearTimeout(g);g=setTimeout(function(){if($.isEmptyObject(c.selecteds)){e.prop("checked",true);h.addClass("u-table-selected");c.selectRow(f+1,$(c.trs[f]))}else{if(!c.selecteds.hasOwnProperty(f+1)){e.prop("checked",true);h.addClass("u-table-selected");c.selectRow(f+1,$(c.trs[f]))}else{e.prop("checked",false);h.removeClass("u-table-selected");c.unSelectRow(f+1,$(c.trs[f]))}}if(b&&c.selectModel=="multi"){c.stateTest()}},10)})}})}if(b&&this.selectModel=="multi"){this.el.find(".h_datagrid_select_all").change(function(){if(this.checked){c.selectAll()}else{c.unSelectAll()}});this.dataTable.find(".hc-datagrid-cell-check").each(function(e,d){var f=$(d);f.children("input:checkbox").change(function(){c.stateTest()})})}},initHignLightEvent:function(){var a=this;if(this.frozenObj){this.fro_trs.each(function(c,b){var d=$(b);d.mouseover(function(){d.addClass("hc-datagrid-row-over");$(a.trs[c]).addClass("hc-datagrid-row-over")});d.mouseout(function(){d.removeClass("hc-datagrid-row-over");$(a.trs[c]).removeClass("hc-datagrid-row-over")})});this.trs.each(function(c,b){var d=$(b);d.mouseover(function(){d.addClass("hc-datagrid-row-over");$(a.fro_trs[c]).addClass("hc-datagrid-row-over")});d.mouseout(function(){d.removeClass("hc-datagrid-row-over");$(a.fro_trs[c]).removeClass("hc-datagrid-row-over")})})}else{this.trs.each(function(c,b){var d=$(b);d.mouseover(function(){d.addClass("hc-datagrid-row-over")});d.mouseout(function(){d.removeClass("hc-datagrid-row-over")})})}},stateTest:function(){var b=this;var a=true;this.dataTable.find(".hc-datagrid-cell-check").each(function(d,c){var f=$(c);var e=f.children("input:checkbox");if(!e.prop("checked")){a=false}});if(a){b.el.find(".h_datagrid_select_all").prop("checked",true)}else{b.el.find(".h_datagrid_select_all").prop("checked",false)}},load:function(a,d){d=d||{};this.selecteds=null;if(this.loadFlag&&this.loadFlag!="autoLoad"){this.reqPageNo=1}this.loadFlag="autoLoad";if($.type(d)=="array"){d=Horn.Util.arr2Obj(d)}this.reqPageNo=d.pageNo||this.reqPageNo;this.reqPageSize=d.pageSize||this.reqPageSize;if(this.hasPage){d.pageNo=this.reqPageNo;d.pageSize=this.reqPageSize}if(this.bindFormName!=null){var c=$("form[name="+this.bindFormName+"]").serializeArray();var b=Horn.Util.arr2Obj(c);$.each(b,function(e,f){d[e]=f})}this.execute(a,d);$("#head_"+this.id).css("margin-left",0);$("#freez_body_"+this.id).css("margin-top",0)},loadData:function(c){this.loadFlag="loadData";var d=this;var b=this.params.pageConfig["pageNo"];var a=this.params.pageConfig["pageSize"];this.reqPageNo=b?b:1;this.reqPageSize=a?a:10;if(c!=null){this.data=c;this.storgedData=c.rows?c.rows:c;this.reqPage(this.reqPageNo,this.reqPageSize);d.el.find("#data_"+d.id).css("height","");this.pageBtnDisabled(false)}this.reCalRowHeight()},getId:function(){return this.id},getSelecteds:function(){var b=[];for(var a in this.selecteds){if(a=="indexOf"){continue}var c=this.selecteds[a];if(c){b.push(c)}}return b},unSelectAll:function(){var a=this;this.dataTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(b,c){c.checked=false;if(a.rowSelect==false){$(c).trigger("change")}else{a.unSelectRow(b+1,$(c.parentNode.parentNode.parentNode))}});if(this.frozenObj){this.frozenTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(b,c){c.checked=false;$(c.parentNode.parentNode.parentNode).removeClass("u-table-selected")})}a.el.find(".h_datagrid_select_all").prop("checked",false)},selectAll:function(){var a=this;this.dataTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(b,c){c.checked=true;if(a.rowSelect==false){$(c).trigger("change")}else{a.selectRow(b+1,$(c.parentNode.parentNode.parentNode))}});if(this.frozenObj){this.frozenTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(b,c){c.checked=true;$(c.parentNode.parentNode.parentNode).addClass("u-table-selected")})}},setBaseParams:function(a){a=a||{};if(a){this.baseParams=a}else{this.baseParams={}}},setSize:function(f,a){var c=this.getId();var b=f?Number(f):null;var e=a?Number(a):null;if(b&&!isNaN(b)){$("#wrap_"+c).width(b);this.width=b}if(e&&!isNaN(e)){var d=$("#freeze_data_"+c);if(d.size!=0){d.height(e-16)}$("#data_"+c).height(e);this.height=e}},setWidth:function(a){this.setSize(a,null)},setHeight:function(a){this.setSize(null,a)},select:function(b,a){var c=this,b=Number(b);index=b,tr=$(c.trs[index]),f_tr=$(c.fro_trs[index]),_allCheck=$("#"+this.allCheckboxId);if($.isEmptyObject(c.selecteds)){if(c.frozenObj){f_tr.find("#cb_"+c.id+"_"+(index+1)).prop("checked",true);f_tr.addClass("u-table-selected")}c.selectRow(index+1,tr)}else{if(!c.selecteds.hasOwnProperty(index+1)){if(c.frozenObj){f_tr.find("#cb_"+c.id+"_"+(index+1)).prop("checked",true);f_tr.addClass("u-table-selected")}c.selectRow(index+1,tr)}}if(_allCheck&&c.selectModel=="multi"){c.stateTest()}if(a&&a.stopPropagation){a.stopPropagation()}},unselect:function(b,a){this.unSelectRow(b+1,$(this.trs[b]));if(a&&a.stopPropagation){a.stopPropagation()}},selectRow:function(e,a){var d=a;if(!d){d=$("#tr_"+this.id+"_"+e)}var c=this.getRowData(e-1);this.selecteds[e]=c;if(this.selectModel=="single"){var b=this.lastSelect;if(b&&b.rowidx!==undefined&&b.rowidx!=e){b.tr.find("#cb_"+this.id+"_"+b.rowidx).prop("checked",false);this.unSelectRow(b.rowidx,b.tr)}d.find("input:radio").get(0).checked=true}else{if(this.selectModel=="multi"){d.find("input:checkbox").get(0).checked=true}}this.lastSelect={rowidx:e,tr:d};d.addClass("u-table-selected")},getRowData:function(a){return this.result[a]},unSelectRow:function(e,b){var d=b;if(!d){d=$("#tr_"+this.id+"_"+e)}this.selecteds[e]=null;delete this.selecteds[e];d.removeClass("u-table-selected");d.find("#cb_"+this.id+"_"+e).prop("checked",false);if(this.frozenObj){$(this.fro_trs[e-1]).find("#cb_"+this.id+"_"+e).prop("checked",false);$(this.fro_trs[e-1]).removeClass("u-table-selected")}var c=true;for(var a in this.selecteds){c=false;break}if(c){this.el.find(".h_datagrid_select_all").prop("checked",false)}},execute:function(d,c){c=c||{};var e=true;if(this.beforeload){var b=Horn.Util.getFunObj(this.beforeload),f;if($.type(b.fn)=="function"){f=b.fn}if(f){e=f.apply(this,[this.el,c])}}if(e!=false){var a=Horn.apply({},this.baseParams,c);this.doAjax(d,a)}return e},doAjax:function(d,e){var f=this;var d=d?d:f.url;if(d&&d.indexOf("http:")==-1){d=context_path+d}var c=this.dataTable.children("tbody"),a=this.frozenTable.children("tbody"),b=this.ths.length;$.ajax(d,{async:true,beforeSend:function(g){if(f.frozenObj){f.frozenTable.children("tbody").html("")}f.dataTable.children("tbody").html("");c.html('<tr><td style="border-right:0px;padding:15px;" colspan=\''+b+"'><img src='"+context_path+"/components/datagrid/img/hc_onLoad.gif'></img></td></tr>");c.parent().css("width","100%");c.parent().css("text-align","center");c.parent().css("padding","15px")},type:"POST",data:Horn.Util.obj2Arr(e),dataType:"json",error:function(i,j,h){var g=i.status;c.parent().css("width","");c.parent().css("text-align","");c.parent().css("padding","");if(f.frozenObj){f.frozenTable.children("tbody").html("");a.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>请求失败</p><p>错误状态："+g+"；错误信息："+j+"</p></td></tr>")}c.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>请求失败</p><p>错误状态："+g+"；错误信息："+j+"</p></td></tr>")},success:function(h,i,n){c.html("");c.parent().css("width","");c.parent().css("text-align","");c.parent().css("padding","");if(!h||$.isEmptyObject(h)){if(f.frozenObj){f.frozenTable.children("tbody").html("");a.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>")}f.dataTable.children("tbody").html("");c.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>");if(f.loaderror){var k=Horn.Util.getFunObj(f.loaderror),o;if($.type(k.fn)=="function"){o=k.fn}if(o){o.apply(f,[f.el,h])}return}}else{if(h){var j=h.rows;this.result=j?j:h}if(this.result&&(this.result.length==0||$.isEmptyObject(this.result))){if(f.frozenObj){f.frozenTable.children("tbody").html("");a.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>")}f.dataTable.children("tbody").html("");c.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>");f.initPagebar(h)}else{f.data=h.rows;f.params.data=h.rows;f.loadRecords(h);f.initPagebar(h);f.initSelect();f.bindClickEvent(f.rowclick,"click");f.bindClickEvent(f.rowdblclick,"dblclick");f.initSelectEvents();f.initHignLightEvent();f.columnRender();if(f.params.height==undefined){}f.setTHHidden()}}try{if(f.loadsuccess){var g=Horn.Util.getFunObj(f.loadsuccess),m;if($.type(g.fn)=="function"){m=g.fn}if(m){m.apply(f,[f.el,h])}}}catch(l){Horn.debug(l)}}})},initPagebar:function(a){if(this.hasPage){var b=a.total;if(this.pagebar){if(a!=null){$("#toPage_"+this.id).attr("disabled",false);$("#pageSize_"+this.id).attr("disabled",false)}this.pagebar.setTotalCount(b);this.pagebar.calPage_(this.reqPageNo,this.reqPageSize,b);this.setPageInfo()}}},pageBtnDisabled:function(a){if(a){$("#toPage_"+this.id).attr("disabled",true);$("#pageSize_"+this.id).attr("disabled",true);$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").addClass("disabled");$("#page_"+this.id).find(".next_page_btn,.last_page_btn").addClass("disabled");$("#page_"+this.id).find(".refresh_btn").addClass("disabled")}else{$("#toPage_"+this.id).attr("disabled",false);$("#pageSize_"+this.id).attr("disabled",false);$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").removeClass("disabled");$("#page_"+this.id).find(".next_page_btn,.last_page_btn").removeClass("disabled");$("#page_"+this.id).find(".refresh_btn").removeClass("disabled")}},loadRecords:function(a){this.currentPageSize=a.length||(a.rows&&a.rows.length);this.result=a.rows||a;Horn.debug("init datagrid data...",this.result);this.createDataTable();this.initScroll();this.trs=this.dataTable.children("tbody").children("tr");this.fro_trs=this.frozenTable.children("tbody").children("tr");this.loaded=true;Horn.debug("init datagrid data success ...")},calMaxLength:function(){var d,f,e,g=this;for(var c=0;c<g.params.items.length;c++){d=g.params.items[c];var a=d.text.getWidth(12);if(g.params.autoWidth||d.autoWidth){for(var b=0;b<g.result.length;b++){f=g.result[b];e=(""+f[d.name]||"0").getWidth(12);a=e>a?e:a}}d._maxLength=a}},createDataTable:function(){this.calMaxLength();var o=[];var n=[];var m=this.ths.length;if(this.frozenObj){var b=$("#freez_head_"+this.id).children("tbody").children("tr").length}if(this.result&&this.result.length>0){var c=1;for(var h=0;h<this.result.length;h++){var f=this.result[h];if(this.frozenObj){this.createFrozenTableTr(f,c,n)}var k=this.tr.replace("{TR_ID}","tr_"+this.id+"_"+c);k=k.replace("{TR_CLASS}",(c%2==0)?this.row_class:"");o.push(k);if(this.numbercolumn&&this.numbercolumn==true){var a=this.td_number.replace("{count}",c).replace("{numberColumnWidth}",this.numberColWidth);o.push(a)}if(this.selectModel&&this.selectModel=="multi"){var a=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+c);a=a.replace("{CHECK_TYPE}","checkbox");o.push(a)}else{if(this.selectModel&&this.selectModel=="single"){var a=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+c);a=a.replace("{CHECK_TYPE}","radio");o.push(a)}}for(var g=0;g<this.frozenObjs.length;g++){this.frozenObj=this.frozenObjs[g];if(this.frozenObj){var a=this.td.replace("{XDATAGRID_TD_ALIGN}",this.setAlign(this.frozenObj.tAlign));var d=this._getItemWidth(this.frozenObj);a=a.replace("{XDATAGRID_TD_WIDTH}",this.frozenObj.width?this.frozenObj.width:d);a=a.replace("{XDATAGRID_DIV_WIDTH}",this.frozenObj.width?this.frozenObj.width:d);if(this.frozenObj.hidden&&this.frozenObj.hidden==true){a=a.replace("{XDATAGRID_TD_HIDDEN}","none")}var l=this.getCellValue(f,this.frozenObj.name);l=this.formatData(this.frozenObj.dataType,this.frozenObj.format,l);if(l!=""&&(l=="null"||l=="NULL"||l=="undefined")){l=""}a=a.replace("{XDATAGRID_TD_VAL}",l);o.push(a)}}this.frozenObj=this.frozenObjs[0];var p=this.items.length;for(var g=0;g<p;g++){var e=this.items[g];if(e.name!=this.params.frozen&&this.params.frozen.indexOf(e.name)<0){var a=this.td.replace("{XDATAGRID_TD_ALIGN}",this.setAlign(e.tAlign));var d=this._getItemWidth(e);a=a.replace("{XDATAGRID_TD_WIDTH}",e.width?e.width:d);a=a.replace("{XDATAGRID_DIV_WIDTH}",e.width?e.width:d);if(e.hidden&&e.hidden==true){a=a.replace("{XDATAGRID_TD_HIDDEN}","none")}var l=this.getCellValue(f,e.name);if(e.dataType&&e.dataType!=null){l=this.formatData(e.dataType,e.format,l)}if(l!=""&&(l=="null"||l=="NULL"||l=="undefined")){l=""}a=a.replace("{XDATAGRID_TD_VAL}",l);o.push(a)}}o.push(this.tr_end);c++}}if(this.frozenObj){this.frozenTable.children("tbody").html("");this.frozenTable.children("tbody").html(n.join(""))}this.dataTable.children("tbody").html("");this.dataTable.children("tbody").html(o.join(""));this.reCalRowHeight();this.resetTdContent()},resetTdContent:function(){var b=this.head_dataTable.children("tbody").children("tr");var a=this.dataTable.children("tbody").children("tr");var d=this.frozenTable.children("tbody").children("tr");var c=[];var f=this;var e=[];b.each(function(i,h){var l=$(h);var j=l.find("td");for(var g=0;g<j.length;g++){var n=$(j[g]);var k=n.children("div");var m=n.css("display");if((g==j.length-1)&&m!="none"){n.css("width","auto")}}});a.each(function(r,j){var m=false;var o=$(j);var l=o.attr("id");var i=o.find("td");for(var n=0;n<i.length;n++){var h=$(i[n]);var q=h.children("div");var p=q.text();var k=h.css("display");if(k!="none"){if(f.getStrlen(p)>40){if(f.params.frozen&&f.params.frozen!=""){if(e.indexOf(n)==-1){e.push(n)}c.push(l);q.html('<textarea   readonly style="height: 40px;width: 300px;border: 0;background: transparent;line-height: 15px;outline: none;" class="div-textarea">'+p+"</textarea>");q.css("height","40px");q.css("line-height","40px")}else{h.css("width","300px");var g=q.attr("style");g=g+";white-space: normal;text-overflow: initial;;word-wrap:break-word; word-break:break-all";q.attr("style",g);q.css("width","300px")}}}if((n==i.length-1)&&k!="none"){h.css("width","auto")}}});if(this.frozenObj){d.each(function(o,j){var m=$(j);var h=m.find("td");var k=m.attr("id");if(c.length>0&&c.indexOf(k)>-1){for(var l=0;l<h.length;l++){var g=$(h[l]);var n=g.children("div");var i=n.attr("class");if(i!="hc-datagrid-cell-check"){n.css("height","40px");n.css("line-height","40px")}}}})}},getStrlen:function(e){var b=2;var a=0;for(var d=0;d<e.length;d++){var f=e.charCodeAt(d);if((f>=1&&f<=126)||(65376<=f&&f<=65439)){a++}else{a+=b}}return a},formatData:function(e,d,f){return Horn.Util.Format.all(e,d,f)},createFrozenTableTr:function(c,e,b){b=b||[];var f=this.tr.replace("{TR_ID}","tr_"+this.id+"_"+e);f=f.replace("{TR_CLASS}",(e%2==0)?this.row_class:"");b.push(f);if(this.numbercolumn&&this.numbercolumn==true){var h=this.td_number.replace("{count}",e).replace("{numberColumnWidth}",this.numberColWidth);b.push(h)}if(this.selectModel&&this.selectModel=="multi"){var h=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+e);h=h.replace("{CHECK_TYPE}","checkbox");b.push(h)}else{if(this.selectModel&&this.selectModel=="single"){var h=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+e);h=h.replace("{CHECK_TYPE}","radio");b.push(h)}}for(var d=0;d<this.frozenObjs.length;d++){this.frozenObj=this.frozenObjs[d];if(this.frozenObj){var h=this.td.replace("{XDATAGRID_TD_ALIGN}",this.setAlign(this.frozenObj.tAlign));var a=this._getItemWidth(this.frozenObj);h=h.replace("{XDATAGRID_TD_WIDTH}",this.frozenObj.width?this.frozenObj.width:a);h=h.replace("{XDATAGRID_DIV_WIDTH}",this.frozenObj.width?this.frozenObj.width:a);if(this.frozenObj.hidden&&this.frozenObj.hidden==true){h=h.replace("{XDATAGRID_TD_HIDDEN}","none")}var g=this.getCellValue(c,this.frozenObj.name);g=this.formatData(this.frozenObj.dataType,this.frozenObj.format,g);h=h.replace("{XDATAGRID_TD_VAL}",g);b.push(h)}}this.frozenObj=this.frozenObjs[0];b.push(this.tr_end)},_getItemWidth:function(c){var b=c;for(var a=0;a<this.params.items.length;a++){if(c.name==this.params.items[a]["name"]){b=this.params.items[a];break}}if(b.autoWidth||this.params.autoWidth){return b.width||b._maxLength}else{return b.width||100}},initScroll:function(){var a="#data_"+this.id;var c="#head_"+this.id;var b="#freez_body_"+this.id;$(a).scroll(function(){var e=$(a).scrollLeft();var d=$(a).scrollTop();$(c).css("margin-left",-e);$(b).css("margin-top",-d)})},getCellValue:function(f,e){f=f||{};e=e||"";var b=this.params.items;for(var d=0;d<b.length;d++){if(b[d]["name"]==e&&b[d]["items"]){var a=b[d]["items"];for(var c=0;c<a.length;c++){if(a[c]["value"]==f[e]){f[e]=a[c]["label"]}}}}if(f[e]||f[e]==0){return f[e]}else{return""}},createPagebar:function(){if(this.params.pageConfig){var a=this;this.pagebar=new Horn._Pagebar(this.params.pageConfig,this.id,a)}},setPageInfo:function(){$("#toPage_"+this.id).val(this.pagebar.currentPage);$("#pageSize_"+this.id).val(this.pagebar.pageSize);$("#totalPages_"+this.id).html(this.pagebar.pages);if((this.pagebar.pageSize%5)==0){var b=this.pagebar.pageSize/5;if(b==20){b=11}else{if(b==40){b=12}else{if(b==100){b=13}else{if(b==200){b=14}}}}var a=$($(".dropdown-menu-datagrid").find("li").get(b-1));a.addClass("active");this.pagebar.activeLi=a}$("#pageInfo_"+this.id).html(this.pagebar.getPageInfo());if(1==this.pagebar.currentPage){$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").addClass("disabled")}else{$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").removeClass("disabled")}if(this.pagebar.pages==this.pagebar.currentPage){$("#page_"+this.id).find(".next_page_btn,.last_page_btn").addClass("disabled")}else{$("#page_"+this.id).find(".next_page_btn,.last_page_btn").removeClass("disabled")}$("#page_"+this.id).find(".refresh_btn").removeClass("disabled")},reqPage:function(b,a){this.reqPageNo=b?b:this.reqPageNo;this.reqPageSize=a?a:this.reqPageSize;if(this.loadFlag!="autoLoad"&&this.storgedData){this.result=this.storgedData.slice((this.reqPageNo-1)*this.reqPageSize,this.reqPageNo*this.reqPageSize);if(!this.hasPage){this.result=this.storgedData}this.loadRecords(this.result);this.setTHHidden();this.initScroll();this.staticInitPagebar();this.initSelect();this.bindClickEvent(this.rowclick,"click");this.bindClickEvent(this.rowdblclick,"dblclick");this.initSelectEvents();this.initHignLightEvent();this.columnRender()}else{this.load()}},initSelect:function(){var b=this;$("#"+this.allCheckboxId).prop("checked",false);var a=$("#"+this.allCheckboxId);if(a&&this.selectModel=="multi"){a.prop("checked",false);if(this.frozenObj){this.fro_trs.each(function(c,d){$(d).find("#cb_"+b.id+"_"+(c+1)).prop("checked",false)})}this.trs.each(function(c,d){$(d).find("#cb_"+b.id+"_"+(c+1)).prop("checked",false)})}this.selecteds=[];this.lastSelect={}},bindClickEvent:function(b,f){var j=undefined;var a=undefined;if(b){j=Horn.Util.getFunObj(b);if($.type(j.fn)=="function"){a=j.fn}}if(a){var g=this.trs;var e=this.clickFlag;for(var d=0;d<g.length;d++){var h=$(g[d]);var c=j.params.slice(0);c.push(this.result[d],this.result);h.bind(f,c,function(k){var i=k.data;var l=this;if(f=="click"){clearTimeout(e);e=setTimeout(function(){return j.fn.apply(l,i)},300)}else{return j.fn.apply(l,i)}})}}},setAlign:function(a){a=a||"left";return a},setTHHidden:function(){var a=this;this.ths.each(function(b,f){var e=$(f);var g=e.find("div.hc-datagrid-cell");if(g.size()>0){for(var c=0;c<a.items.length;c++){var d=a.items[c];if(g.attr("name")==d.name){g.css("textalign",d.hAlign?d.hAlign:"center");g.css("width",a._getItemWidth(d));if(d.hidden&&d.hidden==true){e.hide()}break}}}});if(this.frozenObj){this.fro_ths.each(function(b,f){var e=$(f);var g=e.find("div.hc-datagrid-cell");if(g.size()>0){for(var c=0;c<a.items.length;c++){var d=a.items[c];if(g.attr("name")==d.name){g.css("textalign",d.hAlign?d.hAlign:"center");g.css("width",a._getItemWidth(d));if(d.hidden&&d.hidden==true){e.hide()}break}}}})}},dictColRender:function(d,c){d.attr("key",d.text());var a=d.children("div").text();var b=Horn.getDict(c);if(b){if(a==""||b[a]==undefined){d.children("div").text("");d.children("div").attr("title","")}else{d.children("div").text(b[a]||a);d.children("div").attr("title",b[a]||a)}}},buttonsColRender:function(c,h,a,f,g,b,i,k){c.find("div").attr("title","");var e=h;var j=$("<span></span>");$(e).each(function(p,m){var n=Horn.Util.getFunObj(m.event);if(!n.fn){return}var l=$("<a href='javascript:void(0)'>"+m.label+"</a>"),o=c.children("div").text();l.click(function(){n.fn.call(l,{val:o,rowdata:k,alldata:i,table:b,rowidx:a,tdidx:f,tr:g,td:c})});l.css("color","#3366CC");l.hover(function(){$(this).css("color","#CC3300");$(this).css("text-decoration","underline")},function(){$(this).css("color","#3366CC");$(this).css("text-decoration","none")});j.append(l);if(p!=(e.length-1)){j.append(" | ")}});c.children("div").html("");c.children("div").append(j);if(this.frozenObj){var d=$(this.fro_trs[a]).find("td")[f];$(d).children("div").html("");$(d).children("div").append(j)}},colRendererFunc:function(a,e,h,d,f,a){var c=this;a.attr("key",a.find("div").text());a.find("div").attr("title","");var g=Horn.Util.getFunObj(e),i=a.find("div").text();if(!g.fn){return}var b=g.fn.call($(this),{val:i,rowdata:c.result[h],alldata:c.result,table:c,rowidx:h,tdidx:d,tr:f,td:a});if(b instanceof $){a.find("div").html("");a.find("div").append(b)}else{a.find("div").html(b)}},columnRender:function(){var e=this;var b=this.ths;function d(f){for(var g=0;g<e.params.items.length;g++){if(f==e.params.items[g]["name"]){return e.params.items[g]}}}var a=this.fro_header;var c=this.header;a.find("td").each(function(f,j){var k=$(j).find("div").attr("name");if(k){var h=d(k),g=e._getItemWidth(h);$(j).find("div").width(g)}});c.find("td").each(function(f,j){var k=$(j).find("div").attr("name");if(k){var h=d(k),g=e._getItemWidth(h);$(j).find("div").width(g)}});this.trs.each(function(g,f){var j=$(f);var h=$(e.fro_trs[g]),i=h.find("td");j.find("td").each(function(r,n){var o=$(n);var m=$(b.get(r));var s=m.find("div").attr("dictname"),t=m.find("div").attr("renderer"),k=m.find("div").attr("name"),u=m.find("div").attr("buttons"),l,v;var p=$(i.get(r));o.find("div").attr("title",o.find("div").text());p.find("div").attr("title",p.find("div").text());for(var q=0;q<e.params.items.length;q++){if(e.params.items[q].name==k){u=e.params.items[q]["buttons"];l=e.params.items[q]["width"];v=e.params.items[q];if(v.autoWidth||e.params.autoWidth){}else{if(!l){}}break}}if(s){e.dictColRender(o,s);if(e.frozenObj){e.dictColRender(p,s)}}else{if(u){e.buttonsColRender(o,u,g,r,j,e,e.result,e.result[g])}}if(t){e.colRendererFunc(o,t,g,r,j,o);if(e.frozenObj){e.colRendererFunc(p,t,g,r,h,p)}}})})},setTitle:function(a){this.title=a;this.titleEl.text(a)},getTitle:function(){return this.title},addButton:function(b){var a={name:"",cls:"",event:""};b=$.extend(a,b);if(!b||!b.label){return}var d=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul");var c=$('<li><a name="'+b.name+'" href="JavaScript:void(0)" class="hc-datagrid-a hc_datagrid-alink" onclick="'+b.event+'"><i class="fa '+b.cls+'"></i>'+b.label+"</a></li>");d.append(c)},hideButton:function(a,c){var e=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul");var d=e.children("li").children("a");for(var b=0;b<d.length;b++){if($(d[b]).attr("name")==a){$(d[b]).hide()}}}});$.extend(Horn.DataGrid,{DATANAME:"h_datagrid"});Horn.regUI("div.xdatagrid",Horn.DataGrid);function setDefaultValue(c,b,a){if(c[b]===undefined){c[b]=a}else{if(c[b]=="true"){c[b]=true}else{if(c[b]=="false"){c[b]=false}}}}Horn._Pagebar=function(d,c,a){var b={gridId:null,INDEX_PAGE:1,currentPage:1,pageSize:10,pageCount:0,pages:0,startRow:0,init:function(g,f,e){if(g){setDefaultValue(g,"pageSize",10);setDefaultValue(g,"pageNo",1);setDefaultValue(g,"startRow",0);setDefaultValue(g,"pageCount",0);setDefaultValue(g,"currentPage",0);this.currentPage=parseInt(g.currentPage);this.pageCount=parseInt(g.pageCount);this.pageSize=parseInt(g.pageSize);this.pageNo=parseInt(g.pageNo);this.startRow=parseInt(g.startRow);this.pages=0}this.gridId=f;this.grid=e;this.grid.reqPageSize=this.pageSize;this.grid.reqPageNo=this.pageNo;this.el=$("#page_"+this.gridId)},initEvents:function(){var e=this;$("#page_"+this.gridId).children("li").find("a").each(function(g,h){var i=$(h);var j=function(l,m,k){l.click(function(){if(l.hasClass("disabled")){return}k=k||[];m.apply(e,k)})};if(!i.hasClass("disabled")){if(i.hasClass("first_page_btn")){j(i,e.first)}else{if(i.hasClass("pre_page_btn")){j(i,e.pre)}else{if(i.hasClass("next_page_btn")){j(i,e.next)}else{if(i.hasClass("last_page_btn")){j(i,e.last)}else{if(i.hasClass("refresh_btn")){j(i,e.refresh)}}}}}}});this.perPage=false;$("#_recPerPage"+this.gridId).on("click",function(){optGridId=$(this).attr("id");optGridId=optGridId.substring(11);var g=$(this).children("strong").text();if(e.perPage){$(this).next().hide();e.perPage=false}else{$(this).next().show();$(this).next().find("li").each(function(h,i){var j=$(this).children("a").text();if(g==j){$(this).addClass("active")}else{$(this).removeClass("active")}});e.perPage=true}});$("#_recPerPage"+this.gridId).bind("blur",function(h){var g=h;if(e.perPage){$(".dropdown-menu-datagrid").hide();e.perPage=false;return true}});$(".dropdown-menu-datagrid").bind("mouseover",function(){$("#_recPerPage"+e.gridId).unbind("blur")});$(".dropdown-menu-datagrid").bind("mouseout",function(){$("#_recPerPage"+e.gridId).bind("blur",function(h){var g=h;if(e.perPage){$(".dropdown-menu-datagrid").hide();e.perPage=false;return true}})});this.activeLi=$(".dropdown-menu-datagrid").find("li.active");var f=this.grid;$("#toPage_"+f.id).on("keydown",function(i){var g=i.keyCode;if(g==27||g==8){return true}if(g>=48&&g<=57){return true}if(g>=96&&g<=105){return true}var h=new RegExp("[0123456789]");var j=String.fromCharCode(g);if(!h.test(j)){return false}});$("#toPage_"+f.id).on("blur",function(){var g=$(this).val();if(!g||isNaN(g)){g=f.reqPageNo}g=parseInt(g,10);if(g<=0){g=1}else{if(g>f.pagebar.pages){g=1}}$(this).val(g);f.reqPage($(this).val(),$("#pageSize_"+f.id).html())});$("#pageSize_"+f.id).on("blur",function(){var g=$(this).val();if(g==""){var h=e.pageSize;if(h&&h!=""){g=h}else{g=10}}if(!g||isNaN(g)){g=f.pageSize}g=parseInt(g,10);if(g<=0){g=1}$(this).val(g);e.grid.reqPage(parseInt($("#toPage_"+e.grid.id).val()),g)})},calPage_:function(g,f,e){this.pageSize=parseInt(f);this.pageCount=parseInt(e);this.pages=Math.ceil(this.pageCount/this.pageSize);if((g*this.pageSize)>this.totalCount){this.currentPage=this.pages}else{this.currentPage=g}},pre:function(){if(this.currentPage<=1||this.pageCount==0){this.grid.reqPage(1,this.pageSize)}else{this.grid.reqPage((this.currentPage-1),this.pageSize)}},next:function(){if(this.pages==this.currentPage){return}var e=0;if(this.currentPage!=""){e=parseInt(this.currentPage)+1}this.grid.reqPage(e,this.pageSize)},last:function(){if(this.pages==0){return}else{this.grid.reqPage(this.pages,this.pageSize)}},first:function(){this.grid.reqPage(this.INDEX_PAGE,this.pageSize)},refresh:function(){var e=this.grid.reqPageNo-1;if(this.grid.loadFlag=="autoLoad"){e=this.grid.reqPageNo}this.grid.reqPage(e,this.pageSize)},getPageInfo:function(){var f;var g=0,e=0;if(this.pageCount>0){g=this.pageSize*(this.currentPage-1)+1;if((this.pageSize*this.currentPage)>=this.pageCount){e=this.pageCount}else{e=this.pageSize*this.currentPage}}f="显示"+g+"到"+e+"条,共"+this.pageCount+"条记录";return f},setTotalCount:function(e){this.totalCount=parseInt(e)}};b.init(d,c,a);b.initEvents();return b};String.prototype.getWidth=function(b){var a=document.getElementById("__getwidth");if(a==null){a=document.createElement("span");a.id="__getwidth";document.body.appendChild(a);a.style.visibility="hidden";a.style.whiteSpace="nowrap"}a.innerHTML=this.toString();a.style.fontSize=b+"px";return a.offsetWidth};