Horn.Form=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Form",form:null,ajax:false,ajaxCallback:false,onSuccessObj:null,baseParams:null,init:function(){Horn.Form.superclass.init.apply(this,arguments);this.form=this.el;var i=this.form.attr("ajax");var j=this;this.baseParams={};this.beforeSubmit=this.params.beforeSubmit;var b=this;$.each(this.params.events||[],function(e,l){b[l.event]=l["function"]});if(this.beforeSubmit){var c=Horn.Util.getFunObj(this.beforeSubmit);if(c&&$.type(c.fn)=="function"){this.on("beforesubmit",c.fn)}}var a=function(){return j.fire("beforesubmit")};var h=j.toAjaxForm;j.toAjaxForm=function(){j.el.unbind("submit",a);h.call(j)};if(!i){j.el.submit(a)}else{try{var k=Horn.Util.decode(i);if($.isPlainObject(k)){var g=k.onSuccess;if(g){var f=Horn.Util.getFunObj(g);if(f&&$.type(f.fn)=="function"){this.on("ajaxsuccess",f.fn)}}}}catch(d){}j.toAjaxForm()}j.on("beforesubmit",j.isValid);this.form.bind("reset",function(){j.reset(false);return false});if(j.el.find(":file").get(0)){j.el.attr("enctype","multipart/form-data")}},customEvents:"beforesubmit",getEventTarget:function(){return this.el},toAjaxForm:function(){var a=this;if(this.ajax===true){return}this.ajax=true;this.el.submit(function(){if(a.fire("beforesubmit")==true){a.doPost()}return false})},setBaseParams:function(a){this.baseParams=a},doPost:function(){var values=this.getValues();var url=this.form.attr("action");Horn.apply(values,this.baseParams);url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+(values.pagelet||new Date().getTime());function onAjaxComplate(result){var data=eval("("+result+")");BigPipe.onArrive(data);BigPipe.start();Horn.init()}$.post(url,values,onAjaxComplate)},submit:function(){this.form.submit()},reset:function(a){if(!a===false){this.form.get(0).reset()}Horn.Field.findFieldCompsIn(this.form).each(function(){if($.isFunction(this.reset)){this.reset()}});var b=this.form.find("div.hc_label[name]");b.each(function(c,e){var f=$(e);var d=Horn.getCompByEl(f);d.setValue("")})},clearValue:function(){Horn.Field.findFieldCompsIn(this.form).each(function(){this.clearValue()});var a=this.form.find("div.hc_label[name]");a.each(function(b,d){var e=$(d);var c=Horn.getCompByEl(e);c.setValue("")})},getValues:function(){var a=this.form.serializeArray();return Horn.Util.arr2Obj(a)},getFieldComps:function(){return Horn.Field.findFieldCompsIn(this.el)},setValues:function(c,d,a){var b=c;if(!d){d=""}if($.isArray(c)){b=Horn.Util.arr2Obj(c)}this.getFieldComps().each(function(f,j){var g=j.mutiName();if(g){var k={};var h=0;$(g).each(function(i,l){k[l]=b[l.replace(new RegExp("^"+d+""),"")];if(k[l]){h++}});if(h!=0){j.setValue(k||"")}else{if(!(a==false)){j.setValue("")}}}else{var k=b[j.name.replace(new RegExp("^"+d+""),"")];if(k){j.setValue(k)}else{if(!(a==false)){if(k==0){j.setValue(k)}else{j.setValue("")}}}}});var e=this.form.find("div.hc_label");e.each(function(f,h){var j=$(h);var g=Horn.getCompByEl(j);var i=b[g.name.replace(new RegExp("^"+d+""),"")];g.setValue(i)})},removeError:function(){this.getFieldComps().each(function(a,b){b.removeError()})},isValid:function(){return Horn.Validate.isFormValidate(this.form)},serializeArray:function(){return this.form.serializeArray()},serialize:function(){return this.form.serialize()},findField:function(b,f){var c=f||"";var e=null;var d=this.el;if(jQuery.type(b)=="string"){var a=Horn.Field.getSelector(b,c);e=$(a,d);if(!c){e=e.not(":disabled")}}else{e=$(b,d)}return e}});$.extend(Horn.Form,{DATANAME:"h_form",get:function(b){var a=Horn.data(Horn.Form.DATANAME);var c=a[0];return c}});Horn.regUI("form",Horn.Form);