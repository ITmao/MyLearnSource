Horn.Validate={REQUIRED:"required",CHECK:"check",CHECKSEP:";",init:function(b){var a=Horn.getCurrent();if(b){a=$(b)}else{a=a.find("form")}var c=this},isFormValidate:function(l,d){if(arguments.length==1){if(typeof arguments[0]=="boolean"){return this.isFormValidate(null,arguments[0])}}var i=Horn.Validate;var a=null;if($(this).length>0&&$(this).prop("tagName")){a=$(this)}else{if($(l).length>0&&$(l).prop("tagName")){a=$(l)}else{a=Horn.getCurrent().find("form")}}var e=a.find("div.h_formgridtitle").nextAll("ul.h_panel");var g=Horn.Field.findFieldsIn(e);var h=Horn.Field.findFieldsIn(a).not(g);var k=true;var c=[];setTimeout(function(){i.removeError(g)},100);var f;h.each(function(m,n){var o=Horn.getCompByEl(n);o.validate();if(!o.isValid()){if(!f){f=o}k=false;if(d!=undefined){c.push(o.name)}}});if(f){var j=f.getEventTarget();if(f instanceof Horn.CalendarGroup){var b=f.getInValidEle();if(b){b.focus()}}else{if(f instanceof Horn.Combox||f instanceof Horn.Select||f instanceof Horn.Calendar){j.data("isFromOuter",true);j.blur()}else{j.focus()}}f=null}if(k===false){return d?c:false}return k},validateAreaByGroup:function(d,c){var a=Horn.Field.findFieldsIn(d);var b=true;a.each(function(e,f){var g=Horn.getCompByEl(f);if(g&&g.inGroup(c)){g.validate();if(!g.isValid()){b=false}}});return b},onValid:function(d){var g=d.data[0];var a=d.data[1];var c=a.field;var b=c.prev("input[type='hidden']").size()>0?c.prev():c;var f=g.getRules.call(g,b);if(f&&f.length>0&&c.attr("disabled")==undefined){g.isValide.call(g,f,a,b.val())}else{g.removeError.call(g,a)}},regexEnum:{intege:"^-?[1-9]\\d*$|^0$",intege1:"^[1-9]\\d*$",intege2:"^-[1-9]\\d*$",num:"^([+-]?)\\d*\\.?\\d*$",num1:"^[1-9]\\d*|0$",num2:"^-[1-9]\\d*|0$",decmal:"^([+-]?)\\d*\\.\\d+$",decmal1:"^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*$",decmal2:"^-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*)$",decmal3:"^-?([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0)$",decmal4:"^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0$",decmal5:"^(-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*))|0?.0+|0$",email:"^(\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+){0,1}$",color:"^[a-fA-F0-9]{6}$",url:"^http[s]?:\\/\\/([\\w-]+\\.)+[\\w-]+([\\w-./?%&=]*)?$",chinese:"^[\\u4E00-\\u9FA5\\uF900-\\uFA2D]+$",ascii:"^[\\x00-\\xFF]+$",zipcode:"^\\d{6}$",mobile:"^(13|15|18|17)[0-9]{9}$",ip4:"^(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)$",notempty:"^\\S+$",picture:"(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$",rar:"(.*)\\.(rar|zip|7zip|tgz)$",date:"^\\d{4}\\d{1,2}\\d{1,2}$",qq:"[1-9][0-9]{4,11}",tel:"^(([0\\+]\\d{2,3}-)?(0\\d{2,3})-)?(\\d{7,8})(-(\\d{3,}))?$",username:"^\\w+$",letter:"^[A-Za-z]+$",letter_u:"^[A-Z]+$",letter_l:"^[a-z]+$",required:"^\\s*\\S[\\S\\s]*$",Message:"输入格式不正确",integeMessage:"输入的不是整数格式",intege1Message:"输入的不是正整数格式",intege2Message:"输入的不是负整数格式",requiredMessage:"当前输入不能为空",emailMessage:"邮件地址不正确",zipcodeMessage:"邮编输入格式不正确",dateMessage:"日期格式不正确",qqMessage:"QQ号码格式不正确",telMessage:"电话号码格式不正确",mobileMessage:"移动电话格式不正确",decmalMessage:"只能输入浮点数格式",decmal1Message:"只能输入正浮点数格式",decmal2Message:"只能输入负浮点数格式",decmal3Message:"只能输入浮点数格式",decmal4Message:"只能输入非负浮点数格式",decmal5Message:"只能输入非正浮点数格式",colorMessage:"只能输入颜色格式",urlMessage:"只能输入url格式",chineseMessage:"只能输入中文格式",asciiMessage:"只能输入ACSII字符格式",ip4Message:"只能输入ip4地址格式",pictureMessage:"只能输入图片格式",rarMessage:"只能输入压缩文件格式",numMessage:"只能输入数字格式",num1Message:"只能输入正数数字格式",num2Message:"只能输入负数数字格式",letterMessage:"只能输入字母格式",letter_uMessage:"只能输入大写字母格式",letter_lMessage:"只能输入小写字母格式",usernameMessage:"只能输入由数字、26个英文字母或者下划线组成的字符串"},funcEnum:{range:function(c,b,a){if(b!==undefined){if(c<b){return false}}if(a!==undefined){if(c>a){return false}}return true},rangeMessage:"{0}不在{1}-{2}范围内",compare:function(b,a){var c=Horn.Field.getField(a);if(c.val()!=b){return false}return true},compareMessage:"校验不匹配",length:function(c,b,a){if(c){if(c.length>a||c.length<b){return false}}return true},lengthMessage:"输入的长度{1}-{2}字符之间",past:function(e){var g=new Date();var c=g.getFullYear(),f=String.leftPad(g.getMonth()+1+"","0",2),b=String.leftPad(g.getDate()+"",2,"0");var a=c+""+f+""+b;if(e){if(e>=a){return false}}return true},pastMessage:"输入的日期{0}必须小于当前日期",future:function(e){var g=new Date();var c=g.getFullYear(),f=String.leftPad(g.getMonth()+1+"","0",2),b=String.leftPad(g.getDate()+"","0",2);var a=c+""+f+""+b;if(e){if(e<=a){return false}}return true},futureMessage:"输入的日期{0}必须大于当前日期",idcard:function(g){var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};function f(k){var j=k;if(j===""){return false}if(e(j)===false){return false}if(c(j)===false){return false}if(i(j)===false){return false}if(d(j)===false){return false}return true}function e(j){var k=/(^\d{15}$)|(^\d{17}(\d|X)$)/;if(k.test(j)===false){return false}return true}function c(k){var j=k.substr(0,2);if(b[j]==undefined){return false}return true}function i(j){var k=j.length;if(k=="15"){var r=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;var m=j.match(r);var n=m[2];var l=m[3];var o=m[4];var p=new Date("19"+n+"/"+l+"/"+o);return a("19"+n,l,o,p)}if(k=="18"){var q=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;var m=j.match(q);var n=m[2];var l=m[3];var o=m[4];var p=new Date(n+"/"+l+"/"+o);return a(n,l,o,p)}return false}function a(m,p,j,n){var k=new Date();var l=k.getFullYear();if(n.getFullYear()==m&&(n.getMonth()+1)==p&&n.getDate()==j){var o=l-m;if(o>=0&&o<=120){return true}return false}return false}function d(n){n=h(n);var k=n.length;if(k=="18"){var m=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var p=0,o,l;for(o=0;o<17;o++){p+=n.substr(o,1)*m[o]}l=j[p%11];if(l==n.substr(17,1)){return true}return false}return false}function h(l){if(l.length=="15"){var k=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var n=0,m;l=l.substr(0,6)+"19"+l.substr(6,l.length-6);for(m=0;m<17;m++){n+=l.substr(m,1)*k[m]}l+=j[n%11];return l}return l}return f(g)},idcardMessage:"{0}身份证格式不正确",Message:"{0}验证未通过"},applyString:function(a,b){return a.replace(/\{(\d+)\}/g,function(c,d){return b[d]})},isValide:function(rules,display,value){var _this=this;if(!rules){alert("fun.isValide 方法校验规则为空，请检查");return false}var ruleTypes="string,array,function";if(ruleTypes.indexOf($.type(rules))==-1){alert("fun.isValide 方法校验规则类型不正确，应为："+ruleTypes);return false}var isValid=true;if((typeof rules)=="string"){rules=[{name:rules,params:[value]}]}if((typeof rules)=="function"){rules=[{name:rules,params:[value]}]}for(var index=0;index<rules.length;index++){var item=rules[index];var name=item.name;var format=item.format;if(format=="yesConfig"){return}if(name===undefined||name===""){return"name 校验规则为空请检查"}if(name!="required"&&!value){continue}var msg="";if(this.regexEnum[name]){isValid=(new RegExp(this.regexEnum[name],item.regexparam)).test(value);msg=item.message||this.regexEnum[name+"Message"]||this.regexEnum.Message}else{if(this.funcEnum[name]){isValid=this.funcEnum[name].apply(display,item.params);msg=item.message||this.funcEnum[name+"Message"]||this.funcEnum.Message}else{if($.type(eval(name))=="function"){var tArr=item.params.slice(0);isValid=eval(name).apply(display,tArr);msg=isValid}else{alert("错误的校验类型");return false}}}if(isValid!==true){var params=item.params;msg=($.type(msg)=="boolean"||!msg)?msg:_this.applyString.apply(value,[msg,params]);_this.addError.call(_this,display,msg);return msg}}if(display.isValid!=Horn.Field.prototype.isValid){setTimeout(function(){var msg=display.isValid();if(msg!==true){_this.addError.call(_this,display,msg)}else{_this.removeError.call(_this,display,msg)}},1);return}_this.removeError.call(_this,display);return isValid},getRules:function(c){var g=this;var e=Horn.Field.getField(c);var a=e.attr(this.CHECK);var d=e.attr("format");if(a){var b=a.split(this.CHECKSEP);var f=[];$.each(b,function(h,j){var i=g.getRule(e,j);if(i){i.format=d;f.push(i)}});return f}},getRule:function(field,rule){if(rule){var name=rule;var value=field.val();var params=[value];if(rule.indexOf("(")>-1){name=rule.substring(0,rule.indexOf("("));var ps=rule.substring(rule.indexOf("(")+1,rule.indexOf(")")).split(",");for(var i=0;i<ps.length;i++){if(ps[i]){params.push(eval("("+ps[i]+")"))}}}return{name:name,params:params}}return null},addError:function(d,a){var c=(typeof d=="string")?Horn.getComp(d):d;function b(e){if(e instanceof Horn.Field){e.showError(a)}else{Horn.Tip.addTip(a)}}if(!c){Horn.ready(function(){var e=(typeof d=="string")?Horn.getComp(d):d;b(e)})}else{b(c)}},removeError:function(a){a=(typeof a=="string")?Horn.getComp(a):a;$(a).each(function(b,c){try{c=Horn.getCompByEl(c)||c;c.removeError()}catch(d){if(window.console){window.console.warn("批量消除错误失败"+c)}}})},validateFmt:function(f){if(f==""){return true}var a="^\\d{4}\\d{1,2}\\d{1,2}$";var b=Horn.Calendar.DEFAULT_FORMAT;var e=true;if(b){if(b.length>8){var d=b.charAt(4);var c=b.charAt(7);var a="^\\d{4}"+d+"\\d{1,2}"+c+"\\d{1,2}$";e=(new RegExp(a)).test(f)}else{e=(new RegExp(a)).test(f)}if(!e){e="日期格式不正确,格式："+b}}else{e="没有配置Horn.Calendar.DEFAULT_FORMAT格式参数"}return e}};