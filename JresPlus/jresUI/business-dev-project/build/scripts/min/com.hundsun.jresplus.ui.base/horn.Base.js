var Horn=Horn||{debug_:false,fixed_:true,debug:function(b,a){if(Horn.debug_&&typeof console!="undefined"&&typeof console.log!="undefined"){console.log(b,a)}}};(function(h){var e=null,a=null;var g=0;var d=[],f=[];var j=[];var c={};h.cachedDicts={};h.apply=function(m,n,l){if(l){h.apply(m,l)}if(m&&n&&typeof n=="object"){for(var k in n){m[k]=n[k]}}return m};function b(){var k=$('<div style="display:none;position:fixed;z-index:100;"></div>');$("body").append(k);return k.css("position")=="fixed"}function i(){Horn.fixed_=b();Horn.debug("Horn.init","regist...");for(var l=0;l<f.length;l++){f[l]()}Horn.debug("Horn.init","ready...");while(d.length>0){var k=d.shift();k()}}h.apply(h,{id:function(k){if(!k){k="horn-comp-"}return k+(g++)},extend:(function(){var l=function(p){for(var n in p){this[n]=p[n]}};var k=Object.prototype.constructor;return function(r,o,q){if(typeof o=="object"){q=o;o=r;r=q.constructor!=k?q.constructor:function(){o.apply(this,arguments)}}var n=function(){},p,m=o.prototype;n.prototype=m;p=r.prototype=new n();p.constructor=r;r.superclass=m;if(m.constructor==k){m.constructor=o}r.override=function(s){h.override(r,s)};p.superclass=p.supr=(function(){return m});p.override=l;h.override(r,q);r.extend=function(s){return h.extend(r,s)};return r}})(),override:function(k,m){if(m){var l=k.prototype;h.apply(l,m)}},getCurrent:function(){if(e){return e}return $(document.body)},setCurrent:function(k){if(k){e=k}},createComp:function(l,k){if(typeof l=="function"){var m=new l(k);if(m instanceof h.Base){this.data(m);return m}}return null},_guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var l=Math.random()*16|0,k=m=="x"?l:(l&3|8);return k.toString(16)})},data:function(n,l){if(!a){var o=this.getCurrent().find("form");if(o.length>0){a=o.first()}else{a=this.getCurrent()}}if($.type(n)=="object"){if(!a.data("_id_comp_cache")){a.data("_id_comp_cache",{})}if(!a.data("_el_comp_cache")){a.data("_el_comp_cache",{})}var k=a.data(n.getQID());if(!k){k=new Array()}k.push(n);if(k.length>1){Horn.debug("出现重复组件名：",n.getQID())}if(n.params&&n.params.id&&n.params.id!=""){a.data("_id_comp_cache")[n.params.id]=n}if(n.el){var m=this._guid();n.el.data("comp_el_id",m);a.data("_el_comp_cache")[m]=n}return a.data(n.getQID(),k)}else{if($.type(n)=="string"&&l){return a.data(n,l)}else{if($.type(n)=="string"&&!l){return a.data(n)}}}return a.data()},getQID:function(k,l){return k+"$"+(l||"_")},getComp:function(m,l){var k=this.data(this.getQID(m,l));if(!k){return}for(var n=0;n<k.length;n++){if(k[n].params.id&&k[n].params.id!=""){return k[n]}}return k[k.length-1]},getCompByEl:function(k){return h.Base.getCompByEl(k)},register:function(k){f.push(k)},ready:function(k){d.push(k)},getCompById:function(k){return Horn.Base.getCompById(k)},submitHandler:function(m,l){var n=$.type(l)=="string"?this.getComp(l):l;if(n&&n instanceof h.Base){n.on("beforesubmit",m)}else{var k=h.getCurrent().find("form");k.each(function(o,q){var p=h.getCompByEl(q);if(!p){h.ready(function(){var r=h.getCompByEl(q);r.on("beforesubmit",m)})}else{p.on("beforesubmit",m)}})}},render:function(l,k){if(k.indexOf("Redirect:")>-1){window.location=k.substr(9)}else{$("#"+l).append(k)}},init:function(){i()},regUI:function(k,l){var m={};m.selector=k;m.type=l;j.push(m)},getUIReady:function(){return function(p,n){p=p||h.getCurrent();function m(s,r){var q=new Array;s.each(function(t,u){q.push(h.createComp(r,u))});if(r.DATANAME){h.data(r.DATANAME,n?q.concat(h.data(r.DATANAME)):q)}}for(var l=0;l<j.length;l++){var o=j[l];var k=p.find(o.selector);m(k,o.type)}Horn.enterToTab(p)}},enterToTab:function(k){var l=k.find("input:text:visible,input:password:visible");var m=function(p){var n=p.which;if(n==13){p.preventDefault();var o=l.index(this)+1;l.eq(o).focus()}};l.unbind("keydown",m);l.bind("keydown",m)},getDict:function(o,m){if(!h.cachedDicts[o]){var n=$(".hc_checkboxdiv[ref_target="+o+"_s]");if(!n.get(0)){n=$(".hc_checkboxdiv[ref_target="+o+"_m]")}var l=n.find("li"),k={};l.each(function(q,p){p=$(p);var r=p.attr("title");var s=p.attr("value");if(!s){s=p.attr("key")}k[s]=r});c[o]=k;h.cachedDicts[o]=k}if(m){return h.Util.getDicts(o,m)}return c[o]}});h.register(h.getUIReady());$(document).ready(function(){i()});h.Base=function(){this.init.apply(this,arguments)};h.Base=h.extend(h.Base,{COMPONENT_CLASS:"Base",name:null,alias:null,el:null,params:{},REG_FUNCTION_NAME:[],regFuncs:function(l){this.REG_FUNCTION_NAME=this.REG_FUNCTION_NAME.concat(l);var o=this,n=this.el;if(this.REG_FUNCTION_NAME.length!=0){for(var m=0;m<this.REG_FUNCTION_NAME.length;m++){var k=this.REG_FUNCTION_NAME[m];if(typeof k=="string"){n[k]=function(){o[k].apply(o,arguments)}}else{n[k.src]=function(){o[k.tgt].apply(o,arguments)}}}}},regEvents:[],init:function(){this.el=$(arguments[0]);this.alias=this.alias||this.el.attr("alias");this.name=this.name||this.el.attr("name");if(this.el&&this.el.attr("paramcacheid")){if(Horn.paramCaches){this.params=Horn.paramCaches[this.el.attr("paramcacheid")];if(!(this.params)){this.params={}}Horn.debug("Horn.UI["+this.COMPONENT_CLASS+"]:params",this.params)}}if((!this.name)&&this.params&&this.params.name&&!this.el.attr("nonamebyparams")){this.name=this.params.name}if((!this.alias)&&this.params&&this.params.alias){this.alias=this.params.alias}var k;if(this.params&&this.params.name1){k=this.params.name1}this.name=this.name||k||h.id();this.initCompEvnets();this.initStandardEvents();this.el.data("QID",this.getQID())},customEvents:"",initStandardEvents:function(){var l=this.getEventTarget&&this.getEventTarget();var k=this.params&&this.params.events;if(!k||!l||!l.length){return}var m=this;$.each(k,function(p,t){var n=t.event.toLowerCase();if(m.customEvents==""||m.customEvents.indexOf(n)==-1){var q=t["function"]||function(){};var s=null;if($.type(q)==="string"){var r=Horn.Util.getFunObj(q);q=r.fn;s=r.params}if(n.indexOf("on")==0&&$.type(q)==="function"){l.bind(n.substring(2),s,function(v){var o=[];$.each(s,function(w,x){o.push(x)});var u=m;v.comp=u;o.push(v);return q.apply(this,o)})}}})},initCompEvnets:function(){this.events={};if(this.params&&this.params.events){var m=this.params.events;if(!$.isPlainObject(this.params.events)){return}for(var l in m){var k=Horn.Util.getFunObj(m[l]||"");this.on(l,k.fn)}}},getQID:function(){return h.getQID(this.name,this.alias)},events:null,on:function(l,k){if(!this.events[l]){this.events[l]=[]}this.events[l].push(k)},un:function(o,n){var m=this.events[o];if(!m){return}var k=false;for(var l=0;l<m.length;l++){var p=m[l];if(p==n){k=true}if(k&&l<m.length-1){m[l]=m[l+1]}}if(k){m.length-=1}},fire:function(o){var m=this.events[o];if(!m){return true}var k=[];$(arguments).each(function(q,p){if(q!=0){k.push(p)}});for(var l=0;l<m.length;l++){var n=m[l];if(n.apply(this,k)===false){return false}}return true}});$.extend(h.Base,{COMPMENTOBJECT:"COMPMENTOBJECT",getCompByEl:function(n){if(n instanceof Horn.Base){return n}var m=$(n);var l=m.data("comp_el_id");var k=a.data("_el_comp_cache")[l];return k},getCompById:function(l){var k=a.data("_id_comp_cache")[l];if(k){return k}else{return}}});jQuery.fn.comp=function(){return Horn.Base.getCompByEl(this)}})(Horn);