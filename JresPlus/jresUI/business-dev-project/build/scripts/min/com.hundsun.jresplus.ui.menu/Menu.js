Horn.Menu=Horn.extend(Horn.Base,{COMPONENT_CLASS:"menu",id:"menu",baseMenuEl:null,baseMenuItem:null,rootMenu:null,zindexInit:9999,opendir:"R",tier:0,classOneNum:0,init:function(a){Horn.Menu.superclass.init.apply(this,arguments);var b=this;this.classOneNum=this.params.items.length;this.id=this.params.id?this.params.id:this.id;this.el.attr("id",this.id);this.opendir=this.params.opendir?this.params.opendir:this.opendir;this.baseMenuEl=this.el.next();this.baseMenuItem=$("li",this.baseMenuEl);this.recursionItems(this.baseMenuEl,this.params);this.baseMenuEl.appendTo(this.el);$("li[base='']",this.el).remove();this.rootMenu=this.el.children("ul");this.rootMenu.css({"z-index":b.zindexInit-1});$(document).bind("click",function(c){if($(c.target).closest("*[refmenu="+b.id+"]").size()==0&&c.button==0){b.hideMenu()}});if(this.params.isContextMenu){document.oncontextmenu=function(d){d=d||window.event;if(d.button==2||d.type=="contextmenu"){var c=navigator.userAgent;if(navigator.appName!="Microsoft Internet Explorer"){window.event=d}b.showMenu();return false}}}$("*[refmenu="+b.id+"]").click(function(){if(!b.isContextDisabled($(this))){b.reCalOpendir($(this));if(!b.rootMenu.is(":visible")){b.showMenu($(this))}else{b.hideMenu()}}});$("*[refmenu="+b.id+"]").each(function(c,d){$("<i class='fa fa-caret-down'></i>").appendTo($(d));if(d.tagName=="A"||d.tagName=="a"){$(d).css({"text-decoration":"none"})}});$(window).bind("resize",function(){b.hideMenu()});this.el.prependTo($(document.body))},reCalOpendir:function(a){var b;var e={};var d=a.offset().left;var c=150;if(this.tier<4){b=this.tier*c;e.left=b<d+a.width();e.right=b<$(window).width()-d}else{e.left=e.right=true}if(e.left&&e.right||(!e.left&&!e.right)){return}if(this.opendir=="L"&&!e.left){this.opendir="R"}if(this.opendir=="R"&&!e.right){this.opendir="L"}},recursionItems:function(c,d){this.tier++;var f=this;if(d.items){var b=0;while(b<d.items.length){var e=f.processparam(f.baseMenuItem.clone(true).removeAttr("base"),d.items[b]);if(d.items[b].items){f.zindexInit++;var a=f.baseMenuEl.clone(true).css({"z-index":f.zindexInit});a.appendTo(e);f.recursionItems(a,d.items[b])}e.appendTo(c);b++}}},processparam:function(a,b){if(b.tips){$("a",a).attr("title",b.tips)}if(b.hasLine){$("span.h_toolbar-item-txt",a).addClass("h_menu-line")}if(b.event){$("a",a).attr("onclick",b.event)}if(b.icon){$("span.h_toolbar-item-icon",a).html("<img width='20px' src='"+b.icon+"'>")}if(b.label){$("span.h_toolbar-item-txt",a).text(b.label)}if(!b.items){$("span.h_toolbar-item-arrow",a).remove()}return a},showMenu:function(b,c,a){var e=this;if(!c){c=this.rootMenu}var d=this.getShowPosition(b,a);c.css({top:d.Y,left:d.X});c.show();c.children("li").hover(function(){var f=$(this).children("ul");if(f.size()==1){e.showMenu($(this),f,true)}},function(){var f=$(this).children("ul");if(f.size()==1){f.hide()}})},getShowPosition:function(c,d){var g=this;var h=150;var f,i,b,j;if(!c){f=window.event.clientX;i=window.event.clientY;j=0;b=0}else{f=c.offset().left;i=c.offset().top;b=c.outerWidth();j=c.outerHeight()}var e=function(){var k,l;k=-j;if(g.opendir=="R"&&(f+b+h)>$(window).width()||g.opendir=="L"){g.opendir="L";l=-b}if(g.opendir=="L"&&(f-h)<0||g.opendir=="R"){g.opendir="R";l=b}return{X:l,Y:k}};var a=function(){var n,o;var l=g.classOneNum;var m=$(window).height();var k=l*39;if(i+b+k>m){n=i-k}else{n=i+j}if((f+h)>$(window).width()||(g.opendir=="L"&&(f-h)>0)){o=f-h+b;g.opendir="L"}else{o=f}return{X:o,Y:n}};if(d){return e()}else{return a()}},hideMenu:function(){this.rootMenu.hide();this.rootMenu.css({top:1200,left:600});this.opendir=this.params.opendir},addItem:function(b){var a=this.processparam(this.baseMenuItem.clone(true).removeAttr("base"),b);a.appendTo(this.rootMenu)},isContextDisabled:function(a){return a.hasClass("h_btn-disabled")}});Horn.regUI("div.hc_menu",Horn.Menu);