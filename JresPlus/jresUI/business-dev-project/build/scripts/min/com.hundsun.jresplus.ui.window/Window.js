Horn.emptyFn=function(){};(function(d){var b=["DOMMouseScroll","mousewheel"];if(d.event.fixHooks){for(var a=b.length;a;){d.event.fixHooks[b[--a]]=d.event.mouseHooks}}d.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=b.length;e;){this.addEventListener(b[--e],c,false)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var e=b.length;e;){this.removeEventListener(b[--e],c,false)}}else{this.onmousewheel=null}}};d.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}});function c(i){var h=i||window.event,g=[].slice.call(arguments,1),j=0,f=0,e=0;i=d.event.fix(h);i.type="mousewheel";if(h.wheelDelta){j=h.wheelDelta/120}if(h.detail){j=-h.detail/3}e=j;if(h.axis!==undefined&&h.axis===h.HORIZONTAL_AXIS){e=0;f=-1*j}if(h.wheelDeltaY!==undefined){e=h.wheelDeltaY/120}if(h.wheelDeltaX!==undefined){f=-1*h.wheelDeltaX/120}g.unshift(i,j,f,e);return(d.event.dispatch||d.event.handle).apply(this,g)}})(jQuery);Horn.Window=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Window",defConf:{closeable:true,backClickCloseable:false,title:"窗口",width:500,minWidth:250,maxWidth:1000,height:500,minHeight:300,maxHeight:600,scroll:false,isAuto:false},config:{},el:null,isShow:false,backdrop:null,wrapper:null,content:null,header:null,buttonBar:null,beforeClose:null,afterClose:null,beforeCloseFn:function(){return true},afterCloseFn:function(){},init:function(d){Horn.Window.superclass.init.apply(this,arguments);var c=$(d);this.el=c;var f=this;this.config={};this.config=$.extend(this.config,this.defConf);var a=true;if(this.params){$.extend(this.config,this.params||{});if(!isNaN(this.el.attr("h_width"))){this.config.width=this.el.attr("h_width")}else{if(typeof this.el.attr("h_width")=="string"){this.config.width=parseInt(this.el.attr("h_width"))}}if(this.config.width<this.defConf.minWidth){this.config.width=this.defConf.minWidth}if(!isNaN(this.el.attr("h_height"))){this.config.height=this.el.attr("h_height")}else{if(typeof this.el.attr("h_height")=="string"){this.config.height=parseInt(this.el.attr("h_height"))}}if(typeof this.config.closeable=="string"){if(this.config.closeable=="true"){this.config.closeable=true}else{if(this.config.closeable=="false"){this.config.closeable=false}else{this.config.closeable=this.defConf.closeable}}}if(typeof this.config.closeable!="boolean"){this.config.closeable=this.defConf.closeable}if(this.config.beforeClose){this.beforeClose=this.config.beforeClose;var i=Horn.Util.getFunObj(this.beforeClose);if($.type(i.fn)=="function"){this.beforeCloseFn=i.fn}}if(this.config.afterClose){this.afterClose=this.config.afterClose;var e=Horn.Util.getFunObj(this.afterClose);if($.type(e.fn)=="function"){this.afterCloseFn=e.fn}}if(this.params.isDrag==false){a=false}}this.content=c.children(".h_floatdiv-con");this.header=c.children(".m-message-header").children(".h_floatdiv-title");this.buttonBar=c.children(".h_btndiv");if(this.buttonBar.length==0){this.buttonBar=undefined}if(this.buttonBar||true==this.config.scroll||"true"==this.config.scroll){this.config.scroll=true}this.backdrop=$("<div class='h_floatdiv-backdrop'></div>");var g=$("<div></div>");g.append(this.backdrop);g.append(this.el);this.wrapper=g;$(document.body).append(g);g.hide();if(this.config.width){c.css("width",this.config.width+"px")}if(this.config.height){c.css("height",this.config.height+"px")}var h=this.header.children("a");if(this.config.closeable){h.bind("click",function(){f.hide()})}else{h.hide()}if(this.config.autoShow){this.show()}if(this.config.backClickCloseable){this.backdrop.click(function(){f.hide()})}$(window).resize(function(){if(f.isShow&&!f.maximum){f.resize()}});if(a){var b=this.el.attr("id");this.windowDrag(b)}},windowDrag:function(h){$("#"+h).drag({handle:".mod_tt",beforedrag:function(k,i){currentDrag=i;flag=false;$("#opacitynode").remove();var j=i[0];k.x=g(j)+10;k.y=e(j);i.before(b(j)).css({position:"absolute",left:k.x+"px",top:k.y+"px"})},ondraging:function(l,j){var k=null;if(k!=null){if(k!==ele){var i=$(k);i.after(b(k))}}else{}},enddrag:function(m,i){var k=i[0];var j=$("#opacitynode");i.css({position:""});var l=document.createDocumentFragment();l.appendChild(k);j.before(l);l=null;j.hide();flag=true},unselectClass:"unselect",xdrag:true,ydrag:true}).find(".mod_tt").css({cursor:"move"});var g=function(j){var i=0;while(j!==null){i+=j.offsetLeft;j=j.offsetParent}return i},e=function(j){var i=0;while(j!==null){i+=j.offsetTop;j=j.offsetParent}return i},b=function(k){var j=f("div");$(j).attr({id:"opacitynode"});var i=a?k.offsetHeight-2:k.offsetHeight;$(j).css({height:k.offsetHeight+"px",lineHeight:k.offsetHeight+"px"});return j};var d=function(j){var i=0;while(j!==null){i+=j.offsetLeft;j=j.offsetParent}return i},c=function(j){var i=0;while(j!==null){i+=j.offsetTop;j=j.offsetParent}return i},f=function(i){return document.createElement(i)},a=(function(i){return/msie 6/.test(i)})(navigator.userAgent.toLowerCase())},setMaximum:function(a){this.maximum=a},resize:function(j,r){var d=$(window),b=this.el,o=0,i=0;var e=$(".h-overflow-auto").scrollTop();if(e!=null&&e!=0){$(".h-overflow-auto").scrollTop(0)}var m=d.height();var c=d.width();var f=this.config.height;var l=this.config.width;if(j){l=j}if(r){f=r}var q=l;var g=f;o=m-f;i=c-l;if(o<38){o=38;g=m-38}if(i<38){i=38;q=c-38}var n=o/2+$(document).scrollTop();var s=i/2+$(document).scrollLeft();this.backdrop.css({top:$(document).scrollTop(),left:$(document).scrollLeft()});this.el.css({top:n,left:s});if(this.params.isAuto!=false){this.backdrop.css({height:$(window).height(),width:$(window).width()});var a=this.el.find(".h_floatdiv-con").outerHeight();var p=this.el.find(".h_floatdiv-con").width();var t=this.el.find(".h_floatdiv-title").outerHeight();var k=(this.params.scroll==true)?true:false;this.el.css({width:q,height:g});this.el.children("div.h_floatdiv-con").css({height:g-37})}},resetSizeWin:function(a,b){this.resize(a,b)},show:function(a){if(!$("body").hasClass("h-overflow-hidden")){}if(!$("html").hasClass("h-overflow-hidden")){$("html").addClass("h-overflow-hidden")}Horn.Window.getNextOpen();this.wrapper.show();this.backdrop.css("width","100%").css("height","100%").css("z-index",Horn.Window.getNextZIndex());this.el.css({"z-index":Horn.Window.getNextZIndex()});this.el.show();this.resize();this.isShow=true;var b=this.el.height()-this.header.outerHeight()+1;if(this.params.height){b=this.params.height-this.header.outerHeight()}if(this.buttonBar){b=b-this.buttonBar.outerHeight()}if(this.config.scroll){this.el.css("height","auto");this.content.css({padding:0,margin:0,border:0,height:b}).addClass("h-overflow-auto")}else{this.el.mousewheel(function(){return false});this.content.css({padding:0,margin:0,border:0,height:b}).addClass("h-overflow-hidden")}},hide:function(){if(this.beforeCloseFn.call()){if($("body").hasClass("h-overflow-hidden")){$("body").removeClass("h-overflow-hidden")}if($("html").hasClass("h-overflow-hidden")){$("html").removeClass("h-overflow-hidden")}this.wrapper.hide();this.isShow=false;this.afterCloseFn.call()}if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-2}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-2}},setTitle:function(a){this.el.children(".m-message-header").children("h4").text(a);this.el.children(".m-message-header").children("h4").attr("title",a)}});$.extend(Horn.Window,{DATANAME:"h_window",MAX_ZINDEX:100,OPENED:0,getNextOpen:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.OPENED++}else{Horn.Window.OPENED++;return Horn.Window.OPENED}},getPrevOpen:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.OPENED--;return top.Horn.Window.OPENED}else{Horn.Window.OPENED--;return Horn.Window.OPENED}},getOpen:function(){if(top.Horn&&top.Horn.Window){return top.Horn.Window.OPENED}else{return Horn.Window.OPENED}},getNextZIndex:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX++;return top.Horn.Window.MAX_ZINDEX}else{Horn.Window.MAX_ZINDEX++;return Horn.Window.MAX_ZINDEX}},get:function(b){var a=Horn.data(Horn.Window.DATANAME);var c=a[b];return c}});Horn.regUI("div.h_floatdiv",Horn.Window);