var Horn=Horn||{debug_:false,fixed_:true,debug:function(b,a){if(Horn.debug_&&typeof console!="undefined"&&typeof console.log!="undefined"){console.log(b,a)}}};(function(h){var e=null,a=null;var g=0;var d=[],f=[];var j=[];var c={};h.cachedDicts={};h.apply=function(m,n,l){if(l){h.apply(m,l)}if(m&&n&&typeof n=="object"){for(var k in n){m[k]=n[k]}}return m};function b(){var k=$('<div style="display:none;position:fixed;z-index:100;"></div>');$("body").append(k);return k.css("position")=="fixed"}function i(){Horn.fixed_=b();Horn.debug("Horn.init","regist...");for(var l=0;l<f.length;l++){f[l]()}Horn.debug("Horn.init","ready...");while(d.length>0){var k=d.shift();k()}}h.apply(h,{id:function(k){if(!k){k="horn-comp-"}return k+(g++)},extend:(function(){var l=function(p){for(var n in p){this[n]=p[n]}};var k=Object.prototype.constructor;return function(r,o,q){if(typeof o=="object"){q=o;o=r;r=q.constructor!=k?q.constructor:function(){o.apply(this,arguments)}}var n=function(){},p,m=o.prototype;n.prototype=m;p=r.prototype=new n();p.constructor=r;r.superclass=m;if(m.constructor==k){m.constructor=o}r.override=function(s){h.override(r,s)};p.superclass=p.supr=(function(){return m});p.override=l;h.override(r,q);r.extend=function(s){return h.extend(r,s)};return r}})(),override:function(k,m){if(m){var l=k.prototype;h.apply(l,m)}},getCurrent:function(){if(e){return e}return $(document.body)},setCurrent:function(k){if(k){e=k}},createComp:function(l,k){if(typeof l=="function"){var m=new l(k);if(m instanceof h.Base){this.data(m);return m}}return null},_guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var l=Math.random()*16|0,k=m=="x"?l:(l&3|8);return k.toString(16)})},data:function(n,l){if(!a){var o=this.getCurrent().find("form");if(o.length>0){a=o.first()}else{a=this.getCurrent()}}if($.type(n)=="object"){if(!a.data("_id_comp_cache")){a.data("_id_comp_cache",{})}if(!a.data("_el_comp_cache")){a.data("_el_comp_cache",{})}var k=a.data(n.getQID());if(!k){k=new Array()}k.push(n);if(k.length>1){Horn.debug("出现重复组件名：",n.getQID())}if(n.params&&n.params.id&&n.params.id!=""){a.data("_id_comp_cache")[n.params.id]=n}if(n.el){var m=this._guid();n.el.data("comp_el_id",m);a.data("_el_comp_cache")[m]=n}return a.data(n.getQID(),k)}else{if($.type(n)=="string"&&l){return a.data(n,l)}else{if($.type(n)=="string"&&!l){return a.data(n)}}}return a.data()},getQID:function(k,l){return k+"$"+(l||"_")},getComp:function(m,l){var k=this.data(this.getQID(m,l));if(!k){return}for(var n=0;n<k.length;n++){if(k[n].params.id&&k[n].params.id!=""){return k[n]}}return k[k.length-1]},getCompByEl:function(k){return h.Base.getCompByEl(k)},register:function(k){f.push(k)},ready:function(k){d.push(k)},getCompById:function(k){return Horn.Base.getCompById(k)},submitHandler:function(m,l){var n=$.type(l)=="string"?this.getComp(l):l;if(n&&n instanceof h.Base){n.on("beforesubmit",m)}else{var k=h.getCurrent().find("form");k.each(function(o,q){var p=h.getCompByEl(q);if(!p){h.ready(function(){var r=h.getCompByEl(q);r.on("beforesubmit",m)})}else{p.on("beforesubmit",m)}})}},render:function(l,k){if(k.indexOf("Redirect:")>-1){window.location=k.substr(9)}else{$("#"+l).append(k)}},init:function(){i()},regUI:function(k,l){var m={};m.selector=k;m.type=l;j.push(m)},getUIReady:function(){return function(p,n){p=p||h.getCurrent();function m(s,r){var q=new Array;s.each(function(t,u){q.push(h.createComp(r,u))});if(r.DATANAME){h.data(r.DATANAME,n?q.concat(h.data(r.DATANAME)):q)}}for(var l=0;l<j.length;l++){var o=j[l];var k=p.find(o.selector);m(k,o.type)}}},enterToTab:function(k){var l=k.find("input:text:visible,input:password:visible");var m=function(p){var n=p.which;if(n==13){p.preventDefault();var o=l.index(this)+1;l.eq(o).focus()}};l.unbind("keydown",m);l.bind("keydown",m)},getDict:function(o,m){if(!h.cachedDicts[o]){var n=$(".hc_checkboxdiv[ref_target="+o+"_s]");if(!n.get(0)){n=$(".hc_checkboxdiv[ref_target="+o+"_m]")}var l=n.find("li"),k={};l.each(function(q,p){p=$(p);var r=p.attr("title");var s=p.attr("value");if(!s){s=p.attr("key")}k[s]=r});c[o]=k;h.cachedDicts[o]=k}if(m){return h.Util.getDicts(o,m)}return c[o]}});h.register(h.getUIReady());$(document).ready(function(){i()});h.Base=function(){this.init.apply(this,arguments)};h.Base=h.extend(h.Base,{COMPONENT_CLASS:"Base",name:null,alias:null,el:null,params:{},REG_FUNCTION_NAME:[],regFuncs:function(l){this.REG_FUNCTION_NAME=this.REG_FUNCTION_NAME.concat(l);var o=this,n=this.el;if(this.REG_FUNCTION_NAME.length!=0){for(var m=0;m<this.REG_FUNCTION_NAME.length;m++){var k=this.REG_FUNCTION_NAME[m];if(typeof k=="string"){n[k]=function(){o[k].apply(o,arguments)}}else{n[k.src]=function(){o[k.tgt].apply(o,arguments)}}}}},regEvents:[],init:function(){this.el=$(arguments[0]);this.alias=this.alias||this.el.attr("alias");this.name=this.name||this.el.attr("name");if(this.el&&this.el.attr("paramcacheid")){if(Horn.paramCaches){this.params=Horn.paramCaches[this.el.attr("paramcacheid")];if(!(this.params)){this.params={}}Horn.debug("Horn.UI["+this.COMPONENT_CLASS+"]:params",this.params)}}if((!this.name)&&this.params&&this.params.name&&!this.el.attr("nonamebyparams")){this.name=this.params.name}if((!this.alias)&&this.params&&this.params.alias){this.alias=this.params.alias}var k;if(this.params&&this.params.name1){k=this.params.name1}this.name=this.name||k||h.id();this.initCompEvnets();this.initStandardEvents();this.el.data("QID",this.getQID())},customEvents:"",initStandardEvents:function(){var l=this.getEventTarget&&this.getEventTarget();var k=this.params&&this.params.events;if(!k||!l||!l.length){return}var m=this;$.each(k,function(p,t){var n=t.event.toLowerCase();if(m.customEvents==""||m.customEvents.indexOf(n)==-1){var q=t["function"]||function(){};var s=null;if($.type(q)==="string"){var r=Horn.Util.getFunObj(q);q=r.fn;s=r.params}if(n.indexOf("on")==0&&$.type(q)==="function"){l.bind(n.substring(2),s,function(v){var o=[];$.each(s,function(w,x){o.push(x)});var u=m;v.comp=u;o.push(v);return q.apply(this,o)})}}})},initCompEvnets:function(){this.events={};if(this.params&&this.params.events){var m=this.params.events;if(!$.isPlainObject(this.params.events)){return}for(var l in m){var k=Horn.Util.getFunObj(m[l]||"");this.on(l,k.fn)}}},getQID:function(){return h.getQID(this.name,this.alias)},events:null,on:function(l,k){if(!this.events[l]){this.events[l]=[]}this.events[l].push(k)},un:function(o,n){var m=this.events[o];if(!m){return}var k=false;for(var l=0;l<m.length;l++){var p=m[l];if(p==n){k=true}if(k&&l<m.length-1){m[l]=m[l+1]}}if(k){m.length-=1}},fire:function(o){var m=this.events[o];if(!m){return true}var k=[];$(arguments).each(function(q,p){if(q!=0){k.push(p)}});for(var l=0;l<m.length;l++){var n=m[l];if(n.apply(this,k)===false){return false}}return true}});$.extend(h.Base,{COMPMENTOBJECT:"COMPMENTOBJECT",getCompByEl:function(n){if(n instanceof Horn.Base){return n}var m=$(n);var l=m.data("comp_el_id");var k=a.data("_el_comp_cache")[l];return k},getCompById:function(l){var k=a.data("_id_comp_cache")[l];if(k){return k}else{return}}});jQuery.fn.comp=function(){return Horn.Base.getCompByEl(this)}})(Horn);
var Horn=Horn||{};(function(H){Horn.Util={dictCache:{},apply:function(fn,scope){return(function(){return fn.apply(scope,arguments)})},getFunObj:function(event){if(event==""||!event){return{}}var name=event;var params=[];if(event.indexOf("(")>-1){name=event.substring(0,event.indexOf("("));var ps=event.substring(event.indexOf("(")+1,event.indexOf(")")).split(",");for(var i=0;i<ps.length;i++){if(ps[i]){params.push(eval("("+ps[i]+")"))}}}return{fn:eval("(window."+name+")"),params:params}},stopPropagation:function(e){if(e&&e.stopPropagation){e.stopPropagation()}else{window.event.cancelBubble=true}},obj2Arr:function(obj){var arr=[];if($.type(obj)=="object"){for(var i in obj){if("string,number,boolean".indexOf($.type(obj[i]))>-1){arr.push({name:i,value:obj[i]})}}}return arr},arr2Obj:function(serValues){var values={};for(var i=0;i<serValues.length;i++){var name=serValues[i]["name"];var value=serValues[i]["value"];if(values[name]!==undefined&&values[name]!==""&&values[name]!==null){values[name]=values[name]+"";if(values[name]){values[name]=values[name]+","+value}else{values[name]=value}}else{values[name]=value}}return values},getValues:function(form){var serValues=$(form).serializeArray();var values=this.arr2Obj(serValues);return values},encode:function(object){return(function(){var _this=this;if(_this===null||_this===undefined){return""}if(_this instanceof Function||_this instanceof RegExp){return _this.toString()}if(_this instanceof String){return'"'+_this.toString()+'"'}if(_this instanceof Boolean||_this instanceof Number){return _this.toString()}if(_this instanceof Date){return _this.getTime()}if(_this instanceof Object||_this instanceof Array){var tempArr=new Array;if(_this instanceof Array){for(var i=0;i<_this.length;i++){tempArr.push(arguments.callee.call(_this[i]))}}else{for(var fieldname in _this){if(_this[fieldname]==null||_this[fieldname]==undefined){tempArr.push(arguments.callee.call(fieldname)+':""');continue}if(jQuery.type(_this[fieldname])=="function"||jQuery.type(_this[fieldname])=="regexp"){continue}if(_this[fieldname] instanceof Object){tempArr.push(arguments.callee.call(fieldname)+":"+arguments.callee.call(_this[fieldname]));continue}tempArr.push(arguments.callee.call(fieldname)+":"+arguments.callee.call(_this[fieldname]))}}var retString=tempArr.join("");if(_this instanceof Array){retString="["+tempArr.join(",")+"]"}else{retString="{"+tempArr.join(",")+"}"}return retString}else{return _this.toString()}}).call(object)},decode:function(string){return jQuery.parseJSON(string)},getParamValue:function(name){var value=location.search.match(new RegExp("[?&]"+name+"=([^&]*)(&?)","i"));return value?value[1]:value},loadBp:function(d,url,data,method,callback){function render(obj,bp){obj.children().remove();BigPipe.onArrive(bp);BigPipe.start();H.getUIReady()(obj);if(callback){callback.call(obj,obj,bp)}}data=data||{};var id=d;var dom=d;if(typeof d=="object"){dom=$(d);if(!dom.attr("id")){dom.attr("id",H.id())}id=dom.attr("id")}else{if(typeof d=="string"){dom=$("#"+id)}else{return}}url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+id;if(url.indexOf("http")==-1){url=context_path+url}if(method=="get"){$.get(url,data,function(result){render(dom,eval("("+result+")"))})}else{$.post(url,data,function(result){render(dom,eval("("+result+")"))})}},serializeObject:function(param){function serArray(per,p){var arr=per[p];for(var i=0;i<arr.length;i++){var obj=arr[i];for(var prop in obj){if("string,boolean,number".indexOf(jQuery.type(obj[prop]))>-1){per[p+"["+i+"]."+prop]=obj[prop]}}}}if(param&&typeof param=="object"){for(var p in param){if(jQuery.type(param[p])=="array"){serArray(param,p);delete param[p]}}}return param},loadCss:function(url){BigPipe.onArrive({html:"",id:H.id(),css:[url],js:[],jsCode:""})},loadScript:function(url){BigPipe.onArrive({html:"",id:H.id(),css:[],js:[url],jsCode:""});BigPipe.start()},jump:function(url,reload){if(Horn.TabScreen){this.loadBp(Horn.getCurrent(),url,{},"get")}else{if(reload){url=(url.indexOf("?")===-1?url+"?":url+"&")+"_="+new Date().getTime()}window.location=url}},getDicts:function(dictName,keys){Horn.Util.dictCache=Horn.cachedDicts;if(!Horn.Util.dictCache[dictName]){Horn.getDict(dictName);Horn.Util.dictCache=Horn.cachedDicts}if(keys){if(keys.indexOf(",")!=-1){var ks=keys.split(",");var values="";$.each(ks,function(i,key){if(key){values+=","+Horn.Util.dictCache[dictName][key]}});return values&&(values.indexOf(",")!=-1?values.substring(1):values)}else{return Horn.Util.dictCache[dictName][keys]}}else{return Horn.Util.dictCache[dictName]}}}})(Horn);String.prototype.toCharArray=function(){return this.split("")};String.prototype.repeat=function(b){var a=[];for(var c=0;c<b;c++){a.push(this)}return a.join("")};String.prototype.reverse=function(){return this.split("").reverse().join("")};String.prototype.isNumeric=function(){var b=parseFloat(this);if(isNaN(b)){return false}var a=this.length-b.toString().length;return b+"0".Repeat(a)==this};String.prototype.isInt=function(){if(this=="NaN"){return false}return this==parseInt(this).toString()};String.prototype.resetBlank=function(){return this.replace(/\s+/g," ")};String.prototype.ltrim=function(){return this.replace(/^\s+/g,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/g,"")};String.prototype.trim=function(){return this.replace(/(^\s+)|(\s+$)/g,"")};String.prototype.getNum=function(){return this.replace(/[^\d]/g,"")};String.prototype.getEn=function(){return this.replace(/[^A-Za-z]/g,"")};String.prototype.getCn=function(){return this.replace(/[^\u4e00-\u9fa5\uf900-\ufa2d]/g,"")};String.prototype.getRealLength=function(){return this.replace(/[^x00-xff]/g,"--").length};String.prototype.left=function(a){return this.slice(0,a)};String.prototype.right=function(a){return this.slice(this.length-a)};String.prototype.HTMLEncode=function(){var c=this;var a=[/x26/g,/x3C/g,/x3E/g,/x20/g];var d=["&","<",">"," "];for(var b=0;b<a.length;b++){c=c.replace(a[b],d[b])}return c};String.prototype.ascW=function(){var a="";for(var b=0;b<this.length;b++){a+="&#"+this.charCodeAt(b)+";"}return a};String.prototype.firstUp=function(){return this.replace(/(^|\s+)\w/g,function(a){return a.toUpperCase()})};String.leftPad=function(c,b,a){if(!c){return c}if(b!==undefined&&b!==""&&a>0){c=c+"";b=b+"";while(c.length<a){c=b+c}}return c};if(!Array.indexOf){Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++){if(this[b]==a){return b}}return -1}};
var Horn=Horn||{};(function(a){Horn.Tip=new (function(){function b(d,c){d.click(function(){$(this).remove()});$(d).delay(2000).fadeOut(c)}this.init=function(c){var d=$("div.h_tips");var e=d.children("div").first();b(e,c?c:Horn.Tip.AUTO_HIDE_DELAY_SEC)};this.clear=function(){var c=$("div.h_tips");c.children("div:hidden").remove()};this.addTip=function(h,k){if(arguments.length==1){return this.addTip(Horn.Tip.TYPES.INFO,h)}var g="";if(h==Horn.Tip.TYPES.INFO){g=Horn.Tip.CSS.INFO}else{if(h==Horn.Tip.TYPES.WARNING){g=Horn.Tip.CSS.WARNING}else{if(h==Horn.Tip.TYPES.SUCCESS){g=Horn.Tip.CSS.SUCCESS}}}var i=$("div.h_tips");var f=false;if(i.length==0){f=true;i=$('<div class="h_tips"></div>');i.appendTo($(document.body))}if(k){var d="";if(f){if(Horn.fixed_){i.css("position","fixed")}}if(!f){}var e=g.split(";");var c=e[0];var j=e[1];i.prepend($('<div class="m-tip-box '+c+'" '+d+'><span><i class="fa '+j+'"></i></span> '+k+"</div>"))}};this.addTips=function(d,e){if(arguments.length==1){return this.addTips(Horn.Tip.TYPES.INFO,d)}if(e&&e.length){for(var c=0;c<e.length;c++){this.addTip(d,e[c])}}}});Horn.apply(Horn.Tip,{TYPES:{INFO:"C",WARNING:"W",SUCCESS:"S"},CSS:{INFO:"m-tip-warning;fa-exclamation",WARNING:"m-tip-error;fa-close",SUCCESS:"m-tip-success;fa-check"},AUTO_HIDE_DELAY_SEC:500,info:function(c,b){this.show(this.TYPES.INFO,c,b)},warn:function(c,b){this.show(this.TYPES.WARNING,c,b)},success:function(c,b){this.show(this.TYPES.SUCCESS,c,b)},show:function(c,d,b){this.clear();this.addTip(c,d);this.init(b)},shows:function(d,b){this.clear();if(d&&d.length){for(var c=0;c<d.length;c++){this.addTip(d[c].type,d[c].message)}}this.init(b)}});Horn.register(Horn.Tip.init)})(Horn);
Horn.Util.Format={Patterns:{YEAR:/y/g,MONTH:/M/g,DAY:/d/g,HOUR:/H/g,MINUTE:/m/g,SECOND:/s/g,MILSECOND:/f/g},FormatPatterns:function(format){return eval("/"+format.replace(this.Patterns.YEAR,"[0-9]").replace(this.Patterns.MONTH,"[0-9]").replace(this.Patterns.DAY,"[0-9]").replace(this.Patterns.HOUR,"[0-9]").replace(this.Patterns.MINUTE,"[0-9]").replace(this.Patterns.SECOND,"[0-9]").replace(this.Patterns.MILSECOND,"[0-9]")+"/g")},DateISO:function(a,c){var b="";if(a==""||c==""){return false}b=this.FormatPatterns(c);return b.test(a)},number:function(q,o){if(!o){return q}q=Number(q===null||typeof q=="boolean"?NaN:q);if(isNaN(q)){return""}var s=",",f=".",r=false,g=q<0;q=Math.abs(q);if(o.substr(o.length-2)=="/i"){o=o.substr(0,o.length-2);r=true;s=".";f=","}var b=o.indexOf(s)!=-1,a=(r?o.replace(/[^\d\,]/g,""):o.replace(/[^\d\.]/g,"")).split(f);if(1<a.length){q=q.toFixed(a[1].length)}else{if(2<a.length){throw ("NumberFormatException: invalid format, formats should have no more than 1 period: "+o)}else{q=q.toFixed(0)}}var p=q.toString();if(b){a=p.split(".");var l=a[0],e=[],h=l.length,d=Math.floor(h/3),c=l.length%3||3;for(var k=0;k<h;k+=c){if(k!=0){c=3}e[e.length]=l.substr(k,c);d-=1}p=e.join(s);if(a[1]){p+=f+a[1]}}return(g?"-":"")+o.replace(/[\d,?\.?]+/,p)},date:function(g,a){var c=g;if((typeof g)=="string"){g=g.trim();var d=g;var f=function(h){h=h||"";if(h.indexOf("/")==-1&&h.indexOf("-")==-1){return h.substring(0,4)+"/"+h.substring(4,6)+"/"+h.substring(6)||""}return h.replace(/\D+/g,"/")};g=f(g);var e=g.split("/");while(e.length<3){e.push("01")}g=e.join("/")}var b=new Date(g)=="Invalid Date"?new Date(Number(c)):new Date(g);if(b=="Invalid Date"||isNaN(b)){return d}else{return b.format(a)}},all:function(b,c,d){if(b=="DATE"){if(c==null||c==undefined||c.length==0){c="yyyy-MM-dd HH:mm:ss"}var a=Horn.Util.Format.date(d,c);return a}else{if(b=="AMOUNT"){if(c==null||c==undefined||c.length==0){c="0,000.00"}return Horn.Util.Format.number(d,c)}else{return d}}},validateFmt:function(f,b){var a="^\\d{4}\\d{1,2}\\d{1,2}$";var e=true;if(b){if(b.length>10){e=Horn.Util.Format.DateISO(f,b)}else{if(b.length>8){var d=b.charAt(4);var c=b.charAt(7);var a="^\\d{4}"+d+"\\d{1,2}"+c+"\\d{1,2}$";e=(new RegExp(a)).test(f)}else{e=(new RegExp(a)).test(f)}}}else{e=false}return e}};Date.prototype.format=function(a){var d={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var c={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in d){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(d[b]):(("00"+d[b]).substr((""+d[b]).length)))}}return a};

Horn.Validate={REQUIRED:"required",CHECK:"check",CHECKSEP:";",init:function(b){var a=Horn.getCurrent();if(b){a=$(b)}else{a=a.find("form")}var c=this},isFormValidate:function(l,d){if(arguments.length==1){if(typeof arguments[0]=="boolean"){return this.isFormValidate(null,arguments[0])}}var i=Horn.Validate;var a=null;if($(this).length>0&&$(this).prop("tagName")){a=$(this)}else{if($(l).length>0&&$(l).prop("tagName")){a=$(l)}else{a=Horn.getCurrent().find("form")}}var e=a.find("div.h_formgridtitle").nextAll("ul.h_panel");var g=Horn.Field.findFieldsIn(e);var h=Horn.Field.findFieldsIn(a).not(g);var k=true;var c=[];setTimeout(function(){i.removeError(g)},100);var f;h.each(function(m,n){var o=Horn.getCompByEl(n);o.validate();if(!o.isValid()){if(!f){f=o}k=false;if(d!=undefined){c.push(o.name)}}});if(f){var j=f.getEventTarget();if(f instanceof Horn.CalendarGroup){var b=f.getInValidEle();if(b){b.focus()}}else{if(f instanceof Horn.Combox||f instanceof Horn.Select||f instanceof Horn.Calendar){j.data("isFromOuter",true);j.blur()}else{j.focus()}}f=null}if(k===false){return d?c:false}return k},validateAreaByGroup:function(d,c){var a=Horn.Field.findFieldsIn(d);var b=true;a.each(function(e,f){var g=Horn.getCompByEl(f);if(g&&g.inGroup(c)){g.validate();if(!g.isValid()){b=false}}});return b},onValid:function(d){var g=d.data[0];var a=d.data[1];var c=a.field;var b=c.prev("input[type='hidden']").size()>0?c.prev():c;var f=g.getRules.call(g,b);if(f&&f.length>0&&c.attr("disabled")==undefined){g.isValide.call(g,f,a,b.val())}else{g.removeError.call(g,a)}},regexEnum:{intege:"^-?[1-9]\\d*$|^0$",intege1:"^[1-9]\\d*$",intege2:"^-[1-9]\\d*$",num:"^([+-]?)\\d*\\.?\\d*$",num1:"^[1-9]\\d*|0$",num2:"^-[1-9]\\d*|0$",decmal:"^([+-]?)\\d*\\.\\d+$",decmal1:"^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*$",decmal2:"^-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*)$",decmal3:"^-?([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0)$",decmal4:"^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0$",decmal5:"^(-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*))|0?.0+|0$",email:"^(\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+){0,1}$",color:"^[a-fA-F0-9]{6}$",url:"^http[s]?:\\/\\/([\\w-]+\\.)+[\\w-]+([\\w-./?%&=]*)?$",chinese:"^[\\u4E00-\\u9FA5\\uF900-\\uFA2D]+$",ascii:"^[\\x00-\\xFF]+$",zipcode:"^\\d{6}$",mobile:"^(13|15|18|17)[0-9]{9}$",ip4:"^(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)$",notempty:"^\\S+$",picture:"(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$",rar:"(.*)\\.(rar|zip|7zip|tgz)$",date:"^\\d{4}\\d{1,2}\\d{1,2}$",qq:"[1-9][0-9]{4,11}",tel:"^(([0\\+]\\d{2,3}-)?(0\\d{2,3})-)?(\\d{7,8})(-(\\d{3,}))?$",username:"^\\w+$",letter:"^[A-Za-z]+$",letter_u:"^[A-Z]+$",letter_l:"^[a-z]+$",required:"^\\s*\\S[\\S\\s]*$",Message:"输入格式不正确",integeMessage:"输入的不是整数格式",intege1Message:"输入的不是正整数格式",intege2Message:"输入的不是负整数格式",requiredMessage:"当前输入不能为空",emailMessage:"邮件地址不正确",zipcodeMessage:"邮编输入格式不正确",dateMessage:"日期格式不正确",qqMessage:"QQ号码格式不正确",telMessage:"电话号码格式不正确",mobileMessage:"移动电话格式不正确",decmalMessage:"只能输入浮点数格式",decmal1Message:"只能输入正浮点数格式",decmal2Message:"只能输入负浮点数格式",decmal3Message:"只能输入浮点数格式",decmal4Message:"只能输入非负浮点数格式",decmal5Message:"只能输入非正浮点数格式",colorMessage:"只能输入颜色格式",urlMessage:"只能输入url格式",chineseMessage:"只能输入中文格式",asciiMessage:"只能输入ACSII字符格式",ip4Message:"只能输入ip4地址格式",pictureMessage:"只能输入图片格式",rarMessage:"只能输入压缩文件格式",numMessage:"只能输入数字格式",num1Message:"只能输入正数数字格式",num2Message:"只能输入负数数字格式",letterMessage:"只能输入字母格式",letter_uMessage:"只能输入大写字母格式",letter_lMessage:"只能输入小写字母格式",usernameMessage:"只能输入由数字、26个英文字母或者下划线组成的字符串"},funcEnum:{range:function(c,b,a){if(b!==undefined){if(c<b){return false}}if(a!==undefined){if(c>a){return false}}return true},rangeMessage:"{0}不在{1}-{2}范围内",compare:function(b,a){var c=Horn.Field.getField(a);if(c.val()!=b){return false}return true},compareMessage:"校验不匹配",length:function(c,b,a){if(c){if(c.length>a||c.length<b){return false}}return true},lengthMessage:"输入的长度{1}-{2}字符之间",past:function(e){var g=new Date();var c=g.getFullYear(),f=String.leftPad(g.getMonth()+1+"","0",2),b=String.leftPad(g.getDate()+"",2,"0");var a=c+""+f+""+b;if(e){if(e>=a){return false}}return true},pastMessage:"输入的日期{0}必须小于当前日期",future:function(e){var g=new Date();var c=g.getFullYear(),f=String.leftPad(g.getMonth()+1+"","0",2),b=String.leftPad(g.getDate()+"","0",2);var a=c+""+f+""+b;if(e){if(e<=a){return false}}return true},futureMessage:"输入的日期{0}必须大于当前日期",idcard:function(g){var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};function f(k){var j=k;if(j===""){return false}if(e(j)===false){return false}if(c(j)===false){return false}if(i(j)===false){return false}if(d(j)===false){return false}return true}function e(j){var k=/(^\d{15}$)|(^\d{17}(\d|X)$)/;if(k.test(j)===false){return false}return true}function c(k){var j=k.substr(0,2);if(b[j]==undefined){return false}return true}function i(j){var k=j.length;if(k=="15"){var r=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;var m=j.match(r);var n=m[2];var l=m[3];var o=m[4];var p=new Date("19"+n+"/"+l+"/"+o);return a("19"+n,l,o,p)}if(k=="18"){var q=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;var m=j.match(q);var n=m[2];var l=m[3];var o=m[4];var p=new Date(n+"/"+l+"/"+o);return a(n,l,o,p)}return false}function a(m,p,j,n){var k=new Date();var l=k.getFullYear();if(n.getFullYear()==m&&(n.getMonth()+1)==p&&n.getDate()==j){var o=l-m;if(o>=0&&o<=120){return true}return false}return false}function d(n){n=h(n);var k=n.length;if(k=="18"){var m=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var p=0,o,l;for(o=0;o<17;o++){p+=n.substr(o,1)*m[o]}l=j[p%11];if(l==n.substr(17,1)){return true}return false}return false}function h(l){if(l.length=="15"){var k=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var n=0,m;l=l.substr(0,6)+"19"+l.substr(6,l.length-6);for(m=0;m<17;m++){n+=l.substr(m,1)*k[m]}l+=j[n%11];return l}return l}return f(g)},idcardMessage:"{0}身份证格式不正确",Message:"{0}验证未通过"},applyString:function(a,b){return a.replace(/\{(\d+)\}/g,function(c,d){return b[d]})},isValide:function(rules,display,value){var _this=this;if(!rules){alert("fun.isValide 方法校验规则为空，请检查");return false}var ruleTypes="string,array,function";if(ruleTypes.indexOf($.type(rules))==-1){alert("fun.isValide 方法校验规则类型不正确，应为："+ruleTypes);return false}var isValid=true;if((typeof rules)=="string"){rules=[{name:rules,params:[value]}]}if((typeof rules)=="function"){rules=[{name:rules,params:[value]}]}for(var index=0;index<rules.length;index++){var item=rules[index];var name=item.name;var format=item.format;if(format=="yesConfig"){return}if(name===undefined||name===""){return"name 校验规则为空请检查"}if(name!="required"&&!value){continue}var msg="";if(this.regexEnum[name]){isValid=(new RegExp(this.regexEnum[name],item.regexparam)).test(value);msg=item.message||this.regexEnum[name+"Message"]||this.regexEnum.Message}else{if(this.funcEnum[name]){isValid=this.funcEnum[name].apply(display,item.params);msg=item.message||this.funcEnum[name+"Message"]||this.funcEnum.Message}else{if($.type(eval(name))=="function"){var tArr=item.params.slice(0);isValid=eval(name).apply(display,tArr);msg=isValid}else{alert("错误的校验类型");return false}}}if(isValid!==true){var params=item.params;msg=($.type(msg)=="boolean"||!msg)?msg:_this.applyString.apply(value,[msg,params]);_this.addError.call(_this,display,msg);return msg}}if(display.isValid!=Horn.Field.prototype.isValid){setTimeout(function(){var msg=display.isValid();if(msg!==true){_this.addError.call(_this,display,msg)}else{_this.removeError.call(_this,display,msg)}},1);return}_this.removeError.call(_this,display);return isValid},getRules:function(c){var g=this;var e=Horn.Field.getField(c);var a=e.attr(this.CHECK);var d=e.attr("format");if(a){var b=a.split(this.CHECKSEP);var f=[];$.each(b,function(h,j){var i=g.getRule(e,j);if(i){i.format=d;f.push(i)}});return f}},getRule:function(field,rule){if(rule){var name=rule;var value=field.val();var params=[value];if(rule.indexOf("(")>-1){name=rule.substring(0,rule.indexOf("("));var ps=rule.substring(rule.indexOf("(")+1,rule.indexOf(")")).split(",");for(var i=0;i<ps.length;i++){if(ps[i]){params.push(eval("("+ps[i]+")"))}}}return{name:name,params:params}}return null},addError:function(d,a){var c=(typeof d=="string")?Horn.getComp(d):d;function b(e){if(e instanceof Horn.Field){e.showError(a)}else{Horn.Tip.addTip(a)}}if(!c){Horn.ready(function(){var e=(typeof d=="string")?Horn.getComp(d):d;b(e)})}else{b(c)}},removeError:function(a){a=(typeof a=="string")?Horn.getComp(a):a;$(a).each(function(b,c){try{c=Horn.getCompByEl(c)||c;c.removeError()}catch(d){if(window.console){window.console.warn("批量消除错误失败"+c)}}})},validateFmt:function(f){if(f==""){return true}var a="^\\d{4}\\d{1,2}\\d{1,2}$";var b=Horn.Calendar.DEFAULT_FORMAT;var e=true;if(b){if(b.length>8){var d=b.charAt(4);var c=b.charAt(7);var a="^\\d{4}"+d+"\\d{1,2}"+c+"\\d{1,2}$";e=(new RegExp(a)).test(f)}else{e=(new RegExp(a)).test(f)}if(!e){e="日期格式不正确,格式："+b}}else{e="没有配置Horn.Calendar.DEFAULT_FORMAT格式参数"}return e}};
Horn.ButtonPanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"ButtonPanel",init:function(){Horn.ButtonPanel.superclass.init.apply(this,arguments)},setEnable:function(b,a){if(typeof a!="boolean"){Horn.Tip.info("enabled属性只能是布尔型！");return}var c=this.el.find("button[name="+b+"]");if(c.length==0){Horn.Tip.info(b+",不存在！");return}if(typeof a=="undefined"||a){c.removeClass("disabled");c.removeAttr("disabled")}else{c.addClass("disabled");c.attr("disabled","disabled")}}});Horn.regUI("div.h_btndiv",Horn.ButtonPanel);Horn.regUI("div.hc_button-group",Horn.ButtonPanel);
var optGridId=null;Horn.DataGrid=Horn.extend(Horn.Base,{COMPONENT_CLASS:"DataGrid",id:"dyncGrid",name:"dyncGrid",title:"",data:null,selectModel:"normal",autoLoad:false,baseParams:{},items:[],url:"",emptyMsg:"",numbercolumn:false,rowSelect:false,hasPage:false,toolbar:null,pagebar:null,frozen:null,frozenObj:null,clickFlag:null,td_number:'<td style="width:40px;"><div style="TEXT-aLIGN: center;width:40px;">{count}</div></td>',td_check:'<td style="width:36px;"><div class="hc-datagrid-cell-check" style="TEXT-aLIGN: center;width:36px;"><input type="{CHECK_TYPE}"  id="{CHECKBOX_ID}"></div></td>',td:'<td style="display:{XDATAGRID_TD_HIDDEN};WIDTH:{XDATAGRID_TD_WIDTH}px"><div  class="hc-datagrid-cell" style="TEXT-ALIGN:{XDATAGRID_TD_ALIGN};WIDTH:{XDATAGRID_DIV_WIDTH}px;overflow: visible;">{XDATAGRID_TD_VAL}</div></td>',tr:'<tr id="{TR_ID}"  class="{TR_CLASS}">',tr_end:"</tr>",row_class:"u-table-bg",pageinfo:{totalPagesText:"页，每页{pagesize}条,共{pages}页",displayMsg:"当前显示{from}到{to}，共{total}条记录"},reqPageNo:1,reqPageSize:10,delimiter:",",selecteds:[],lastSelect:null,allCheckboxId:"allcb_datagrid_id",numberColWidth:40,bindFormName:null,isBackSort:false,initParams:function(c){var e=setDefaultValue;e(c,"numbercolumn",false);e(c,"selectModel","normal");e(c,"items",[]);e(c,"hasPage",false);e(c,"rowSelect",false);e(c,"autoLoad",false);Horn.apply(this,c);if(!c.frozen){c.frozen=[]}if(typeof c.frozen=="object"){this.frozenObjs=[];for(var b=0;b<c.frozen.length;b++){for(var d=0;d<c.items.length;d++){var a=c.items[d];if(a.name==c.frozen[b]){this.frozenObjs.push(a)}}}this.frozenObj=this.frozenObjs[0]}else{for(var d=0;d<c.items.length;d++){var a=c.items[d];if(a.name==c.frozen){this.frozenObj=a;this.frozenObjs=[this.frozenObj];break}}}if(!this.params.pageConfig){this.params.pageConfig={}}if(this.params.bindFormName){this.bindFormName=this.params.bindFormName}if(this.params.id&&this.params.id!=""){this.id=this.params.id}else{if(this.params.name&&this.params.name!=""){this.id=this.params.name}}if(this.hasPage&&this.hasPage==true){this.createPagebar()}if(c.width){this.setWidth(c.width)}if(c.height){this.setHeight(c.height)}},init:function(e){this.name=this.params.name||this.name;Horn.DataGrid.superclass.init.apply(this,arguments);this.initParams(this.params);var g=this;$.each(this.params.events||[],function(h,j){g[j.event.toLowerCase()]=j["function"]});this.dataTable=$("#data_"+this.id).children("table");this.head_dataTable=$("#head_"+this.id);this.title=this.params.title||null;this.titleEl=null;if(this.title){this.titleEl=$("#wrap_"+this.id).children("div.u-datagrid-header").children("h4")}if((this.params.frozen&&this.params.frozen!="")||this.params.frozenHead){this.sortColums=this.head_dataTable.find(".u-datagrid-sorting")}else{this.sortColums=this.dataTable.find(".u-datagrid-sorting")}this.sortItem=[];this.sortCache=[];if(this.sortColums.length>0){this.sortColums.on("click",function(h){g.sortClick(h)})}if((this.params.frozen&&this.params.frozen!="")||this.params.frozenHead){this.ths=this.head_dataTable.children("tbody").find("td")}else{this.ths=this.dataTable.children("thead").find("td")}this.trs=this.dataTable.children("tbody").children("tr");this.frozenTable=$("#freeze_data_"+this.id).children("table");this.fro_trs=this.frozenTable.children("tbody").children("tr");this.fro_ths=$("#freez_head_"+this.id).children("tbody").find("td");var a=$("#freez_head_"+this.id);var f=$("#head_"+this.id);for(var c=1;this.frozenObjs&&c<this.frozenObjs.length;c++){var b=this.frozenObjs[c];var d=f.find("div[name="+b.name+"]").parent();d.appendTo(a.find("tr"));f.find("[flag=frozen]").after(d.clone().attr("flag","frozen")).removeAttr("flag")}this.fro_header=a;this.header=f;this.processReqConf();this.initToolbarEvents();if(this.params.autoLoad&&this.params.autoLoad==true){this.autoLoad=this.params.autoLoad;this.load()}else{if(this.data){this.loadFlag="staticData";this.storgedData=this.data.rows?this.data.rows:this.data;this.reqPage(this.reqPageNo,this.reqPageSize)}else{this.pageBtnDisabled(true)}}},processReqConf:function(){var b=this.params.pageConfig["pageNo"];var a=this.params.pageConfig["pageSize"];var c=$("#pageSize_"+this.id);if(a){c.val(a)}this.reqPageNo=this.reqPageNo?this.reqPageNo:b;this.reqPageSize=this.reqPageSize?this.reqPageSize:a},setButtonDisabled:function(a,b){var c=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul").children("li");c.each(function(f,d){var e=$(this).children("a");var g=e.attr("name");if(g==a){if(b){e.addClass("f-disabled");e.attr("onclick","javascript:return false;")}else{e.removeClass("f-disabled");e.attr("onclick",e.attr("event"))}return}})},initToolbarEvents:function(){var a=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul").children("li");a.each(function(d,b){var c=$(this).children("a");if(c.hasClass("f-disabled")){c.attr("onclick","javascript:return false;")}})},staticInitPagebar:function(){if(this.hasPage){var a=this.storgedData.length;if(this.pagebar){this.pagebar.setTotalCount(a);this.pagebar.calPage_(this.reqPageNo,this.reqPageSize,a);this.setPageInfo()}this.reqPageNo=this.reqPageNo+1}},reCalRowHeight:function(){var c=22;var b=this.params.height;if(!b){return}var a=this.currentPageSize;var d=c*a<b?b/a:22;this.setHeight(b)},initSelectEvents:function(){var a=1;var c=this;var b=$("#"+this.allCheckboxId);this.trs.each(function(f,d){var h=$(d),e=h.find("#cb_"+c.id+"_"+a);a++;if(c.rowSelect==false){e.change(function(){if(this.checked){c.selectRow(f+1,h)}else{c.unSelectRow(f+1,h)}})}else{var g=this.clickFlag;h.bind("click",function(i){clearTimeout(g);g=setTimeout(function(){if($.isEmptyObject(c.selecteds)){if(c.frozenObj){$(c.fro_trs[f]).find("#cb_"+c.id+"_"+(f+1)).prop("checked",true);$(c.fro_trs[f]).addClass("u-table-selected")}c.selectRow(f+1,h)}else{if(!c.selecteds.hasOwnProperty(f+1)){if(c.frozenObj){$(c.fro_trs[f]).find("#cb_"+c.id+"_"+(f+1)).prop("checked",true);$(c.fro_trs[f]).addClass("u-table-selected")}c.selectRow(f+1,h)}else{if(c.frozenObj){$(c.fro_trs[f]).find("#cb_"+c.id+"_"+(f+1)).prop("checked",false);$(c.fro_trs[f]).removeClass("u-table-selected")}c.unSelectRow(f+1,h)}}if(b&&c.selectModel=="multi"){c.stateTest()}},10)})}});if(this.frozenObj){a=1;this.fro_trs.each(function(f,d){var h=$(d);var e=h.find("#cb_"+c.id+"_"+a);a++;if(c.rowSelect==false){e.change(function(){if(this.checked){e.checked=true;h.addClass("u-table-selected");c.selectRow(f+1,$(c.trs[f]))}else{e.checked=false;h.removeClass("u-table-selected");c.unSelectRow(f+1,$(c.trs[f]))}if(b&&c.selectModel=="multi"){c.stateTest()}})}else{var g=this.clickFlag;h.bind("click",function(i){clearTimeout(g);g=setTimeout(function(){if($.isEmptyObject(c.selecteds)){e.prop("checked",true);h.addClass("u-table-selected");c.selectRow(f+1,$(c.trs[f]))}else{if(!c.selecteds.hasOwnProperty(f+1)){e.prop("checked",true);h.addClass("u-table-selected");c.selectRow(f+1,$(c.trs[f]))}else{e.prop("checked",false);h.removeClass("u-table-selected");c.unSelectRow(f+1,$(c.trs[f]))}}if(b&&c.selectModel=="multi"){c.stateTest()}},10)})}})}if(b&&this.selectModel=="multi"){this.el.find(".h_datagrid_select_all").change(function(){if(this.checked){c.selectAll()}else{c.unSelectAll()}});this.dataTable.find(".hc-datagrid-cell-check").each(function(e,d){var f=$(d);f.children("input:checkbox").change(function(){c.stateTest()})})}},initHignLightEvent:function(){var a=this;if(this.frozenObj){this.fro_trs.each(function(c,b){var d=$(b);d.mouseover(function(){d.addClass("hc-datagrid-row-over");$(a.trs[c]).addClass("hc-datagrid-row-over")});d.mouseout(function(){d.removeClass("hc-datagrid-row-over");$(a.trs[c]).removeClass("hc-datagrid-row-over")})});this.trs.each(function(c,b){var d=$(b);d.mouseover(function(){d.addClass("hc-datagrid-row-over");$(a.fro_trs[c]).addClass("hc-datagrid-row-over")});d.mouseout(function(){d.removeClass("hc-datagrid-row-over");$(a.fro_trs[c]).removeClass("hc-datagrid-row-over")})})}else{this.trs.each(function(c,b){var d=$(b);d.mouseover(function(){d.addClass("hc-datagrid-row-over")});d.mouseout(function(){d.removeClass("hc-datagrid-row-over")})})}},stateTest:function(){var b=this;var a=true;this.dataTable.find(".hc-datagrid-cell-check").each(function(d,c){var f=$(c);var e=f.children("input:checkbox");if(!e.prop("checked")){a=false}});if(a){b.el.find(".h_datagrid_select_all").prop("checked",true)}else{b.el.find(".h_datagrid_select_all").prop("checked",false)}},load:function(a,d){d=d||{};this.selecteds=null;if(this.loadFlag&&this.loadFlag!="autoLoad"){this.reqPageNo=1}this.loadFlag="autoLoad";if($.type(d)=="array"){d=Horn.Util.arr2Obj(d)}this.reqPageNo=d.pageNo||this.reqPageNo;this.reqPageSize=d.pageSize||this.reqPageSize;if(this.hasPage){d.pageNo=this.reqPageNo;d.pageSize=this.reqPageSize}if(this.sortItem.length>0&&this.isBackSort){d.sortItem=this.sortItem.attr("name");d.sortMode=this.sortMode}if(this.bindFormName!=null){var c=$("form[name="+this.bindFormName+"]").serializeArray();var b=Horn.Util.arr2Obj(c);$.each(b,function(e,f){d[e]=f})}this.execute(a,d);$("#head_"+this.id).css("margin-left",0);$("#freez_body_"+this.id).css("margin-top",0)},loadData:function(c){this.loadFlag="loadData";var d=this;var b=this.params.pageConfig["pageNo"];var a=this.params.pageConfig["pageSize"];this.reqPageNo=b?b:1;this.reqPageSize=a?a:10;if(c!=null){this.data=c;this.storgedData=c.rows?c.rows:c;this.reqPage(this.reqPageNo,this.reqPageSize);d.el.find("#data_"+d.id).css("height","");this.pageBtnDisabled(false)}this.reCalRowHeight();this.resetTdContent()},sortClick:function(b){var a=$(b.target).closest("td");if(this.sortCache.length>0){if(this.sortItem.attr("name")!=a.attr("name")){this.sortItem.removeClass().addClass("u-datagrid-sorting");this.sortCache=this.sortItem}}else{this.sortCache=a}this.sortItem=a;this.doSort()},doSort:function(){var e=this;this.setSortStatus();this.sortName=this.sortItem.attr("name");var c=this.data;if(this.isBackSort){this.load()}else{var b=this.sortName;if(this.sortMode=="ASC"){c.sort(function(g,f){return g[b]==f[b]?0:(g[b]<f[b]?-1:1)})}else{c.sort(function(g,f){return g[b]==f[b]?0:(g[b]<f[b]?1:-1)})}this.loadRecords(c);this.initSelect();this.bindClickEvent(this.rowclick,"click");this.bindClickEvent(this.rowdblclick,"dblclick");this.initSelectEvents();this.initHignLightEvent();this.resetTdContent();this.columnRender();if(this.params.height==undefined){}this.setTHHidden();if(e.loadsuccess){var d=Horn.Util.getFunObj(e.loadsuccess),a;if($.type(d.fn)=="function"){a=d.fn}if(a){a.apply(e,[e.el,c])}}}},setSortStatus:function(){if(this.sortItem.hasClass("u-datagrid-sorting")){this.sortItem.removeClass().addClass("u-datagrid-sorting-asc");this.sortMode="ASC"}else{if(this.sortItem.hasClass("u-datagrid-sorting-asc")){this.sortItem.removeClass().addClass("u-datagrid-sorting-desc");this.sortMode="DESC"}else{this.sortItem.removeClass().addClass("u-datagrid-sorting-asc");this.sortMode="ASC"}}},clearSort:function(){this.sortItem.removeClass().addClass("u-datagrid-sorting");this.sortCache=[]},getId:function(){return this.id},getSelecteds:function(){var b=[];for(var a in this.selecteds){if(a=="indexOf"){continue}var c=this.selecteds[a];if(c){b.push(c)}}return b},unSelectAll:function(){var a=this;this.dataTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(b,c){c.checked=false;if(a.rowSelect==false){$(c).trigger("change")}else{a.unSelectRow(b+1,$(c.parentNode.parentNode.parentNode))}});if(this.frozenObj){this.frozenTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(b,c){c.checked=false;$(c.parentNode.parentNode.parentNode).removeClass("u-table-selected")})}a.el.find(".h_datagrid_select_all").prop("checked",false)},selectAll:function(){var c=this;this.dataTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(d,e){e.checked=true;if(c.rowSelect==false){$(e).trigger("change")}else{c.selectRow(d+1,$(e.parentNode.parentNode.parentNode))}});if(this.frozenObj){this.frozenTable.find("div.hc-datagrid-cell-check input:checkbox").each(function(d,e){e.checked=true;$(e.parentNode.parentNode.parentNode).addClass("u-table-selected")})}var b=this.head_dataTable.find("#allcb_datagrid_id");if(b.length>0){b.prop("checked",true)}var a=this.fro_ths.find("#allcb_datagrid_id");if(a.length>0){a.prop("checked",true)}},setBaseParams:function(a){a=a||{};if(a){this.baseParams=a}else{this.baseParams={}}},setSize:function(f,a){var c=this.getId();var b=f?Number(f):null;var e=a?Number(a):null;if(b&&!isNaN(b)){$("#wrap_"+c).width(b);this.width=b}if(e&&!isNaN(e)){var d=$("#freeze_data_"+c);if(d.size!=0){d.height(e-16)}$("#data_"+c).height(e);this.height=e}},setWidth:function(a){this.setSize(a,null)},setHeight:function(a){this.setSize(null,a)},select:function(b,a){var c=this,b=Number(b);index=b,tr=$(c.trs[index]),f_tr=$(c.fro_trs[index]),_allCheck=$("#"+this.allCheckboxId);if($.isEmptyObject(c.selecteds)){if(c.frozenObj){f_tr.find("#cb_"+c.id+"_"+(index+1)).prop("checked",true);f_tr.addClass("u-table-selected")}c.selectRow(index+1,tr)}else{if(!c.selecteds.hasOwnProperty(index+1)){if(c.frozenObj){f_tr.find("#cb_"+c.id+"_"+(index+1)).prop("checked",true);f_tr.addClass("u-table-selected")}c.selectRow(index+1,tr)}}if(_allCheck&&c.selectModel=="multi"){c.stateTest()}if(a&&a.stopPropagation){a.stopPropagation()}},unselect:function(b,a){this.unSelectRow(b+1,$(this.trs[b]));if(a&&a.stopPropagation){a.stopPropagation()}},selectRow:function(e,a){var d=a;if(!d){d=$("#tr_"+this.id+"_"+e)}var c=this.getRowData(e-1);this.selecteds[e]=c;if(this.selectModel=="single"){var b=this.lastSelect;if(b&&b.rowidx!==undefined&&b.rowidx!=e){b.tr.find("#cb_"+this.id+"_"+b.rowidx).prop("checked",false);this.unSelectRow(b.rowidx,b.tr)}d.find("input:radio").get(0).checked=true}else{if(this.selectModel=="multi"){d.find("input:checkbox").get(0).checked=true}}this.lastSelect={rowidx:e,tr:d};d.addClass("u-table-selected")},getRowData:function(a){return this.result[a]},unSelectRow:function(e,b){var d=b;if(!d){d=$("#tr_"+this.id+"_"+e)}this.selecteds[e]=null;delete this.selecteds[e];d.removeClass("u-table-selected");d.find("#cb_"+this.id+"_"+e).prop("checked",false);if(this.frozenObj){$(this.fro_trs[e-1]).find("#cb_"+this.id+"_"+e).prop("checked",false);$(this.fro_trs[e-1]).removeClass("u-table-selected")}var c=true;for(var a in this.selecteds){c=false;break}if(c){this.el.find(".h_datagrid_select_all").prop("checked",false)}},execute:function(d,c){c=c||{};var e=true;if(this.beforeload){var b=Horn.Util.getFunObj(this.beforeload),f;if($.type(b.fn)=="function"){f=b.fn}if(f){e=f.apply(this,[this.el,c])}}if(e!=false){var a=Horn.apply({},this.baseParams,c);this.doAjax(d,a)}return e},doAjax:function(d,e){var f=this;var d=d?d:f.url;if(d&&d.indexOf("http:")==-1){d=context_path+d}var c=this.dataTable.children("tbody"),a=this.frozenTable.children("tbody"),b=this.ths.length;$.ajax(d,{async:true,beforeSend:function(g){if(f.frozenObj){f.frozenTable.children("tbody").html("")}f.dataTable.children("tbody").html("");c.html('<tr><td style="border-right:0px;padding:15px;" colspan=\''+b+"'><img src='"+context_path+"/components/datagrid/img/hc_onLoad.gif'></img></td></tr>");c.parent().css("width","100%");c.parent().css("text-align","center");c.parent().css("padding","15px")},type:"POST",data:Horn.Util.obj2Arr(e),dataType:"json",error:function(i,j,h){var g=i.status;c.parent().css("width","");c.parent().css("text-align","");c.parent().css("padding","");if(f.frozenObj){f.frozenTable.children("tbody").html("");a.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>请求失败</p><p>错误状态："+g+"；错误信息："+j+"</p></td></tr>")}c.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>请求失败</p><p>错误状态："+g+"；错误信息："+j+"</p></td></tr>")},success:function(h,i,n){c.html("");c.parent().css("width","");c.parent().css("text-align","");c.parent().css("padding","");if(!h||$.isEmptyObject(h)){if(f.frozenObj){f.frozenTable.css("border-bottom","0 solid #e2e7eb");f.frozenTable.children("tbody").html("");a.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>")}f.clearSort();f.dataTable.css("border-bottom","0 solid #e2e7eb");f.dataTable.children("tbody").html("");c.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>");if(f.loaderror){var k=Horn.Util.getFunObj(f.loaderror),o;if($.type(k.fn)=="function"){o=k.fn}if(o){o.apply(f,[f.el,h])}return}}else{if(h){var j=h.rows;this.result=j?j:h}if(this.result&&(this.result.length==0||$.isEmptyObject(this.result))){if(f.frozenObj){f.frozenTable.css("border-bottom","0 solid #e2e7eb");f.frozenTable.children("tbody").html("");a.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>")}f.dataTable.css("border-bottom","0 solid #e2e7eb");f.dataTable.children("tbody").html("");c.html('<tr><td style="border-right:0px;padding:15px;" colSpan=\''+b+"'><p>暂时无数据</p></td></tr>");f.initPagebar(h)}else{f.data=h.rows;f.params.data=h.rows;f.loadRecords(h);f.initPagebar(h);f.initSelect();f.bindClickEvent(f.rowclick,"click");f.bindClickEvent(f.rowdblclick,"dblclick");f.initSelectEvents();f.initHignLightEvent();f.resetTdContent();f.columnRender();if(!f.isBackSort&&f.sortItem.length>0){f.clearSort()}if(f.params.height==undefined){}f.setTHHidden()}}try{if(f.loadsuccess){var g=Horn.Util.getFunObj(f.loadsuccess),m;if($.type(g.fn)=="function"){m=g.fn}if(m){m.apply(f,[f.el,h])}}}catch(l){Horn.debug(l)}}})},initPagebar:function(a){if(this.hasPage){var b=a.total;if(this.pagebar){if(a!=null){$("#toPage_"+this.id).attr("disabled",false);$("#pageSize_"+this.id).attr("disabled",false)}this.pagebar.setTotalCount(b);this.pagebar.calPage_(this.reqPageNo,this.reqPageSize,b);this.setPageInfo()}}},pageBtnDisabled:function(a){if(a){$("#toPage_"+this.id).attr("disabled",true);$("#pageSize_"+this.id).attr("disabled",true);$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").addClass("disabled");$("#page_"+this.id).find(".next_page_btn,.last_page_btn").addClass("disabled");$("#page_"+this.id).find(".refresh_btn").addClass("disabled")}else{$("#toPage_"+this.id).attr("disabled",false);$("#pageSize_"+this.id).attr("disabled",false);$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").removeClass("disabled");$("#page_"+this.id).find(".next_page_btn,.last_page_btn").removeClass("disabled");$("#page_"+this.id).find(".refresh_btn").removeClass("disabled")}},loadRecords:function(a){this.currentPageSize=a.length||(a.rows&&a.rows.length);this.result=a.rows||a;Horn.debug("init datagrid data...",this.result);this.createDataTable();this.initScroll();this.trs=this.dataTable.children("tbody").children("tr");this.fro_trs=this.frozenTable.children("tbody").children("tr");this.loaded=true;Horn.debug("init datagrid data success ...")},calMaxLength:function(){var d,f,e,g=this;for(var c=0;c<g.params.items.length;c++){d=g.params.items[c];var a=d.text.getWidth(12);if(g.params.autoWidth||d.autoWidth){for(var b=0;b<g.result.length;b++){f=g.result[b];e=(""+f[d.name]||"0").getWidth(12);a=e>a?e:a}}d._maxLength=a}},createDataTable:function(){var o=[];var n=[];var m=this.ths.length;if(this.frozenObj){var b=$("#freez_head_"+this.id).children("tbody").children("tr").length}if(this.result&&this.result.length>0){var c=1;for(var h=0;h<this.result.length;h++){var f=this.result[h];if(this.frozenObj||this.params.frozenHead){this.createFrozenTableTr(f,c,n)}var k=this.tr.replace("{TR_ID}","tr_"+this.id+"_"+c);k=k.replace("{TR_CLASS}",(c%2==0)?this.row_class:"");o.push(k);if(this.numbercolumn&&this.numbercolumn==true){var a=this.td_number.replace("{count}",c).replace("{numberColumnWidth}",this.numberColWidth);o.push(a)}if(this.selectModel&&this.selectModel=="multi"){var a=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+c);a=a.replace("{CHECK_TYPE}","checkbox");o.push(a)}else{if(this.selectModel&&this.selectModel=="single"){var a=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+c);a=a.replace("{CHECK_TYPE}","radio");o.push(a)}}for(var g=0;g<this.frozenObjs.length;g++){this.frozenObj=this.frozenObjs[g];if(this.frozenObj||this.params.frozenHead){var a=this.td.replace("{XDATAGRID_TD_ALIGN}",this.setAlign(this.frozenObj.tAlign));var d=this._getItemWidth(this.frozenObj);a=a.replace("{XDATAGRID_TD_WIDTH}",this.frozenObj.width?this.frozenObj.width:d);a=a.replace("{XDATAGRID_DIV_WIDTH}",this.frozenObj.width?this.frozenObj.width:d);if(this.frozenObj.hidden&&this.frozenObj.hidden==true){a=a.replace("{XDATAGRID_TD_HIDDEN}","none")}var l=this.getCellValue(f,this.frozenObj.name);l=this.formatData(this.frozenObj.dataType,this.frozenObj.format,l);if(l!=""&&(l=="null"||l=="NULL"||l=="undefined")){l=""}a=a.replace("{XDATAGRID_TD_VAL}",l);o.push(a)}}this.frozenObj=this.frozenObjs[0];var p=this.items.length;for(var g=0;g<p;g++){var e=this.items[g];if(e.name!=this.params.frozen&&this.params.frozen.indexOf(e.name)<0){var a=this.td.replace("{XDATAGRID_TD_ALIGN}",this.setAlign(e.tAlign));if((this.params.frozen&&this.params.frozen!="")||this.params.frozenHead){var d=this._getItemWidth(e);a=a.replace("{XDATAGRID_TD_WIDTH}",e.width?e.width:d);a=a.replace("{XDATAGRID_DIV_WIDTH}",e.width?e.width:d)}else{if(e.width&&e.width!=""){a=a.replace("{XDATAGRID_TD_WIDTH}",e.width);a=a.replace("{XDATAGRID_DIV_WIDTH}",e.width)}}if(e.hidden&&e.hidden==true){a=a.replace("{XDATAGRID_TD_HIDDEN}","none")}var l=this.getCellValue(f,e.name);if(e.dataType&&e.dataType!=null){l=this.formatData(e.dataType,e.format,l)}if(l!=""&&(l=="null"||l=="NULL"||l=="undefined")){l=""}a=a.replace("{XDATAGRID_TD_VAL}",l);o.push(a)}}o.push(this.tr_end);c++}}if(this.frozenObj){this.frozenTable.children("tbody").html("");this.frozenTable.children("tbody").html(n.join(""))}this.dataTable.children("tbody").html("");this.dataTable.children("tbody").html(o.join(""));this.reCalRowHeight()},resetTdContent:function(){var j=this.head_dataTable.children("tbody").children("tr");var d=this.dataTable.children("tbody").children("tr");var h=this.frozenTable.children("tbody").children("tr");var l=[];var c=this;var k=[];var f=[];d.each(function(B,r){var u=false;var x=$(r);var t=x.attr("id");var o=x.find("td");for(var v=0;v<o.length;v++){var m=$(o[v]);var A=m.children("div");var z=A.text();var q="";var y=300;var s=m.css("display");var p=m.attr("style");var n=c.items[v];if(n){q=n.width;if(n.width){y=n.width;if(c.getStrlen(z)>40){m.css("width",y+"px");A.css("width",y+"px")}}}if(q){if(f.indexOf(v)==-1){f.push(v)}}if(s!="none"){if(c.getStrlen(z)>40){if(k.indexOf(v)==-1){k.push(v)}if(c.params.frozen&&c.params.frozen!=""){l.push(t);A.html('<textarea   readonly style="height: 40px;width: 100%;border: 0;background: transparent;line-height: 15px;outline: none;" class="div-textarea">'+z+"</textarea>");A.css("height","40px");A.css("line-height","40px")}else{var i=A.attr("style");i=i+";white-space: normal;text-overflow: initial;;word-wrap:break-word; word-break:break-all";A.attr("style",i)}}}if((c.params.frozen&&c.params.frozen!="")||c.params.frozenHead){if((v==o.length-1)&&s!="none"){m.css("width","auto");A.css("width","auto")}}}});if(this.frozenObj||this.params.frozenHead){h.each(function(t,o){var r=$(o);var m=r.find("td");var p=r.attr("id");if(l.length>0&&l.indexOf(p)>-1){for(var q=0;q<m.length;q++){var i=$(m[q]);var s=i.children("div");var n=s.attr("class");if(n!="hc-datagrid-cell-check"){s.css("height","40px");s.css("line-height","40px")}}}})}if(k.length>0){for(var b=0;b<k.length;b++){var g=300;var e=f[b];var a=c.items[e];if(a){g=a.width}j.find("td:eq("+k[b]+")").css("width",g);j.find("td:eq("+k[b]+") div").css("width",g)}}if((c.params.frozen&&c.params.frozen!="")||this.params.frozenHead){j.each(function(n,m){var q=$(m);var o=q.find("td");for(var i=0;i<o.length;i++){var s=$(o[i]);var p=s.children("div");var r=s.css("display");if((i==o.length-1)&&r!="none"){s.css("width","auto");p.css("width","auto")}}})}},getStrlen:function(e){var b=2;var a=0;for(var d=0;d<e.length;d++){var f=e.charCodeAt(d);if((f>=1&&f<=126)||(65376<=f&&f<=65439)){a++}else{a+=b}}return a},formatData:function(e,d,f){return Horn.Util.Format.all(e,d,f)},createFrozenTableTr:function(c,e,b){b=b||[];var f=this.tr.replace("{TR_ID}","tr_"+this.id+"_"+e);f=f.replace("{TR_CLASS}",(e%2==0)?this.row_class:"");b.push(f);if(this.numbercolumn&&this.numbercolumn==true){var h=this.td_number.replace("{count}",e).replace("{numberColumnWidth}",this.numberColWidth);b.push(h)}if(this.selectModel&&this.selectModel=="multi"){var h=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+e);h=h.replace("{CHECK_TYPE}","checkbox");b.push(h)}else{if(this.selectModel&&this.selectModel=="single"){var h=this.td_check.replace("{CHECKBOX_ID}","cb_"+this.id+"_"+e);h=h.replace("{CHECK_TYPE}","radio");b.push(h)}}for(var d=0;d<this.frozenObjs.length;d++){this.frozenObj=this.frozenObjs[d];if(this.frozenObj){var h=this.td.replace("{XDATAGRID_TD_ALIGN}",this.setAlign(this.frozenObj.tAlign));var a=this._getItemWidth(this.frozenObj);h=h.replace("{XDATAGRID_TD_WIDTH}",this.frozenObj.width?this.frozenObj.width:a);h=h.replace("{XDATAGRID_DIV_WIDTH}",this.frozenObj.width?this.frozenObj.width:a);if(this.frozenObj.hidden&&this.frozenObj.hidden==true){h=h.replace("{XDATAGRID_TD_HIDDEN}","none")}var g=this.getCellValue(c,this.frozenObj.name);g=this.formatData(this.frozenObj.dataType,this.frozenObj.format,g);h=h.replace("{XDATAGRID_TD_VAL}",g);b.push(h)}}this.frozenObj=this.frozenObjs[0];b.push(this.tr_end)},_getItemWidth:function(c){var b=c;for(var a=0;a<this.params.items.length;a++){if(c.name==this.params.items[a]["name"]){b=this.params.items[a];break}}if((this.params.frozen&&this.params.frozen!="")||this.params.frozenHead){return b.width||100}else{return""}},initScroll:function(){var a="#data_"+this.id;var c="#head_"+this.id;var b="#freez_body_"+this.id;$(a).scroll(function(){var e=$(a).scrollLeft();var d=$(a).scrollTop();$(c).css("margin-left",-e);$(b).css("margin-top",-d)})},getCellValue:function(f,e){f=f||{};e=e||"";var b=this.params.items;for(var d=0;d<b.length;d++){if(b[d]["name"]==e&&b[d]["items"]){var a=b[d]["items"];for(var c=0;c<a.length;c++){if(a[c]["value"]==f[e]){f[e]=a[c]["label"]}}}}if(f[e]||f[e]==0){return f[e]}else{return""}},createPagebar:function(){if(this.params.pageConfig){var a=this;this.pagebar=new Horn._Pagebar(this.params.pageConfig,this.id,a)}},setPageInfo:function(){$("#toPage_"+this.id).val(this.pagebar.currentPage);$("#pageSize_"+this.id).val(this.pagebar.pageSize);$("#totalPages_"+this.id).html(this.pagebar.pages);if((this.pagebar.pageSize%5)==0){var b=this.pagebar.pageSize/5;if(b==20){b=11}else{if(b==40){b=12}else{if(b==100){b=13}else{if(b==200){b=14}}}}var a=$($(".dropdown-menu-datagrid").find("li").get(b-1));a.addClass("active");this.pagebar.activeLi=a}$("#pageInfo_"+this.id).html(this.pagebar.getPageInfo());if(1==this.pagebar.currentPage){$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").addClass("disabled")}else{$("#page_"+this.id).find(".first_page_btn,.pre_page_btn").removeClass("disabled")}if(this.pagebar.pages==this.pagebar.currentPage){$("#page_"+this.id).find(".next_page_btn,.last_page_btn").addClass("disabled")}else{$("#page_"+this.id).find(".next_page_btn,.last_page_btn").removeClass("disabled")}$("#page_"+this.id).find(".refresh_btn").removeClass("disabled")},reqPage:function(b,a){this.reqPageNo=b?b:this.reqPageNo;this.reqPageSize=a?a:this.reqPageSize;if(this.loadFlag!="autoLoad"&&this.storgedData){this.result=this.storgedData.slice((this.reqPageNo-1)*this.reqPageSize,this.reqPageNo*this.reqPageSize);if(!this.hasPage){this.result=this.storgedData}this.loadRecords(this.result);this.setTHHidden();this.initScroll();this.staticInitPagebar();this.initSelect();this.bindClickEvent(this.rowclick,"click");this.bindClickEvent(this.rowdblclick,"dblclick");this.initSelectEvents();this.initHignLightEvent();this.columnRender()}else{this.load()}},initSelect:function(){var b=this;$("#"+this.allCheckboxId).prop("checked",false);var a=$("#"+this.allCheckboxId);if(a&&this.selectModel=="multi"){a.prop("checked",false);if(this.frozenObj){this.fro_trs.each(function(c,d){$(d).find("#cb_"+b.id+"_"+(c+1)).prop("checked",false)})}this.trs.each(function(c,d){$(d).find("#cb_"+b.id+"_"+(c+1)).prop("checked",false)})}this.selecteds=[];this.lastSelect={}},bindClickEvent:function(b,f){var j=undefined;var a=undefined;if(b){j=Horn.Util.getFunObj(b);if($.type(j.fn)=="function"){a=j.fn}}if(a){var g=this.trs;var e=this.clickFlag;for(var d=0;d<g.length;d++){var h=$(g[d]);var c=j.params.slice(0);c.push(this.result[d],this.result);h.bind(f,c,function(k){var i=k.data;var l=this;if(f=="click"){clearTimeout(e);e=setTimeout(function(){return j.fn.apply(l,i)},300)}else{return j.fn.apply(l,i)}})}}},setAlign:function(a){a=a||"left";return a},setTHHidden:function(){var a=this;this.ths.each(function(b,f){var e=$(f);var g=e.find("div.hc-datagrid-cell");if(g.size()>0){for(var c=0;c<a.items.length;c++){var d=a.items[c];if(g.attr("name")==d.name){g.css("textalign",d.hAlign?d.hAlign:"center");g.css("width",a._getItemWidth(d));if(d.hidden&&d.hidden==true){e.hide()}break}}}});if(this.frozenObj){this.fro_ths.each(function(b,f){var e=$(f);var g=e.find("div.hc-datagrid-cell");if(g.size()>0){for(var c=0;c<a.items.length;c++){var d=a.items[c];if(g.attr("name")==d.name){g.css("textalign",d.hAlign?d.hAlign:"center");g.css("width",a._getItemWidth(d));if(d.hidden&&d.hidden==true){e.hide()}break}}}})}},dictColRender:function(d,c){d.attr("key",d.text());var a=d.children("div").text();var b=Horn.getDict(c);if(b){if(a==""||b[a]==undefined){d.children("div").html("");d.children("div").attr("title","")}else{d.children("div").html(b[a]||a);d.children("div").attr("title",b[a]||a)}}},buttonsColRender:function(c,h,a,f,g,b,i,k){c.find("div").attr("title","");var e=h;var j=$("<span></span>");$(e).each(function(p,m){var n=Horn.Util.getFunObj(m.event);if(!n.fn){return}var l=$("<a href='javascript:void(0)'>"+m.label+"</a>"),o=c.children("div").text();l.click(function(){n.fn.call(l,{val:o,rowdata:k,alldata:i,table:b,rowidx:a,tdidx:f,tr:g,td:c})});l.css("color","#3366CC");l.hover(function(){$(this).css("color","#CC3300");$(this).css("text-decoration","underline")},function(){$(this).css("color","#3366CC");$(this).css("text-decoration","none")});j.append(l);if(p!=(e.length-1)){j.append(" | ")}});c.children("div").html("");c.children("div").append(j);if(this.frozenObj){var d=$(this.fro_trs[a]).find("td")[f];$(d).children("div").html("");$(d).children("div").append(j)}},colRendererFunc:function(a,e,h,d,f,a){var c=this;a.attr("key",a.find("div").text());a.find("div").attr("title","");var g=Horn.Util.getFunObj(e),i=a.find("div").text();if(!g.fn){return}var b=g.fn.call($(this),{val:i,rowdata:c.result[h],alldata:c.result,table:c,rowidx:h,tdidx:d,tr:f,td:a});if(b instanceof $){a.find("div").html("");a.find("div").append(b)}else{a.find("div").html(b)}},columnRender:function(){var e=this;var b=this.ths;function d(f){for(var g=0;g<e.params.items.length;g++){if(f==e.params.items[g]["name"]){return e.params.items[g]}}}var a=this.fro_header;var c=this.header;a.find("td").each(function(f,j){var k=$(j).find("div").attr("name");if(k){var h=d(k),g=e._getItemWidth(h);$(j).find("div").width(g)}});c.find("td").each(function(f,j){var k=$(j).find("div").attr("name");if(k){var h=d(k),g=e._getItemWidth(h);$(j).find("div").width(g)}});this.trs.each(function(g,f){var j=$(f);var h=$(e.fro_trs[g]),i=h.find("td");j.find("td").each(function(r,n){var o=$(n);var m=$(b.get(r));var s=m.find("div").attr("dictname"),t=m.find("div").attr("renderer"),k=m.find("div").attr("name"),u=m.find("div").attr("buttons"),l,v;var p=$(i.get(r));o.find("div").attr("title",o.find("div").text());p.find("div").attr("title",p.find("div").text());for(var q=0;q<e.params.items.length;q++){if(e.params.items[q].name==k){u=e.params.items[q]["buttons"];l=e.params.items[q]["width"];v=e.params.items[q];if(v.autoWidth||e.params.autoWidth){}else{if(!l){}}break}}if(s){e.dictColRender(o,s);if(e.frozenObj){e.dictColRender(p,s)}}else{if(u){e.buttonsColRender(o,u,g,r,j,e,e.result,e.result[g])}}if(t){e.colRendererFunc(o,t,g,r,j,o);if(e.frozenObj){e.colRendererFunc(p,t,g,r,h,p)}}})})},setTitle:function(a){this.title=a;this.titleEl.text(a)},getTitle:function(){return this.title},addButton:function(b){var a={name:"",cls:"",event:""};b=$.extend(a,b);if(!b||!b.label){return}var d=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul");var c=$('<li><a name="'+b.name+'" href="JavaScript:void(0)" class="hc-datagrid-a hc_datagrid-alink" onclick="'+b.event+'"><i class="fa '+b.cls+'"></i>'+b.label+"</a></li>");d.append(c)},hideButton:function(a,c){var e=$("#wrap_"+this.id).children("div.u-datagrid-toolbar").children("ul");var d=e.children("li").children("a");for(var b=0;b<d.length;b++){if($(d[b]).attr("name")==a){if(c){$(d[b]).hide()}else{$(d[b]).show()}}}}});$.extend(Horn.DataGrid,{DATANAME:"h_datagrid"});Horn.regUI("div.xdatagrid",Horn.DataGrid);function setDefaultValue(c,b,a){if(c[b]===undefined){c[b]=a}else{if(c[b]=="true"){c[b]=true}else{if(c[b]=="false"){c[b]=false}}}}Horn._Pagebar=function(d,c,a){var b={gridId:null,INDEX_PAGE:1,currentPage:1,pageSize:10,pageCount:0,pages:0,startRow:0,init:function(g,f,e){if(g){setDefaultValue(g,"pageSize",10);setDefaultValue(g,"pageNo",1);setDefaultValue(g,"startRow",0);setDefaultValue(g,"pageCount",0);setDefaultValue(g,"currentPage",0);this.currentPage=parseInt(g.currentPage);this.pageCount=parseInt(g.pageCount);this.pageSize=parseInt(g.pageSize);this.pageNo=parseInt(g.pageNo);this.startRow=parseInt(g.startRow);this.pages=0}this.gridId=f;this.grid=e;this.grid.reqPageSize=this.pageSize;this.grid.reqPageNo=this.pageNo;this.el=$("#page_"+this.gridId)},initEvents:function(){var e=this;$("#page_"+this.gridId).children("li").find("a").each(function(g,h){var i=$(h);var j=function(l,m,k){l.click(function(){if(l.hasClass("disabled")){return}k=k||[];m.apply(e,k)})};if(!i.hasClass("disabled")){if(i.hasClass("first_page_btn")){j(i,e.first)}else{if(i.hasClass("pre_page_btn")){j(i,e.pre)}else{if(i.hasClass("next_page_btn")){j(i,e.next)}else{if(i.hasClass("last_page_btn")){j(i,e.last)}else{if(i.hasClass("refresh_btn")){j(i,e.refresh)}}}}}}});this.perPage=false;$("#_recPerPage"+this.gridId).on("click",function(){optGridId=$(this).attr("id");optGridId=optGridId.substring(11);var g=$(this).children("strong").text();if(e.perPage){$(this).next().hide();e.perPage=false}else{$(this).next().show();$(this).next().find("li").each(function(h,i){var j=$(this).children("a").text();if(g==j){$(this).addClass("active")}else{$(this).removeClass("active")}});e.perPage=true}});$("#_recPerPage"+this.gridId).bind("blur",function(h){var g=h;if(e.perPage){$(".dropdown-menu-datagrid").hide();e.perPage=false;return true}});$(".dropdown-menu-datagrid").bind("mouseover",function(){$("#_recPerPage"+e.gridId).unbind("blur")});$(".dropdown-menu-datagrid").bind("mouseout",function(){$("#_recPerPage"+e.gridId).bind("blur",function(h){var g=h;if(e.perPage){$(".dropdown-menu-datagrid").hide();e.perPage=false;return true}})});this.activeLi=$(".dropdown-menu-datagrid").find("li.active");var f=this.grid;$("#toPage_"+f.id).on("keydown",function(i){var g=i.keyCode;if(g==27||g==8){return true}if(g>=48&&g<=57){return true}if(g>=96&&g<=105){return true}var h=new RegExp("[0123456789]");var j=String.fromCharCode(g);if(!h.test(j)){return false}});$("#toPage_"+f.id).on("blur",function(){var g=$(this).val();if(!g||isNaN(g)){g=f.reqPageNo}g=parseInt(g,10);if(g<=0){g=1}else{if(g>f.pagebar.pages){g=1}}$(this).val(g);f.reqPage($(this).val(),$("#pageSize_"+f.id).html())});$("#pageSize_"+f.id).on("blur",function(){var g=$(this).val();if(g==""){var h=e.pageSize;if(h&&h!=""){g=h}else{g=10}}if(!g||isNaN(g)){g=f.pageSize}g=parseInt(g,10);if(g<=0){g=1}$(this).val(g);e.grid.reqPage(parseInt($("#toPage_"+e.grid.id).val()),g)})},calPage_:function(g,f,e){this.pageSize=parseInt(f);this.pageCount=parseInt(e);this.pages=Math.ceil(this.pageCount/this.pageSize);if((g*this.pageSize)>this.totalCount){this.currentPage=this.pages}else{this.currentPage=g}},pre:function(){if(this.currentPage<=1||this.pageCount==0){this.grid.reqPage(1,this.pageSize)}else{this.grid.reqPage((this.currentPage-1),this.pageSize)}},next:function(){if(this.pages==this.currentPage){return}var e=0;if(this.currentPage!=""){e=parseInt(this.currentPage)+1}this.grid.reqPage(e,this.pageSize)},last:function(){if(this.pages==0){return}else{this.grid.reqPage(this.pages,this.pageSize)}},first:function(){this.grid.reqPage(this.INDEX_PAGE,this.pageSize)},refresh:function(){var e=this.grid.reqPageNo-1;if(this.grid.loadFlag=="autoLoad"){e=this.grid.reqPageNo}this.grid.reqPage(e,this.pageSize)},getPageInfo:function(){var f;var g=0,e=0;if(this.pageCount>0){g=this.pageSize*(this.currentPage-1)+1;if((this.pageSize*this.currentPage)>=this.pageCount){e=this.pageCount}else{e=this.pageSize*this.currentPage}}f="显示"+g+"到"+e+"条,共"+this.pageCount+"条记录";return f},setTotalCount:function(e){this.totalCount=parseInt(e)}};b.init(d,c,a);b.initEvents();return b};String.prototype.getWidth=function(b){var a=document.getElementById("__getwidth");if(a==null){a=document.createElement("span");a.id="__getwidth";document.body.appendChild(a);a.style.visibility="hidden";a.style.whiteSpace="nowrap"}a.innerHTML=this.toString();a.style.fontSize=b+"px";return a.offsetWidth};
Horn.Field=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Field",field:null,hidden:null,checkGroup:null,defValue:"",defHiddenValue:"",init:function(g){Horn.Field.superclass.init.apply(this,arguments);if(this.field==undefined){this.hidden=this.el.children("input[type='hidden']");if(this.hidden.length){this.field=this.hidden.next("input[type]")}else{this.field=this.el.children("input[type]");if(this.field.length==0){this.field=this.el.children("textarea")}}}this.name=this.field.attr("name")||this.name;this.checkGroup={};var d=this,c=this.field.attr("group");if(c){var f=c.split(";");$(f).each(function(i,j){d.checkGroup[j]=true})}this.initEvents();this.defHiddenValue="";this.defValue="";if(this.hidden.length>0){this.defHiddenValue=this.params.defValue||this.hidden.val()||""}if(this.field.length>0){this.defValue=this.params.defValue||this.field.val()||""}if(this.params.hidden&&this.params.hidden==true){this.hide()}if(this.params.maxlength){var b=parseInt(this.params.maxlength,10);if(b>0){if(this.field.val()!=undefined&&d.getStrlen(this.field.val())>b){var e=this.field.val().substr(0,b);this.field.val(e);var a=this.field.prev(":hidden");if(a){a.val(e)}this.params.value=e}}}var h=this.getIEVersion();if(h!=-1&&h<10){if(this.params.emptyText&&this.params.emptyText!=""){if(this.params.value&&this.params.value!=""){this.field.val(this.params.value)}else{this.field.val(this.params.emptyText)}}}this.img=this.el.find(".u-select-down");this.img.click(function(){var i=d.params.url;var j=d.params.isSearch;if(j){if(i!=""&&i!=undefined){var k=$(this).parent().next();if(k.children().length>0){d.showList(d.field,k)}}}});this.field.keyup(function(){var m=$(this);var i=parseInt(d.params.maxlength,10);if(i>0){if(d.getStrlen(m.val())>i){m.val(d.getSubstring(m.val(),i))}}var n={};n.value=this.value;n.name=this.name;var k=d.params.url;var j=d.params.isSearch;if(j){if(k!=""&&k!=undefined){if(this.value.length>0){if(k.length>0){d.doAjax(k,n)}}else{var l=$("#hc_hide-textfield").children("div.hc_checkboxdiv");if(l.children().length>0){d.hideList(d.field,l)}}}}});this.field.focus(function(){var l=d.getIEVersion();if(l!=-1&&l<10){if(d.params.emptyText&&d.params.emptyText!=""){if(d.field.val()==d.params.emptyText){d.field.val("")}}}var i=d.params.url;var j=d.params.isSearch;if(j){if(i!=""&&i!=undefined){var k=$(this).parent().next();if(k.children().length>0){d.showList(d.field,k)}}}});this.field.blur(function(){var k=$(this);var i=parseInt(d.params.maxlength,10);var j=$(this).parent("div.typefield");if(i>0){if(j){if($(this).attr("inputType")=="cardNo"){if(d.getStrlen(k.val())>(i+2)){k.val(d.getSubstring(k.val(),i+2))}}else{if(d.getStrlen(k.val())>(i+1)){k.val(d.getSubstring(k.val(),i+1))}}}else{if(d.getStrlen(k.val())>i){k.val(d.getSubstring(k.val(),i))}}}var l=d.getIEVersion();if(l!=-1&&l<10){if(d.params.emptyText&&d.params.emptyText!=""){if(k.val()==""){d.field.val(d.params.emptyText)}}}})},doAjax:function(a,b){var c=this;var a=a?a:c.url;if(a&&a.indexOf("http:")==-1){a=context_path+a}$.ajax(a,{async:true,type:"POST",data:Horn.Util.obj2Arr(b),dataType:"json",error:function(){alert("没有找到对应的url")},success:function(e,j,g){var d=$("#hc_hide-textfield").children("div.hc_checkboxdiv");if(e&&e!="undefined"){if(e.rows.length>0){var h=[];h=e.rows;d.empty();d.append("<ul></ul>");var f=d.children("ul");$.each(h,function(m,n){var k=f.children("li[key='"+m+"']");if(k.length==0){var k=$("<li key='"+m+"' title='"+n[c.name]+"'></li>");var l=$("<label>"+n[c.name]+"</label>");k.append(l);f.append(k)}});var i=$("div.h_floatdiv-con");if(i){i.mousewheel(function(){c.hideList(c.field,d)});i.scroll(function(){c.hideList(c.field,d)})}c.showList(c.field,d)}else{d.empty();d.hide()}}}})},bodyClick:function(f){var d=this.getEventTarget();if(f.target==f.data.inputEl.get(0)||d.data("isFromOuter")||$(f.target).prev()[0]==f.data.inputEl.get(0)){d.data("isFromOuter",false);var c=f.data.listEl;var b=f.data.inputEl;this.showList(b,c);$(document).one(this.bodyclicktype,f.data,Horn.Util.apply(this.bodyClick,this))}else{var c=f.data.listEl;var b=f.data.inputEl;c.hide();var a=$("li[key]",c);a.unbind("click.li")}},showList:function(h,e){var f=this;if(this.readonly==true){return false}var d={inputEl:h,listEl:e};var g=h.offset(),c=h.outerHeight();e.css("left",g.left+"px");e.css("z-index",Horn.Window.getNextZIndex());e.css("top",(g.top+c)+"px");var b=this.getIEVersion();if(b=="9"){var i=e.children("ul").children("li");if(i.length>3){e.css("width",(h.outerWidth()*(this.longerList?2:1)-2)+18+"px")}else{e.css("width",(h.outerWidth()*(this.longerList?2:1)-2)+"px")}}else{e.css("width",(h.outerWidth()*(this.longerList?2:1)-2)+"px")}e.css("display","block");$(document).one("click.ul",d,Horn.Util.apply(f.bodyClick,f));var a=$("li[key]",e);a.bind("click.li",d,Horn.Util.apply(f.listClick,f))},hideList:function(c,b){b.hide();var a=$("li[key]",b);a.unbind("click.li");if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-1}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-1}},listClick:function(c){var d=this;var b=$(c.currentTarget);b.addClass("h_cur");b.siblings().removeClass("h_cur");this.setValue(b.attr("title"),true,true);this.field.trigger("blur");var a=d.field.parent().next();a.hide()},getStrlen:function(e){var b=Horn.Field.DEFAULT_CH_NUM;var a=0;for(var d=0;d<e.length;d++){var f=e.charCodeAt(d);if((f>=1&&f<=126)||(65376<=f&&f<=65439)){a++}else{a+=b}}return a},getSubstring:function(g,f){var e="";var b=Horn.Field.DEFAULT_CH_NUM;var a=0;for(var d=0;d<g.length;d++){var h=g.charCodeAt(d);if((h>=1&&h<=126)||(65376<=h&&h<=65439)){a++}else{a+=b}if(a<=f){e=e+g[d]}}return e},getIEVersion:function(){var c=-1;if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}else{if(navigator.appName=="Netscape"){var a=navigator.userAgent;var b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}}return c},getEventTarget:function(){this.hidden=this.el.children("input[type='hidden']");if(this.hidden.length){this.field=this.hidden.next("input[type]")}else{this.field=this.el.children("input[type]");if(this.field.length==0){this.field=this.el.children("textarea")}}return this.field},checkRegx:null,initEvents:function(){var a=this;a.checkRegx=[];var b=this.field.attr("checkstr");if(b){a.checkRegx=b.split(";")}this.field.blur(function(){a.validate();var d=a.field.val();if(d!=null&&d!=""){d=d+"";d=d.replace(/(^\s*)|(\s*$)/g,"")}if(a.COMPONENT_CLASS=="Field"||a.COMPONENT_CLASS=="Password"){a.field.val(d)}var c=a.el.attr("class");if(c!="hc_password"&&c!="hc_passwordgroup"){a.field.attr("title",d)}})},validate:function(){if(this.disabled){return}var a=this;var b=a.getIEVersion();if(b!=-1&&b<10){if(a.params.emptyText&&a.params.emptyText!=""&&a.field.val()==a.params.emptyText){a.field.val("")}}if(!this.skipValid){Horn.Validate.onValid({data:[Horn.Validate,a]})}},addGroup:function(a){this.checkGroup[a]=true},removeGroup:function(a){this.checkGroup[a]=false},inGroup:function(a){return !!this.checkGroup[a]},get:function(){if(this.hidden&&this.hidden.length){return this.hidden}return this.field},addRule:function(f){var c=this.get();var b=c.attr(Horn.Validate.CHECK);if(b){if(b.indexOf(f)>-1){return}b+=Horn.Validate.CHECKSEP+f}else{b=f}c.attr(Horn.Validate.CHECK,b);if(f&&f.indexOf(Horn.Validate.REQUIRED)>-1){var a=this.el.parent().parent(".g-unit-wrap");var d=a.children("label");var e=$("span.m-verify-symbol",d);if(!e.length){e=$("<span>",{"class":"m-verify-symbol",html:"*"});d.prepend(e)}else{e.html("*")}}this.removeError();this.field.removeClass("m-verify-success")},removeRule:function(d){var b=this.get();var a=b.attr(Horn.Validate.CHECK);if(a&&a.indexOf(d)>-1){var c=a.split(Horn.Validate.CHECKSEP);c=$.grep(c,function(f,e){return f&&f!=d});b.attr(Horn.Validate.CHECK,c.join(";"));this.removeError();this.setNotRequired()}},skipValid:false,show:function(){this.skipValid=false;var a=this.el.parent().parent(".g-unit-wrap");if(this.el.attr("type")=="hidden"){return}if(a.css("display")=="none"){a.css("display","block")}if(a.css("visibility")=="hidden"){a.css("visibility","visible")}},hide:function(b){this.skipValid=true;b=b||"display";var a=this.el.parent().parent(".g-unit-wrap");if(b=="display"){a.css("display","none")}else{a.css("visibility","hidden")}if(this.err){this.removeError()}},setLabel:function(b){var a=this.el.parent().parent();var c=$("label",a);var d=$("span.m-verify-symbol",c);c.attr("title",b);if(!d.length){c.html(b)}else{c.html('<span class="m-verify-symbol">*</span>'+b)}},getLabel:function(){var a=this.el.parent().parent();var b=$("label",a);return b.attr("title")},setRequired:function(a){if(a===false){this.setNotRequired();return}this.addRule(Horn.Validate.REQUIRED)},setNotRequired:function(){var a=this.el.parent().parent(".g-unit-wrap");var b=$("label",a);var c=$("span.m-verify-symbol",b);this.removeRule(Horn.Validate.REQUIRED);this.field.removeClass("m-verify-error");c.html("")},setEnable:function(b){var a=this.field;var c=this.hidden;var d=a.next("input[type='text']");if(b){a.removeAttr("disabled");d.removeAttr("disabled");if(c){c.removeAttr("disabled")}}else{a.attr("disabled","disabled");d.attr("disabled","disabled");if(c){c.attr("disabled","disabled")}}},setDisabled:function(a){if(a===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(a){if(a===false){this.field.removeAttr("readonly");this.readonly=false}else{this.field.attr("readonly","readonly");this.readonly=true}},setValue:function(a){if(a!=null&&a!=""){a=a+"";a=a.replace(/(^\s*)|(\s*$)/g,"")}this.field.val(a);this.hidden.val(a);this.validate()},getValue:function(){var a=this.get();var b=a.val();var c=this.getIEVersion();if(c!=-1&&c<10){if(this.params.emptyText&&this.params.emptyText!=""){if(b==this.params.emptyText){b=""}}}if(b!=null&&b!=""){b=b+"";b=b.replace(/(^\s*)|(\s*$)/g,"")}return b},reset:function(a){var b="";if(this.hidden&&this.hidden.length>0){b=a?"":this.defHiddenValue}else{b=a?"":this.defValue}this.setValue(b)},clearValue:function(){if(this.cal1){var b=this.name1;var a=this.name2;this.setValue({name1:null,name2:null})}else{this.setValue("")}},bind:function(c,d,b){var a=this.get();if($.type(d)=="function"){a.bind(c,d)}else{a.bind(c,d,b)}},isValid:function(){if(this.disabled){return true}return !this.err},err:false,msgDiv:null,showError:function(a){var b=this.field;b.removeClass("m-verify-success");b.addClass("m-verify-error");a=$.type(a)=="boolean"?"校验错误":a;if(!this.msgDiv){this.msgDiv=$('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">'+a+"</div>");c.css("display","block");this.err=true},removeError:function(){this.field.removeClass("m-verify-error");var b=this.get();var a=b.attr(Horn.Validate.CHECK);if(a){if(this.isValid){this.field.addClass("m-verify-success")}}this.err=false;var c=this.msgDiv;if(c){c.remove()}delete this.msgDiv},mutiName:function(){return false}});$.extend(Horn.Field,{get:function(a,b){if(jQuery.type(a)!="string"){var c=$(a);a=c.attr("name");b=c.attr("alias");if(!a){var d=c.prev("input[type='hidden'][name]");a=d.attr("name");b=d.attr("alias")}}var e=Horn.getComp(a,b);return e},addRule:function(a,d,b){var c=this.get(a,b);c.addRule(d)},removeRule:function(a,d,b){var c=this.get(a,b);c.removeRule(d)},show:function(a,b){var c=this.get(a,b);c.show()},hide:function(a,b){var c=this.get(a,b);c.hide("display")},hidden:function(a,b){var c=this.get(a,b);c.hide("visibility")},setRequired:function(a,b){var c=this.get(a,b);c.setRequired()},setNotRequired:function(a,b){var c=this.get(a,b);c.setNotRequired()},setEnable:function(b,a,c){var d=this.get(b,c);d.setEnable(a)},setReadonly:function(a,d,b){var c=this.get(a,b);c.setReadonly(d)},setLabel:function(b,a,c){var d=this.get(b,c);d.setLabel(a)},getLabel:function(a,b){var c=this.get(a,b);return c.getLabel()},setValue:function(a,c,b){var d=this.get(a,b);if(d){d.setValue(c)}else{this.getField(a,b).val(c)}},getValue:function(a,b,c){var d=this.get(a,b);if(d){return d.getValue()}else{return this.getField(a,b,c).val()}},reset:function(a,b){var c=this.get(a,b);if(c){c.reset()}else{this.getField(a,b).each(function(){this.reset()})}},clearValue:function(a,b){var c=this.get(a,b);if(c){c.clearValue()}else{this.getField(a,b).val("")}},bind:function(a,b,d,e,c){var f=this.get(a,b);f.bind(d,e,c)},getSelector:function(b,c){var a="";if(b){a+="[name='"+b+"']"}if(c){a+="[alias='"+c+"']"}return"input"+a+",textarea"+a},getField:function(b,c,d){var f=Horn.getCurrent();c=c||"";var e=null;if(!d){d=f.find("form");if(jQuery.type(b)=="string"){var a=Horn.Field.getSelector(b,c);e=$(a,d)||$(a);if(!c){e=e.not(":disabled")}}else{e=$(b,d)}return e}else{return d.findField(b,c)}},findFieldCompsIn:function(b){var a=[];this.findFieldsIn(b).each(function(c,d){var e=Horn.getCompByEl($(d));if(e){a.push(e)}});return $(a)},findFieldsIn:function(a){return $(a).find(this.TYPES.join(","))},findInputComp:function(a){return $(a).parents(this.TYPES.join(",")).first().comp()},TYPES:[],regFieldType:function(a,b){Horn.regUI(a,b);this.TYPES.push(a)}});Horn.apply(Horn.Field,{DEFAULT_CH_NUM:2});Horn.Field.regFieldType("div.hc_textfield._text",Horn.Field);Horn.Field.regFieldType("div.hc_textarea",Horn.Field);
Horn.FieldSet=Horn.extend(Horn.Base,{COMPONENT_CLASS:"FieldSet",hidden:null,params:null,init:function(a){Horn.FieldSet.superclass.init.apply(this,arguments);Horn.apply(this,this.params);if(this.params.hidden&&this.params.hidden==true){this.hide()}},show:function(){var a=this.el;a.css("display","block")},hide:function(){var a=this.el;a.css("display","none")}});Horn.regUI(".h_fieldset",Horn.FieldSet);
Horn.Form=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Form",form:null,ajax:false,ajaxCallback:false,onSuccessObj:null,baseParams:null,init:function(){Horn.Form.superclass.init.apply(this,arguments);this.form=this.el;var i=this.form.attr("ajax");var j=this;this.baseParams={};this.beforeSubmit=this.params.beforeSubmit;var b=this;$.each(this.params.events||[],function(e,l){b[l.event]=l["function"]});if(this.beforeSubmit){var c=Horn.Util.getFunObj(this.beforeSubmit);if(c&&$.type(c.fn)=="function"){this.on("beforesubmit",c.fn)}}var a=function(){return j.fire("beforesubmit")};var h=j.toAjaxForm;j.toAjaxForm=function(){j.el.unbind("submit",a);h.call(j)};if(!i){j.el.submit(a)}else{try{var k=Horn.Util.decode(i);if($.isPlainObject(k)){var g=k.onSuccess;if(g){var f=Horn.Util.getFunObj(g);if(f&&$.type(f.fn)=="function"){this.on("ajaxsuccess",f.fn)}}}}catch(d){}j.toAjaxForm()}j.on("beforesubmit",j.isValid);this.form.bind("reset",function(){j.reset(false);return false});if(j.el.find(":file").get(0)){j.el.attr("enctype","multipart/form-data")}},customEvents:"beforesubmit",getEventTarget:function(){return this.el},toAjaxForm:function(){var a=this;if(this.ajax===true){return}this.ajax=true;this.el.submit(function(){if(a.fire("beforesubmit")==true){a.doPost()}return false})},setBaseParams:function(a){this.baseParams=a},doPost:function(){var values=this.getValues();var url=this.form.attr("action");Horn.apply(values,this.baseParams);url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+(values.pagelet||new Date().getTime());function onAjaxComplate(result){var data=eval("("+result+")");BigPipe.onArrive(data);BigPipe.start();Horn.init()}$.post(url,values,onAjaxComplate)},submit:function(){this.form.submit()},reset:function(a){if(!a===false){this.form.get(0).reset()}Horn.Field.findFieldCompsIn(this.form).each(function(){if($.isFunction(this.reset)){this.reset()}});var b=this.form.find("div.hc_label[name]");b.each(function(c,e){var f=$(e);var d=Horn.getCompByEl(f);d.setValue("")});this.removeError()},clearValue:function(){Horn.Field.findFieldCompsIn(this.form).each(function(){this.clearValue()});var a=this.form.find("div.hc_label[name]");a.each(function(b,d){var e=$(d);var c=Horn.getCompByEl(e);c.setValue("")});this.removeError()},getIEVersion:function(){var c=-1;if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}else{if(navigator.appName=="Netscape"){var a=navigator.userAgent;var b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}}return c},getValues:function(){var b=this.getIEVersion();if(b!=-1&&b<10){this.getFieldComps().each(function(c,d){var f=d.el.children("input").val();var e=d.el.children("input").attr("placeholder");var h=d.el.children("textarea").val();var g=d.el.children("textarea").attr("placeholder");if(e&&e==f){d.el.children("input").val("")}if(g&&g==h){d.el.children("textarea").val("")}})}var a=this.form.serializeArray();var b=this.getIEVersion();if(b!=-1&&b<10){this.getFieldComps().each(function(c,d){var f=d.el.children("input").val();var e=d.el.children("input").attr("placeholder");var h=d.el.children("textarea").val();var g=d.el.children("textarea").attr("placeholder");console.log(e+":"+f);console.log(g+":"+f);if(e!=""&&f==""){d.el.children("input").val(e)}if(g!=""&&h==""){d.el.children("textarea").val(g)}})}return Horn.Util.arr2Obj(a)},getFieldComps:function(){return Horn.Field.findFieldCompsIn(this.el)},setValues:function(c,d,a){var b=c;if(!d){d=""}if($.isArray(c)){b=Horn.Util.arr2Obj(c)}this.getFieldComps().each(function(f,j){var g=j.mutiName();if(g){var k={};var h=0;$(g).each(function(i,l){k[l]=b[l.replace(new RegExp("^"+d+""),"")];if(k[l]){h++}});if(h!=0){j.setValue(k||"")}else{if(!(a==false)){j.setValue("")}}}else{var k=b[j.name.replace(new RegExp("^"+d+""),"")];if(k){j.setValue(k)}else{if(!(a==false)){if(k==0){j.setValue(k)}else{j.setValue("")}}}}});var e=this.form.find("div.hc_label");e.each(function(f,h){var j=$(h);var g=Horn.getCompByEl(j);var i=b[g.name.replace(new RegExp("^"+d+""),"")];g.setValue(i)})},removeError:function(){this.getFieldComps().each(function(a,b){b.removeError()})},isValid:function(){return Horn.Validate.isFormValidate(this.form)},serializeArray:function(){return this.form.serializeArray()},serialize:function(){return this.form.serialize()},findField:function(b,f){var c=f||"";var e=null;var d=this.el;if(jQuery.type(b)=="string"){var a=Horn.Field.getSelector(b,c);e=$(a,d);if(!c){e=e.not(":disabled")}}else{e=$(b,d)}return e}});$.extend(Horn.Form,{DATANAME:"h_form",get:function(b){var a=Horn.data(Horn.Form.DATANAME);var c=a[0];return c}});Horn.regUI("form",Horn.Form);
Horn.Grid=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Grid",titleEl:null,data:null,curData:null,curTr:null,rowSelect:false,keyAttr:"label",valueAttr:"value",init:function(c){Horn.Grid.superclass.init.apply(this,arguments);this.ths=this.el.find("th");var d=this;var b=this.params.data||{};this.data=b;if(this.params.selectModel=="muti"||this.params.selectModel=="multi"){this.mutiSelect=true}this.curTr=this.el.find("tr.u-table-selected");var a=this.el.children("table").children("tbody").children("tr");this.curData=this.data[a.index(this.curTr)-1];this.rowSelect=Boolean(this.params.rowSelect);this.textOverHidden=this.params.textOverHidden?this.params.textOverHidden:false;this.ths.each(function(j,f){var h=f.attributes.hidden;f=$(f);var k=f.attr("dictName"),l=f.attr("colno"),e;var g=f.attr("width");var i,m;if(l){i=d.params.items[l-1].items;m=d.params.items[l-1].buttons}if(k){e={};var n=$(".hc_checkboxdiv[ref_target="+k+"_s]").find("li");n.each(function(p,o){o=$(o);var q=o.attr("title");var r=o.attr("key");e[r]=q})}else{if(i){e={};$(i).each(function(o,p){e[p[d.keyAttr]]=p[d.valueAttr]})}else{if(g){}}}f.data("staticDict",e);f.data("buttons",m)});this.el.find(".h_querytable_select_all").change(function(){if(this.checked){d.selectAll()}else{d.unSelectAll()}});this.selecteds={};this.dictTrans();this.initEvents();this.initToolbarEvents();if(this.params.isDragColumn){if(this.params.name&&this.params.name!=""){$("."+this.params.name).resizableColumns({})}}if(!this.textOverHidden){this.resetTdContent()}},customEvents:"rowclick,rowdblclick",getEventTarget:function(){return this.el},setButtonDisabled:function(a,b){var c=this.el.children("div.u-datagrid-toolbar").children("ul").children("li");c.each(function(f,d){var e=$(this).children("a");var g=e.attr("name");if(g==a){if(b){e.addClass("f-disabled");e.attr("onclick","javascript:return false;")}else{e.removeClass("f-disabled");e.attr("onclick",e.attr("event"))}return}})},initToolbarEvents:function(){var a=this.el.children("div.u-datagrid-toolbar").children("ul").children("li");a.each(function(d,b){var c=$(this).children("a");if(c.hasClass("f-disabled")){c.attr("onclick","javascript:return false;")}c.bind("click",function(f){if($(this).hasClass("f-disabled")){$(this).attr("onclick","javascript:return false;")}else{$(this).attr("onclick",$(this).attr("event"))}})})},initEvents:function(){var c=this.el.children("div.u-datagrid").children("table");var l=c.children("tbody");var j=this;var d=j.el.find(".h_querytable_select_all").length>0?true:false;if(d){this.el.find("input:checkbox.h_querytable_select").change(function(){j.stateTest()})}if(this.rowSelect==true){l.children("tr").each(function(p,r){var s=p;var o=$(r),q=j.mutiSelect?o.find("input:checkbox.h_querytable_select"):o.find("input:radio.h_querytable_select");o.bind("click",function(i){if($.isEmptyObject(j.selecteds)){j.selectRow(s,o)}else{if(!j.selecteds.hasOwnProperty(s)){j.selectRow(s,o)}else{j.unSelectRow(s,o)}}if(d){j.stateTest()}})})}var n=undefined;var k=undefined;var b=undefined;var a=undefined;var g=this.data;$.each(this.params.events||[],function(p,q){j[q.event.toLowerCase()]=q["function"]});if(this.rowclick){n=Horn.Util.getFunObj(this.rowclick);if($.type(n.fn)=="function"){b=n.fn}}if(this.rowdblclick){k=Horn.Util.getFunObj(this.rowdblclick);if($.type(k.fn)=="function"){a=k.fn}}if(b||a){var h=l.children("tr");for(var f=0;f<g.length;f++){var m=$(h.get(f));if(b){var e=n.params.slice(0);e.push(g[f],g);m.bind("click",e,function(o){var i=o.data;return n.fn.apply(this,i)})}if(a){var e=k.params.slice(0);e.push(g[f],g);m.bind("dblclick",e,function(o){var i=o.data;return k.fn.apply(this,i)})}}}},resetTdContent:function(){var g=this;var b=this.el.children("div.u-datagrid").children("table").children("tbody").children("tr");var c=this.el.children("div.u-datagrid").children("table").children("thead").children("tr").children("th");var f=[];if(this.data&&this.data.length>0){for(var d=0;d<this.data.length;d++){var a=this.data[d];$.each(a,function(h,i){f.push(h)});break}}var e=[];b.each(function(p,k){var m=$(k);var i=m.find("td");for(var l=0;l<i.length;l++){var h=$(i[l]);var j=h.attr("width");var o=h.children("div");var n=o.text();if(g.getStrlen(n)>40){if(e.indexOf(l)==-1){e.push(l)}if(!j){o.css("width",300);h.css("width",300)}}}})},getStrlen:function(e){var b=2;var a=0;for(var d=0;d<e.length;d++){var f=e.charCodeAt(d);if((f>=1&&f<=126)||(65376<=f&&f<=65439)){a++}else{a+=b}}return a},setTitle:function(a){this.el.children("div.u-datagrid-header").children("h4").text(a)},onRowSelect:function(){},selecteds:null,stateTest:function(){var b=this;var a=true;b.el.find("input:checkbox.h_querytable_select").each(function(c,d){if(!$(d).prop("checked")){a=false}});if(a){b.el.find(".h_querytable_select_all").prop("checked",true)}else{b.el.find(".h_querytable_select_all").prop("checked",false)}},selectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=true;if(a.rowSelect==false){$(c).trigger("change")}else{a.selectRow(b)}});a.lastSelect={rowidx:"all"};this.el.find(".h_querytable_select_all").attr("checked",true)},unSelectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=false;if(a.rowSelect==false){$(c).trigger("change")}else{a.unSelectRow(b)}});this.el.find(".h_querytable_select_all").prop("checked",false)},lastSelect:null,mutiSelect:false,selectRow:function(b,d){var c=this;var g=d;if(!g){g=$(this.el.find("tr").has("td").get(b))}if(g.size()==0){Horn.debug("Grid["+this.name+"]","选择的行"+b+"不存在");return false}var h={};var f={};var a=this.ths;var e=g.find("td");a.each(function(m,j){var l=e.get(m),k=$(j);if(k.attr("name")){h[k.attr("name")]=k.attr("dictName")?$(l).attr("key"):$(l).text();f[k.attr("name")]=$(l).text()}});c.onRowSelect.call(g,g,b,h);this.selecteds[b]={val:h,displays:f};if(!c.mutiSelect){var i=c.lastSelect;if(i&&i.rowidx!=b){if(this.mutiSelect){i.tr.find("input:checkbox.h_querytable_select").prop("checked",false)}else{i.tr.find("input:radio.h_querytable_select").prop("checked",false)}c.unSelectRow(i.rowidx,i.tr)}}c.lastSelect={rowidx:b,tr:g};if(this.mutiSelect){g.find("input:checkbox.h_querytable_select").prop("checked",true)}else{g.find("input:radio.h_querytable_select").prop("checked",true)}g.addClass("u-table-selected")},unSelectRow:function(c,a){var b=a;if(!b){b=$(this.el.find("tr").has("td").get(c))}this.selecteds[c]=null;delete this.selecteds[c];b.removeClass("u-table-selected");if(this.mutiSelect){b.find("input:checkbox.h_querytable_select").prop("checked",false);this.el.find(".h_querytable_select_all").prop("checked",false)}else{b.find("input:radio.h_querytable_select").prop("checked",false)}},getSelecteds:function(e){var d=[];for(var c in this.selecteds){var b=this.selecteds[c];if(b){var a=b.val;if(e===true){a=this.data[c]}else{if(e==1){a=b.displays}}d.push(a)}}return d},changeCurrent:function(a){if(!a instanceof $){a=this.el.children("tbody").children("tr")[a]}if(!this.curtr){this.curtr=this.el.find("tr.u-table-selected")}var b=this.el.children("table").children("tbody").children("tr").index(this.curtr);this.curtr.removeClass("u-table-selected");a.addClass("u-table-selected");this.curtr=a;this.curData=this.data[b-1]},getCurrentData:function(){return this.curData},hiddenColumns:function(){var a=this.el.children("table").children("tbody").children("tr");var b=this.ths;b.each(function(f,e){var c=$(e);var d=e.attributes.hidden;if(d!=null&&d!=undefined&&d.value=="true"){c.hide();a.each(function(i,h){var k=$(h);var j=k.find("td");for(var g=0;g<j.length;g++){var l=$(j[g]);if(f==g){l.hide();break}}})}})},formatColumn:function(a,b,c){return Horn.Util.Format.all(a,b,c)},resetTHWidth:function(){var d=this.ths;var f=d.size();var b=this.el.children("table");var g=b.width();var c=[];d.each(function(i,l){var j=$(l);if(j.hasClass("h_numbercolumn")||j.hasClass("h_querytable_checkboxcolumn")){j.addClass("h_table_th_extend")}else{if(l.attributes.hidden){var k=l.attributes.hidden;if(k!=null&&k!=undefined&&k.value=="true"){f--}}else{if(j.attr("width")){f--}else{c.push(j)}}}return true});var h=100/f;for(var e=0;e<c.length;e++){var a=c[e].attr("class");if(a&&a=="u-table-time"){c[e].css("width",h.toFixed(2)+"%")}}e},dictTrans:function(){var b=this,c=this.ths,a=this.el.find("tr");a.each(function(e,d){var g=$(d),f=b.mutiSelect?g.find("input:checkbox"):g.find("input:radio");if(f.hasClass("h_querytable_select")){if(b.rowSelect==false){f.change(function(){if(this.checked){b.selectRow(e-1,g)}else{b.unSelectRow(e-1,g)}})}if(f.attr("checked")){setTimeout(function(){b.selectRow(e,g)},3)}}g.find("td").each(function(h,l){var o=$(l);var n=o.children("div");var m=$(c.get(h));var j=m.attr("dictname"),k=m.attr("multiple"),t=m.data("staticDict"),s=m.attr("renderer"),z=m.data("buttons"),i=m.attr("showwhenover"),u=m.attr("dataType"),y=m.attr("format");if(t){o.attr("key",o.text());var r=n.text()||"";if(k){var q=[];$(r.trim().split(",")).each(function(C,D){q.push(t[D]||D)});n.html(q.join(","));o.attr("title",q.join(","))}else{if(r==""||t[o.text().trim()]==undefined){n.html("");o.attr("title","")}else{n.html(t[n.text().trim()]||n.text());o.attr("title",t[n.text().trim()]||n.text())}}}else{if(z){o.attr("title","");var w=z;var v=$("<span></span>");$(w).each(function(G,D){var E=Horn.Util.getFunObj(D.event);if(!E.fn){return}var C=$("<a href='javascript:void(0)'>"+D.label+"</a>"),F=n.text();C.click(function(){E.fn.call(C,{val:F,rowdata:b.data[e-1],alldata:b.data,table:b,rowidx:e,tdidx:h,tr:g,td:o})});v.append(C);if(G!=(w.length-1)){v.append(" | ")}});if(i){v.addClass("h_link-default")}n.html("");o.append(v)}else{if(u){var B=n.text();var A=b.formatColumn(u,y,B);n.html(A);o.attr("title",A)}}}if(s){o.attr("key",o.text());o.attr("title","");var p=Horn.Util.getFunObj(s),r=n.text();if(!p.fn){return}var x=p.fn.call($(this),{val:r,rowdata:b.data[e-1],alldata:b.data,table:b,rowidx:e,tdidx:h,tr:g,td:o});if(x instanceof $){n.html("");o.append(x)}else{n.html(x)}}})})},addRowData:function(a){}});Horn.regUI("div.h_formtable",Horn.Grid);
Horn.HiddenField=Horn.extend(Horn.Field,{COMPONENT_CLASS:"HiddenField",init:function(){Horn.HiddenField.superclass.init.apply(this,arguments);this.field=this.el;this.name=this.field.attr("name");this.alias=this.field.attr("alias")||"";this.defValue=(this.params.defValue!=undefined)?this.params.defValue:this.field.val()},isValid:function(){return true},showError:function(){},reset:function(a){if(a){this.field.val("")}else{this.field.val(this.defValue)}},removeError:function(){}});Horn.Field.regFieldType("input.hc_hiddenfield",Horn.HiddenField);
Horn.Label=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Label",el:null,dictName:null,staticDict:null,mutiValue:null,init:function(e){Horn.Label.superclass.init.apply(this,arguments);var d=this.params;if(d.name||d.hiddenName){this.name=d.name||d.hiddenName}this.mutiValue=$(e).attr("mutivalue");this.label=this.el.prev("span");this.hidden=this.el.find("input:hidden");if(d.hiddenName){this.hidden=this.el.next("input:hidden")}this.li=this.el.parent();if(this.hidden){this.el.parent().append(this.hidden)}var j=d.dictName,a=d.items,h=d.labelField||"label",k=d.valueField||"value",b=d.delimiter,l=this.hidden.get(0)?this.hidden.val():this.el.html();if(b==""||this.delimiter){this.delimiter=b;this.mutiValue=true}else{this.delimiter=","}if(a){var c={};for(var g=0;g<a.length;g++){var f=a[g];c[f[h]]=f[k]}a=c}if(j){this.dictName=j;a=Horn.getDict(j)}this.staticDict=a;if(l){this.setValue(l)}},setValue:function(d){d=$.trim(d);if(this.hidden){this.hidden.val(d)}var h=this.dictName,b=this.staticDict;var e=function(k){var j="";if(b){j=b[k]||k}else{if(h){var i=$(".hc_checkboxdiv[ref_target="+h+"_s]").find("li[key="+k+"]");j=i.attr("title")||k}else{j=k}}return j};var a="";var g=false;if(!d){d=""}if(this.mutiValue){var c=[];$(d.split(this.delimiter)).each(function(i,k){var j=e(k);c.push(j||k)});a=c.join(this.delimiter||",");g=true}else{a=e(d)}this.el.html(a);var f=this.el.attr("title");if(g){this.el.addClass("hc_texthide")}this.el.attr("title",a)},getValue:function(){if(this.hidden.get(0)){return this.hidden.val()}return this.el.text()},setLabel:function(a){this.label.html(a)},getLabel:function(){return this.label.html()},hide:function(){this.li.hide()},show:function(){this.li.show()}});Horn.regUI("div.hc_label",Horn.Label);
Horn.Menu=Horn.extend(Horn.Base,{COMPONENT_CLASS:"menu",id:"menu",baseMenuEl:null,baseMenuItem:null,rootMenu:null,zindexInit:9999,opendir:"R",tier:0,classOneNum:0,init:function(a){Horn.Menu.superclass.init.apply(this,arguments);var b=this;this.classOneNum=this.params.items.length;this.id=this.params.id?this.params.id:this.id;this.el.attr("id",this.id);this.opendir=this.params.opendir?this.params.opendir:this.opendir;this.baseMenuEl=this.el.next();this.baseMenuItem=$("li",this.baseMenuEl);this.recursionItems(this.baseMenuEl,this.params);this.baseMenuEl.appendTo(this.el);$("li[base='']",this.el).remove();this.rootMenu=this.el.children("ul");this.rootMenu.css({"z-index":b.zindexInit-1});$(document).bind("click",function(c){if($(c.target).closest("*[refmenu="+b.id+"]").size()==0&&c.button==0){b.hideMenu()}});if(this.params.isContextMenu){document.oncontextmenu=function(d){d=d||window.event;if(d.button==2||d.type=="contextmenu"){var c=navigator.userAgent;if(navigator.appName!="Microsoft Internet Explorer"){window.event=d}b.showMenu();return false}}}$("*[refmenu="+b.id+"]").click(function(){if(!b.isContextDisabled($(this))){b.reCalOpendir($(this));if(!b.rootMenu.is(":visible")){b.showMenu($(this))}else{b.hideMenu()}}});$("*[refmenu="+b.id+"]").each(function(c,d){$("<i class='fa fa-caret-down'></i>").appendTo($(d));if(d.tagName=="A"||d.tagName=="a"){$(d).css({"text-decoration":"none"})}});$(window).bind("resize",function(){b.hideMenu()});this.el.prependTo($(document.body))},reCalOpendir:function(a){var b;var e={};var d=a.offset().left;var c=150;if(this.tier<4){b=this.tier*c;e.left=b<d+a.width();e.right=b<$(window).width()-d}else{e.left=e.right=true}if(e.left&&e.right||(!e.left&&!e.right)){return}if(this.opendir=="L"&&!e.left){this.opendir="R"}if(this.opendir=="R"&&!e.right){this.opendir="L"}},recursionItems:function(c,d){this.tier++;var f=this;if(d.items){var b=0;while(b<d.items.length){var e=f.processparam(f.baseMenuItem.clone(true).removeAttr("base"),d.items[b]);if(d.items[b].items){f.zindexInit++;var a=f.baseMenuEl.clone(true).css({"z-index":f.zindexInit});a.appendTo(e);f.recursionItems(a,d.items[b])}e.appendTo(c);b++}}},processparam:function(a,b){if(b.tips){$("a",a).attr("title",b.tips)}if(b.hasLine){$("span.h_toolbar-item-txt",a).addClass("h_menu-line")}if(b.event){$("a",a).attr("onclick",b.event)}if(b.icon){$("span.h_toolbar-item-icon",a).html("<img width='20px' src='"+b.icon+"'>")}if(b.label){$("span.h_toolbar-item-txt",a).text(b.label)}if(!b.items){$("span.h_toolbar-item-arrow",a).remove()}return a},showMenu:function(b,c,a){var e=this;if(!c){c=this.rootMenu}var d=this.getShowPosition(b,a);c.css({top:d.Y,left:d.X});c.show();c.children("li").hover(function(){var f=$(this).children("ul");if(f.size()==1){e.showMenu($(this),f,true)}},function(){var f=$(this).children("ul");if(f.size()==1){f.hide()}})},getShowPosition:function(c,d){var g=this;var h=150;var f,i,b,j;if(!c){f=window.event.clientX;i=window.event.clientY;j=0;b=0}else{f=c.offset().left;i=c.offset().top;b=c.outerWidth();j=c.outerHeight()}var e=function(){var k,l;k=-j;if(g.opendir=="R"&&(f+b+h)>$(window).width()||g.opendir=="L"){g.opendir="L";l=-b}if(g.opendir=="L"&&(f-h)<0||g.opendir=="R"){g.opendir="R";l=b}return{X:l,Y:k}};var a=function(){var n,o;var l=g.classOneNum;var m=$(window).height();var k=l*39;if(i+b+k>m){n=i-k}else{n=i+j}if((f+h)>$(window).width()||(g.opendir=="L"&&(f-h)>0)){o=f-h+b;g.opendir="L"}else{o=f}return{X:o,Y:n}};if(d){return e()}else{return a()}},hideMenu:function(){this.rootMenu.hide();this.rootMenu.css({top:1200,left:600});this.opendir=this.params.opendir},addItem:function(b){var a=this.processparam(this.baseMenuItem.clone(true).removeAttr("base"),b);a.appendTo(this.rootMenu)},isContextDisabled:function(a){return a.hasClass("h_btn-disabled")}});Horn.regUI("div.hc_menu",Horn.Menu);
var Horn=Horn||{};(function(b){var c=function(A){if(window.event){Horn.debug("event keycode = ",window.event.keyCode);var u=window.event;var k=u.srcElement;Horn.debug("firedObj = ",k);$(k).blur()}var y='<div class="m-message-positon"  id="h_msg_floatdiv"><div class="m-message-header"><h4 class="m-message-title"></h4></div><div class="g-wrap m-message-body m-brt-none" ><div class="m-body-words"><span class="m-message-icon"><i class="fa fa-question"></i></span></div></div><div class="h_btndiv m-message-footer"></div></div>';var z=$(y);if(A.msgTitle){z.find(".m-message-header h4").html(A.msgTitle);z.find(".m-message-header").attr("title",A.msgTitle)}if(A.msgText){z.find(".m-body-words").append(A.msgText);z.find(".m-body-words").attr("title",A.msgText)}if(A.width){z.css("width",A.width+"px")}if(A.height){z.css("height",A.height+"px")}else{z.css("height","auto")}if(A.msgType){z.find(".m-message-icon").removeClass().addClass("m-message-icon "+A.msgType)}if(A.msgCss){z.find(".m-message-icon i").removeClass().addClass("fa "+A.msgCss)}var o='<button type="button" id="buttonOK" class="h_btn-submit u-btn u-btn-primary">确定</button>';var l='<button type="button" id="buttonCancel" class="h_btn-cencel u-btn">取消</button>';var m=o+l;if(A.msgType&&A.msgType==Horn.Msg.CONFIRM){z.find(".h_btndiv").html(m)}else{z.find(".h_btndiv").html(o)}var n=jQuery.support.boxModel;var B=document.documentElement;var q=n&&B.clientWidth||document.body.clientWidth;var t=n&&B.clientHeight||document.body.clientHeight;var s=n&&B.scrollLeft||document.body.scrollLeft;var f=n&&B.scrollTop||document.body.scrollTop;var e=n&&B.scrollHeight||document.body.scrollHeight;var r=n&&B.scrollWidth||document.body.scrollWidth;var g="100%";var p="100%";if(s==0&&r<800){g="100%"}else{var x=r+s;g=x+"px"}if(f==0&&e<500){p="100%"}else{var i=e+f;p=i+"px"}var C=$("<div></div>").append('<div class="m-message-bg" id="h_msg_bg"></div>').append(z.clone());C.find("div.m-message-bg").css("width",g).css("height",p);var v=C.find(".h_btn-submit");if(v.length>0){v.unbind("click");v.bind("click",function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-2}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-2}C.remove();if(Horn.Window.getPrevOpen()<1){$("body").removeClass("h-overflow-hidden");$("html").removeClass("h-overflow-hidden")}if(A.onOK){A.onOK()}})}var j=C.find(".h_btn-cencel");if(j.length>0){j.unbind("click");j.bind("click",function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-2}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-2}C.remove();if(Horn.Window.getPrevOpen()<1){$("body").removeClass("h-overflow-hidden");$("html").removeClass("h-overflow-hidden")}if(A.onCancel){A.onCancel()}})}C.find(".m-message-bg").css("z-index",Horn.Window.getNextZIndex());C.find(".m-message-positon").css("z-index",Horn.Window.getNextZIndex());if(Horn.Window.getOpen()<1){$("html").addClass("h-overflow-hidden")}Horn.Window.getNextOpen();$("body").prepend(C);a(C.find(".m-message-positon"));$(window).resize(function(){if(C&&!C.is(":hidden")){a(C.find(".m-message-positon"))}});C.mousewheel(function(){return false})};var a=function(e){var l=$(window),g=e,j=0,f=0;var o=l.height();var k=l.width();var m=g.height();var i=g.width();j=o-m;f=k-i;var n=j/2+$(document).scrollTop();var h=f/2+$(document).scrollLeft();g.css("top",n+"px");g.css("left",h+"px")};var d=function(e){this.params={width:350};Horn.apply(this.params,e);c(this.params)};b.Msg={INFO:"m-message-info",WARNING:"m-message-warning",ERROR:"m-message-error",CONFIRM:"m-message-success",show:function(e){d(e)},alert:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.INFO,msgCss:"fa-check"};d(e)},warning:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.WARNING,msgCss:"fa-exclamation"};d(e)},wraning:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.WARNING,msgCss:"fa-exclamation"};d(e)},error:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.ERROR,msgCss:"fa-times"};d(e)},confirm:function(i,h,f,e){var g={msgTitle:i,msgText:h,onOK:f,onCancel:e,msgType:this.CONFIRM,msgCss:"fa-question"};d(g)}}})(Horn);
Horn.PageBar=Horn.extend(Horn.Base,{COMPONENT_CLASS:"PageBar",targetName:null,target:null,url:null,init:function(a){Horn.PageBar.superclass.init.apply(this,arguments);Horn.apply(this,this.params);this.targetName=this.el.attr("target");this.url=this.el.attr("url");if(!this.url){this.url=window.location.href}this.initPageParams();this.initEvent()},initPageParams:function(){var a="";if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){a=this.el.attr("bindformname")}var b=this.el;this.page=parseInt(b.attr("pageNo"))||this.page;this.pageSize=parseInt(b.attr("pageSize"))||this.pageSize;this.pageCount=parseInt(b.attr("pageCount"))||this.pageCount;this.pages=parseInt(b.attr("pages"))||this.pages;this.gridId=b.attr("id")||"dyncGrid";this.bindFormName=b.attr("bindFormName")||"";if(this.pageCount<=0||this.pages<=0){$("#"+a+"_topageid").attr("disabled","disabled");$("#"+a+"_topagesize").attr("disabled","disabled");$("#"+a+"_pagebtn-go").attr("disabled","disabled")}else{$("#"+a+"_topageid").removeAttr("disabled");$("#"+a+"_topagesize").removeAttr("disabled");$("#"+a+"_pagebtn-go").removeAttr("disabled")}},initEvent:function(){var b=this;var a="";if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){a=this.el.attr("bindformname")}this.el.children("ul").children("li").children("a").each(function(d,e){var g=$(e),f=function(i,j,h){i.click(function(){if(i.hasClass("disabled")){return}if(i.hasClass("h_pagebtn-next")||i.hasClass("h_pagebtn-prev")){i.addClass("disabled")}j.call(b,h)})};if(!g.hasClass("disabled")){if(g.hasClass("h_pagebtn-index")){f(g,b.goPage,b.INDEX_PAGE)}else{if(g.hasClass("h_pagebtn-end")){f(g,b.goPage,parseInt(b.pages))}else{if(g.hasClass("h_pagebtn-next")){f(g,b.nextpage)}else{if(g.hasClass("h_pagebtn-prev")){f(g,b.prevpage)}else{if(g.hasClass("h_page-num")){f(g,b.goPage,parseInt(g.text()))}else{if(g.hasClass("h_pagebtn-go")){g.bind("click",function(j){var h=document.getElementById(a+"_topageid").value;var i=document.getElementById(a+"_topagesize").value;if(i==0){i=10}var k=[];k.push(parseInt(h),parseInt(i));return b.goPage.apply(b,k)})}}}}}}}});this.perPage=false;$("#_recPerPage"+this.gridId).on("click",function(){optGridId=$(this).attr("id");optGridId=optGridId.substring(11);var d=$(this).children("strong").text();if(b.perPage){$(this).next().hide();b.perPage=false}else{$(this).next().show();$(this).next().find("li").each(function(e,f){var g=$(this).children("a").text();if(d==g){$(this).addClass("active")}else{$(this).removeClass("active")}});b.perPage=true}});$("#_recPerPage"+this.gridId).bind("blur",function(f){var d=f;if(b.perPage){$(".dropdown-menu-datagrid").hide();b.perPage=false;return true}});$(".dropdown-menu-datagrid").bind("mouseover",function(){$("#_recPerPage"+b.gridId).unbind("blur")});$(".dropdown-menu-datagrid").bind("mouseout",function(){$("#_recPerPage"+b.gridId).bind("blur",function(f){var d=f;if(b.perPage){$(".dropdown-menu-datagrid").hide();b.perPage=false;return true}})});this.activeLi=$(".dropdown-menu-datagrid").find("li.active");var c=this;$("#toPage_"+c.id).on("keydown",function(g){var d=g.keyCode;if(d==27||d==8){return true}if(d>=48&&d<=57){return true}if(d>=96&&d<=105){return true}var f=new RegExp("[0123456789]");var h=String.fromCharCode(d);if(!f.test(h)){return false}});$("#"+this.bindFormName+"_topageid").on("blur",function(){var d=$(this).val();if(d==""){d=c.page}if(!d||isNaN(d)){d=c.reqPageNo}d=parseInt(d,10);if(d<=0){d=1}else{if(d>c.pages){d=1}}$(this).val(d);var e=[];e.push(d,c.pageSize);b.goPage.apply(b,e)});$("#"+this.bindFormName+"_topageSize_show").on("blur",function(){var d=$(this).val();var e=$(this).next(":hidden");if(!d||isNaN(d)){d=e.attr("value")}d=parseInt(d,10);if(d<=0){d=1}$(this).val(d);var f=[];f.push(parseInt($("#"+b.bindFormName+"_topageid").val()),d);b.goPage.apply(b,f);$("#"+b.bindFormName+"_topagesize").val(d)})},getTarget:function(){return this.target||Horn.getComp(this.targetName)},INDEX_PAGE:1,page:1,pageSize:20,pageCount:0,pages:1,nextpage:function(){this.goPage(parseInt(this.page)+1)},prevpage:function(){this.goPage(parseInt(this.page)-1)},firstpage:function(){this.goPage(this.INDEX_PAGE)},goPage:function(c,b){var a="";if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){a=this.el.attr("bindformname")}if(c<this.INDEX_PAGE){c=this.INDEX_PAGE}if(c>this.pages){c=this.pages}if(b>this.pageCount){b=this.pageCount}if(b<0||b==null||b==undefined){b=this.pageSize}this.page=c;this.pageSize=b;this.doJump()},doJump:function(){if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){var a=this.el.attr("bindformname");this.form=Horn.getCurrent().find("form[name='"+a+"']");var c='<input type="hidden" name="index" value="'+this.page+'"><input type="hidden" name="pageNo" value="'+this.page+'"><input type="hidden" name="pageSize" value="'+this.pageSize+'"><input type="hidden" name="count" value="'+this.pageCount+'"><input type="hidden" name="pages" value="'+this.pages+'">';this.form.append(c);this.form.attr("action",this.url);this.form.submit()}else{var b=this.url;function d(e,g){var f=new RegExp("([?|&])"+e+"=[^&]*");if(f.test(b)){b=b.replace(f,"$1"+e+"="+g)}else{b+=(b.indexOf("?")!=-1?"&":"?")+e+"="+g}}d("index",this.page);d("pageNo",this.page);d("pageSize",this.pageSize);d("count",this.pageCount);d("pages",this.pages);Horn.Util.jump(b)}}});Horn.regUI("div.h_pages",Horn.PageBar);
Horn.Panel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Panel",init:function(){Horn.Panel.superclass.init.apply(this,arguments);var a=this.el.children("div.m-panel-box");var c=this.el.children("div.g-wrap");if(a){var b=a.children().children("i");a.click(function(){if(b.hasClass("fa-angle-up")){c.hide();b.removeClass("fa-angle-up");b.addClass("fa-angle-down")}else{c.show();b.removeClass("fa-angle-down");b.addClass("fa-angle-up")}})}},show:function(){this.el.show()},hide:function(){this.el.hide()},enable:function(){Horn.Field.findFieldCompsIn(this.el).each(function(a,b){this.setDisabled(false)});this.el.find("button,select").removeAttr("disabled")},disable:function(){Horn.Field.findFieldCompsIn(this.el).each(function(a,b){this.setDisabled(true)});this.el.find("button,select").removeAttr("disabled");this.el.find("button,select").attr("disabled","disabled")}});Horn.regUI("div.g-panel",Horn.Panel);
Horn.Password=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Password",init:function(a){Horn.Password.superclass.init.apply(this,arguments)}});Horn.Field.regFieldType("div.hc_password",Horn.Password);
Horn.PasswordGroup=Horn.extend(Horn.Field,{COMPONENT_CLASS:"PasswordGroup",field1:null,field2:null,name1:null,name2:null,defValue1:"",defValue2:"",init:function(b){var a=$(b).find("input");this.field1=$(a[0]);this.field2=$(a[1]);this.name1=this.field1.attr("name");this.name2=this.field2.attr("name");Horn.PasswordGroup.superclass.init.apply(this,arguments);if(this.field1){this.defValue1=(this.params.defValue!=undefined)?this.params.defValue:this.field1.val();this.defValue2=(this.params.defValue!=undefined)?this.params.defValue:this.field2.val()}},initEvents:function(){var a=this;this.field2.bind("blur",function(){var b=a.field2.val();if(b!=""){b=b.replace(/(^\s*)|(\s*$)/g,"");a.field2.val(b)}var c=a.field1.val();if(c!=""){c=c.replace(/(^\s*)|(\s*$)/g,"");a.field1.val(c)}Horn.Validate.onValid({data:[Horn.Validate,a]});if(c!=""&&b!=""){if(a.isValid()){var e=a.field1.val();if(a.field2.val()!=e){a.showError("校验不匹配！")}else{a.removeError()}}}else{var d=a.field2.attr("check");if(d&&d.indexOf(Horn.Validate.REQUIRED)>-1){a.showError("当前输入不能为空")}}});this.field1.blur(function(){var b=a.field2.val();if(b!=""){b=b.replace(/(^\s*)|(\s*$)/g,"");a.field2.val(b)}var c=a.field1.val();if(c!=""){c=c.replace(/(^\s*)|(\s*$)/g,"");a.field1.val(c)}Horn.Validate.onValid({data:[Horn.Validate,a]});var f=a.field1.val();var d=a.field2.val();if(f!=""&&d!=""){if(a.isValid()){if(f!=d&&d){a.showError("校验不匹配！")}else{a.removeError()}}}else{var e=a.field1.attr("check");if(e&&e.indexOf(Horn.Validate.REQUIRED)>-1){a.showError("当前输入不能为空")}}})},validate:function(){this.field1.blur();this.field2.blur()},addRule:function(g){var d=this.field1;var b=this.field2;var c=d.attr(Horn.Validate.CHECK);if(c){if(c.indexOf(g)>-1){return}c+=Horn.Validate.CHECKSEP+g}else{c=g}d.attr(Horn.Validate.CHECK,c);b.attr(Horn.Validate.CHECK,c);if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var a=this.el.parent().parent(".g-unit-wrap");var e=$("label",a);var f=$("span.m-verify-symbol",e);if(!f.length){f=$("<span>",{"class":"m-verify-symbol",html:"*"});e.prepend(f)}else{f.html("*")}}this.removeError();this.field.removeClass("m-verify-success")},removeRule:function(e){var c=this.field1;var a=this.field2;var b=c.attr(Horn.Validate.CHECK);if(b&&b.indexOf(e)>-1){var d=b.split(Horn.Validate.CHECKSEP);d=$.grep(d,function(g,f){return g&&g!=e});c.attr(Horn.Validate.CHECK,d.join(";"));a.attr(Horn.Validate.CHECK,d.join(";"));this.removeError();this.setNotRequired()}},showError:function(b){var a=this.field1;var d=this.field2;a.removeClass("m-verify-success");a.addClass("m-verify-error");d.removeClass("m-verify-success");d.addClass("m-verify-error");b=$.type(b)=="boolean"?"校验错误":b;if(!this.msgDiv){this.msgDiv=$('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">'+b+"</div>");c.css("display","block");this.err=true},removeError:function(){this.field1.removeClass("m-verify-error");this.field2.removeClass("m-verify-error");var b=this.get();var a=this.field1.attr(Horn.Validate.CHECK);if(a){if(this.isValid){if(this.field1.val()!=""||this.field2.val()!=""){this.field1.addClass("m-verify-success");this.field2.addClass("m-verify-success")}}}this.err=false;var c=this.msgDiv;if(c){c.remove()}delete this.msgDiv},setValue:function(a){this.field1.val(a);this.field2.val(a);this.field1.blur();this.field2.blur()},getValue:function(){return this.field1.val()},reset:function(a){var b=a?"":this.defValue1;this.setValue(b)},clearValue:function(){this.setValue("")},setEnable:function(a){var b=this;if(a){this.field1.removeAttr("disabled");this.field2.removeAttr("disabled");this.field1.blur();this.field2.blur()}else{this.field1.attr("disabled","disabled");this.field2.attr("disabled","disabled");b.removeError()}}});Horn.Field.regFieldType("div.hc_passwordgroup",Horn.PasswordGroup);
Horn.QueryTable=Horn.extend(Horn.Base,{COMPONENT_CLASS:"QueryTable",table:null,form:null,dicName:null,delimiter:",",ths:[],simpleRequest:false,postData:null,rowSelect:false,keyAttr:"label",valueAttr:"value",clickFlag:null,mutiSelect:false,init:function(e){Horn.QueryTable.superclass.init.apply(this,arguments);this.table=$(e);var a=this.params.baseparams||{};var b=this.params.bindformname;if(!b){b=this.params.bindFormName}this.rowSelect=Boolean(this.params.rowSelect);var d={},c={request_num:10,index:this.INDEX_PAGE,positionArr:[],start_position_str:0,returndata:null,url:"",position_str:"position_str",hasPage:false,baseparams:a,params:{},autoLoad:false,requestMethod:"post"};if(b){this.form=Horn.getCurrent().find("form[name='"+b+"']");d=Horn.Util.getValues(this.form)}c.request_num=d.request_num||this.params.request_num||c.request_num;c.request_num=parseInt(c.request_num)>0?parseInt(c.request_num):10;c.autoLoad=Boolean(this.params.autoLoad);c.url=this.params.url;if(this.params.requestMethod&&(this.params.requestMethod.toLowerCase()=="post"||this.params.requestMethod.toLowerCase()=="get")){c.requestMethod=this.params.requestMethod}if(!c.url&&this.form&&this.form.length){c.url=this.form.attr("action")}if(c.url&&c.url.indexOf("http:")==-1){c.url=context_path+c.url}c.start_position_str=d.position_str||this.params.start_position_str||c.start_position_str;if(this.params.position_str){c.position_str=this.params.position_str}c.hasPage=Boolean(this.params.hasPage!=undefined||this.params.hasPage!=null?this.params.hasPage:c.hasPage);c.positionArr.push(c.start_position_str);this.postData=c;var f=this;this.ths=this.el.find("th");if(this.params.simpleRequest==true){this.simpleRequest=true}if(c.url&&c.autoLoad==true){f.loadByForm.call(f)}$.each(this.params.events||[],function(g,h){f[h.event.toLowerCase()]=h["function"]});if(this.params.selectModel=="muti"||this.params.selectModel=="multi"){this.mutiSelect=true}this.ths.each(function(k,h){var i=h.attributes.hidden;h=$(h);var l=h.attr("dictName"),m=h.attr("colno"),g=undefined;var j=undefined,n=undefined;if(m){j=f.params.items[m-1].items;n=f.params.items[m-1].buttons}if(i!=null&&i!=undefined&&i.value==true.toString()){h.hide()}if(l){g={};var o=$(".hc_checkboxdiv[ref_target="+l+"_s]").find("li");o.each(function(q,p){p=$(p);var r=p.attr("title");var s=p.attr("key");g[s]=r})}else{if(j){g={};$(j).each(function(p,q){g[q[f.keyAttr]]=q[f.valueAttr]})}}h.data("staticDict",g);h.data("buttons",n)});this.selecteds=[];if(this.params.data){this.dictTrans();this.initEvents();this.hiddenColumns();this.lastList=this.params.data;this.doDataFilter(this.params.data)}this.el.find(".h_querytable_select_all").change(function(){if(this.checked){f.selectAll()}else{f.unSelectAll()}});if(this.params.isDragColumn){if(this.params.name&&this.params.name!=""){$("."+this.params.name).resizableColumns({})}}},customEvents:"rowclick,rowdblclick",getEventTarget:function(){return this.el},stateTest:function(){var b=this;var a=true;b.el.find("input:checkbox.h_querytable_select").each(function(c,d){if(!$(d).prop("checked")){a=false}});if(a){b.el.find(".h_querytable_select_all").prop("checked",true)}else{b.el.find(".h_querytable_select_all").prop("checked",false)}},initEvents:function(){var a=this.el;var c=a.children("tbody");var d=this;var b=d.el.find(".h_querytable_select_all").length>0?true:false;if(b){this.el.find(".h_querytable_select").change(function(){d.stateTest()})}if(this.rowSelect==true){c.children("tr").each(function(f,j){var k=f;var e=$(j),h=d.mutiSelect?e.find("input:checkbox.h_querytable_select"):e.find("input:radio.h_querytable_select");var g=this.clickFlag;e.bind("click",function(i){clearTimeout(g);g=setTimeout(function(){if($.isEmptyObject(d.selecteds)){d.selectRow(k,e)}else{if(!d.selecteds.hasOwnProperty(k)){d.selectRow(k,e)}else{d.unSelectRow(k,e)}}if(b){d.stateTest()}},10)})})}},hiddenColumns:function(){var a=this.el.children("tbody").children("tr");var b=this.ths;b.each(function(f,e){var c=$(e);var d=e.attributes.hidden;if(d!=null&&d!=undefined&&d.value==true.toString()){c.hide();a.each(function(i,h){var k=$(h);var j=k.find("td");for(var g=0;g<j.length;g++){var l=$(j[g]);if(f==g){l.hide();break}}})}})},loadByForm:function(){var a={};if(this.form&&this.form.length){a=this.form.serializeArray()}this.load(a)},setBaseParams:function(a){if(a){this.postData.baseparams=a}else{this.postData.baseparams={}}},load:function(b){var a=this.postData;if(b){if($.type(b)=="array"){a.params=Horn.Util.arr2Obj(b)}else{a.params=b}}else{a.params={}}this.goPage(this.INDEX_PAGE)},INDEX_PAGE:1,nextpage:function(){this.goPage(this.postData.index+1)},prevpage:function(){this.goPage(this.postData.index-1)},firstpage:function(){this.goPage(this.INDEX_PAGE)},refreshpage:function(){this.ajaxRequest()},goPage:function(a){if(a<this.INDEX_PAGE){a=this.INDEX_PAGE}this.postData.index=a;this.ajaxRequest(this.el)},ajaxRequest:function(){var h=this,j=this.el,d=this.postData,c=d.positionArr,e=j.children("tbody"),a=d.params;a=$.extend({},d.baseparams,a);a.hasPage=d.hasPage;if(a!=null){a.position_str=c[d.index]||d.start_position_str;a.request_num=d.request_num+(this.simpleRequest?0:1)}a.index=d.index;var i=this.ths.length;if(a.hasPage==false){}var b=this.params.bindformname;if(!b){b=this.params.bindFormName}if(b){var g=$("form[name="+b+"]").serializeArray();var f=Horn.Util.arr2Obj(g);$.each(f,function(k,l){a[k]=l})}$.ajax(d.url,{async:true,beforeSend:function(k){e.html("<tr><td colSpan='"+i+"'><p class='h_loading'>正在加载</p></td></tr>")},type:d.requestMethod,data:Horn.Util.obj2Arr(a),dataType:"json",error:function(m,n,l){var k=m.status;e.html("<tr><td colSpan='"+i+"'><p>请求失败</p><p>错误状态："+k+"；错误信息："+n+"</p></td></tr>")},success:function(k,m,l){h.callback.call(h,h.doDataFilter(k));h.doCallBack(k);h.lastSelect=null;h.selecteds={}}})},doDataFilter:function(a){var b=this.table;var d=this.params.datafilter;if(d){var c=Horn.Util.getFunObj(d);if(c&&$.type(c.fn)=="function"){a=c.fn.call(this,a)}}return a},doCallBack:function(a){var c=this.table;var d=c.attr("callback");if(d){var b=Horn.Util.getFunObj(d);if(b&&$.type(b.fn)=="function"){b.fn.call(this,a)}}$(".h_screen").height("auto");setTimeout(function(){if(window.doLayout){window.doLayout()}},1000);this.dictTrans()},callback:function(reqData){reqData=reqData||{total:0,rows:[]};if($.type(reqData)=="array"){reqData={rows:reqData}}var list=reqData.rows;var table=this.table;var gridName=table.attr("name");var _this=this;var htmlArr=[];var ths=this.ths;var colLength=ths.length;var isSuccess=false;var data=this.postData;this.lastList=list;this.selecteds=[];this.lastSelect={};this.el.find(".h_querytable_select_all").prop("checked",false);table.css("height","auto");if(list&&list.length>0){data.list=list.slice(0,data.request_num);isSuccess=true;for(var i=0;i<list.length;i++){var itemData=list[i];htmlArr.push("<tr>");ths.each(function(index,o){var th=$(o);if(th.hasClass("h_numbercolumn")){htmlArr.push("<td>"+(i+1)+"</td>");return}else{if(th.hasClass("h_querytable_checkboxcolumn")){htmlArr.push('<td><input type="checkbox" class="h_querytable_select"/></td>');return}else{if(th.hasClass("h_querytable_radioboxcolumn")){htmlArr.push('<td><input type="radio" class="h_querytable_select" name="_querytable_row_checker_'+gridName+'"/></td>');return}}}var name=th.attr("name");var dealFun=th.attr("dealFun");htmlArr.push("<td><div style='overflow: visible;white-space: normal;word-wrap:break-word; word-break:break-all'>");if(dealFun){var dFun=eval("(window."+dealFun+")");if($.type(dFun)=="function"){htmlArr.push(dFun(itemData[name],itemData,list,i,index))}}else{var value=itemData[name];var dataType=th.attr("dataType");var format=th.attr("format");if(dataType&&dataType!=null){value=Horn.Util.Format.all(dataType,format,value)}htmlArr.push(value)}htmlArr.push("</div></td>")});htmlArr.push("</tr>");if(i==data.request_num-1){data.positionArr[data.index+1]=itemData[data.position_str];break}}}else{if(reqData.errorInfo||reqData.err_info){data.list=[];var errorInfo=reqData.errorInfo||reqData.err_info;htmlArr.push("<tr><td colspan='"+colLength+"'>");htmlArr.push("<p>"+errorInfo+"</p>");htmlArr.push("</td></tr>")}else{data.list=[];htmlArr.push("<tr><td colspan='"+colLength+"'>");htmlArr.push("<p>没有查询到数据</p>");htmlArr.push("</td></tr>")}}var tbody=table.children("tbody");tbody.html(htmlArr.join(""));var h_listtable=table.parent(".h_listtable");var h_head=table.parent(".h_listtable").parent(".g-datagrid-wrap").children(".u-datagrid-header");var h_page=table.parent(".h_listtable").parent(".g-datagrid-wrap").children(".u-datagrid-page");var h_body=table.parent(".h_listtable").parent(".g-datagrid-wrap").parent(".m-panel-body");if(this.params.height&&this.params.height!=null){var tableHeight=parseFloat(this.params.height);if(!isNaN(tableHeight)){h_listtable.css("height",tableHeight)}}if(this.params.width&&this.params.width!=null){var tableWidth=parseFloat(this.params.width);if(!isNaN(tableWidth)){h_listtable.css("width",tableWidth);h_head.css("width",tableWidth);h_page.css("width",tableWidth);h_body.css("width",tableWidth+22)}}if(isSuccess){tbody.children("tr:odd").addClass("u-table-bg");var rowClickObj=undefined;var rowDBLClickObj=undefined;var rowClickFn=undefined;var rowDBLClickFn=undefined;if(this.rowclick){rowClickObj=Horn.Util.getFunObj(this.rowclick);if($.type(rowClickObj.fn)=="function"){rowClickFn=rowClickObj.fn}}if(this.rowdblclick){rowDBLClickObj=Horn.Util.getFunObj(this.rowdblclick);if($.type(rowDBLClickObj.fn)=="function"){rowDBLClickFn=rowDBLClickObj.fn}}if(rowClickFn||rowDBLClickFn){var trs=tbody.children("tr");var _clickFlag=this.clickFlag;for(var i=0;i<data.list.length;i++){var tr=$(trs.get(i));if(rowClickFn){var params=rowClickObj.params.slice(0);params.push(data.list[i],data.list);tr.bind("click",params,function(e){var p=e.data;var _this=this;clearTimeout(_clickFlag);_clickFlag=setTimeout(function(){return rowClickObj.fn.apply(_this,p)},300)})}if(rowDBLClickFn){var params=rowDBLClickObj.params.slice(0);params.push(data.list[i],data.list);tr.bind("dblclick",params,function(e){clearTimeout(_clickFlag);var p=e.data;return rowDBLClickObj.fn.apply(this,p)})}}}this.initEvents();this.hiddenColumns()}if(data.hasPage){var pageArr=[];pageArr.push('<ul class="m-pagebar">');if(data.index>_this.INDEX_PAGE){pageArr.push('<li><a href="javascript:void(0)"  class="h_page-first first_page_btn" title="首页"><i class="fa fa-step-backward"></i></a></li>');pageArr.push('<li><a href="javascript:void(0)" class="h_pagebtn-prev h_page-pgLast pre_page_btn" title="上一页"><i class="fa fa-caret-left"></i></a></li>')}else{pageArr.push('<li><a href="javascript:void(0)"  class="disabled first_page_btn" title="首页"><i class="fa fa-step-backward"></i></a></li>');pageArr.push('<li><a href="javascript:void(0)" class="disabled pre_page_btn" title="上一页"><i class="fa fa-caret-left"></i></a></li>')}if(this.simpleRequest){if(list!=null&&(list.length+1)>data.request_num){pageArr.push('<li><a href="javascript:void(0)" class="h_page-pgNext next_page_btn" title="下一页"><i class="fa fa-caret-right"></i></a></li>')}else{pageArr.push('<li><a href="javascript:void(0)" class="disabled next_page_btn" title="下一页"><i class="fa fa-caret-right"></i></a></li>')}}else{if(list!=null&&list.length>data.request_num){pageArr.push('<li><a href="javascript:void(0)" class="h_page-pgNext next_page_btn" title="下一页"><i class="fa fa-caret-right"></i></a></li>')}else{pageArr.push('<li><a href="javascript:void(0)" class="disabled next_page_btn" title="下一页"><i class="fa fa-caret-right"></i></a></li>')}}pageArr.push('<li><a href="javascript:void(0)" class="h_page-refresh refresh_btn" title="刷新"><i class="fa fa-refresh"></i></a></li>');pageArr.push("</ul>");var total_num=reqData.total;var pageIndex=this.postData.index;if(total_num!=undefined){var pagesnum=Math.ceil(parseInt(total_num)/parseInt(data.request_num));pageArr.push('<div  class="m-pagebar-all">共'+pagesnum+"页,共"+total_num+"条记录,当前第"+pageIndex+"页</div>")}var page=table.parent(".h_listtable").next("div.u-datagrid-page").children(".h_querytable_pages").html(pageArr.join(""));page.children("ul").children("li").children("a.h_page-first").click(function(e){return _this.firstpage.call(_this,table,e)});page.children("ul").children("li").children("a.h_page-pgLast").click(function(e){return _this.prevpage.call(_this,table,e)});page.children("ul").children("li").children("a.h_page-pgNext").click(function(e){return _this.nextpage.call(_this,table,e)});page.children("ul").children("li").children("a.h_page-refresh").click(function(e){return _this.refreshpage.call(_this,table,e)})}this.resetTdContent()},loadData:function(a){this.callback(a);this.doCallBack(a)},resetTdContent:function(){var d=this;var a=this.table.children("tbody").children("tr");var b=this.table.children("thead").children("tr");var c=[];a.each(function(o,i){var k=$(i);var g=k.find("td");for(var j=0;j<g.length;j++){var f=$(g[j]);var h=f.attr("width");var n=f.children("div");var m=f.text();var l=b.find("th:eq("+j+")").attr("width");if(l){var e=l.replace("px","").replace("PX","");n.css("width",e)}if(d.getStrlen(m)>40){if(c.indexOf(j)==-1){c.push(j)}n.css("width",300);f.css("width",300)}}})},getStrlen:function(e){var b=2;var a=0;for(var d=0;d<e.length;d++){var f=e.charCodeAt(d);if((f>=1&&f<=126)||(65376<=f&&f<=65439)){a++}else{a+=b}}return a},onRowSelect:function(){},selecteds:null,selectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=true;if(a.rowSelect==false){$(c).trigger("change")}else{a.selectRow(b)}});this.el.find(".h_querytable_select_all").prop("checked",true)},unSelectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=false;if(a.rowSelect==false){$(c).trigger("change")}else{a.unSelectRow(b)}});this.el.find(".h_querytable_select_all").prop("checked",false)},lastSelect:null,mutiSelect:false,selectRow:function(h,b){var a=this;var g=b;if(!g){g=$(this.el.find("tr").has("td").get(h))}if(g.length==0){Horn.debug("querytable["+this.name+"]","选择的行"+h+"不存在");return false}var f={};var c=this.ths;var d=g.find("td");c.each(function(l,i){var k=d.get(l),j=$(i);f[j.attr("name")]=j.attr("dictName")?$(k).attr("key"):$(k).text()});a.onRowSelect.call(g,g,h,f);this.selecteds[h]=f;if(!a.mutiSelect){var e=a.lastSelect;if(e&&e.rowidx!==undefined&&e.rowidx!=h){if(e.tr.find("input:radio").length>0){e.tr.find("input:radio").get(0).checked=false}a.unSelectRow(e.rowidx,e.tr)}if(g.find("input:radio").length>0){g.find("input:radio").get(0).checked=true}}else{if(g.find("input:checkbox").length>0){g.find("input:checkbox").get(0).checked=true}}a.lastSelect={rowidx:h,tr:g};g.addClass("u-table-selected")},unSelectRow:function(e,b){var d=b;if(!d){d=$(this.el.find("tr").has("td").get(e))}this.selecteds[e]=null;delete this.selecteds[e];d.removeClass("u-table-selected");if(this.mutiSelect){if(d.find("input:checkbox").length>0){d.find("input:checkbox").get(0).checked=false}}else{if(d.find("input:radio").length>0){d.find("input:radio").get(0).checked=false}}var c=true;for(var a in this.selecteds){c=false;break}if(c){this.el.find(".h_querytable_select_all").prop("checked",false)}},getSelecteds:function(d){var c=[];if($.type(this.selecteds)=="array"){for(var b=0;b<this.selecteds.length;b++){var e=this.selecteds[b];if(e){c.push(d?this.lastList[b]:e)}}}else{for(var a in this.selecteds){var e=this.selecteds[a];if(e){c.push(d?this.lastList[a]:e)}}}return c},dictTrans:function(){var b=this,c=this.ths,a=this.el.find("tr");a.each(function(e,d){var g=$(d),f=b.mutiSelect?g.find("input:checkbox"):g.find("input:radio");if(f.hasClass("h_querytable_select")){if(b.rowSelect==false){f.change(function(){if(this.checked){b.selectRow(e-1,g)}else{b.unSelectRow(e-1,g)}})}}g.find("td").each(function(p,j){var k=$(j);var i=$(c.get(p));var n=i.attr("dictname"),o=i.attr("renderer"),q=i.data("buttons"),h=i.data("staticDict");if(h){if(t==""||h[k.text().trim()]==undefined){k.text("");k.attr("title","")}else{k.attr("key",k.text());k.text(h[k.text()]||k.text())}}else{if(q){var m=q;var s=$("<span></span>");$(m).each(function(y,v){var w=Horn.Util.getFunObj(v.event);if(!w.fn){return}var u=$("<a href='javascript:void(0)'>"+v.label+"</a>");var x=k.text();u.click(function(){w.fn.call(u,{val:x,rowidx:e,tdidx:p,tr:g,td:k})});s.append(u);if(y!=(m.length-1)){s.append(" | ")}});k.html("");k.append(s)}}if(o){k.attr("key",k.text());var t=k.text();var r=Horn.Util.getFunObj(o);if(!r.fn){return}var l=r.fn.call($(this),{val:t,rowidx:e,tdidx:p,tr:g,td:k});if(l instanceof $){k.html("");k.append(l)}else{k.html(l)}}})})}});$.extend(Horn.QueryTable,{DATANAME:"QUERYTABLE",get:function(a){var b=null;if(a){b=Horn.getComp(a)}else{b=Horn.data(Horn.QueryTable.DATANAME)[0]}return b}});Horn.regUI("table.h_querytable",Horn.QueryTable);
Horn.RadioGroup=Horn.extend(Horn.Field,{COMPONENT_CLASS:"RadioGroup",radios:null,name:null,alias:null,checkRegx:[],init:function(){Horn.RadioGroup.superclass.init.apply(this,arguments);this.radios=this.el.find("input[type='radio']");this.name=this.el.attr("name");this.alias=this.el.attr("alias")||"";if(this.params.check&&this.params.check.indexOf("required")>-1){this.checkRegx=[Horn.Validate.REQUIRED]}if(this.params.value){this.setValue(this.params.value)}if(this.params.disabled){this.setDisabled(true)}this.defValue=this.params.defValue||this.params.value||"";var b=this;var a=this.el.children("div").children("label").find("input:radio");a.each(function(c,d){$(d).bind("click",function(){var f=b.getValue();var e=$(d).attr(Horn.Validate.CHECK);if(f&&f!=""){b.removeError();if(e&&e.indexOf(Horn.Validate.REQUIRED)>-1){b.el.addClass("m-verify-success")}}else{b.showError();b.el.removeClass("m-verify-success")}})})},getEventTarget:function(){return this.el.children("div").children("label").find("input[type='radio']")},getValue:function(){return this.radios.filter(":checked").val()||""},setValue:function(c){var b=this;var a=this.radios;c=c.toString();if(c==""){this.radios.removeAttr("checked")}else{if(this.radios.filter('[value="'+c+'"]').length>0){if(this.radios.filter('[value="'+c+'"]').attr("disabled")){setTimeout(function(){a.attr("disabled","disabled");a.removeAttr("checked");a.filter('[value="'+c+'"]').prop("checked",true)},10)}else{a.removeAttr("checked");a.each(function(d,e){if($(e).val()==c){$(e).prop("checked",true)}})}}}this.validate()},clearValue:function(){this.setValue("")},setEnable:function(a){var b=this;this.radios.each(function(c,d){if(a===false){$(this).attr("disabled","disabled")}else{$(this).removeAttr("disabled")}})},setDisabled:function(a){var b=this;if(a===true){b.disabled=true}else{if(a===false){b.disabled=false}}this.radios.each(function(c,d){if(a===true){$(this).attr("disabled","disabled")}else{$(this).removeAttr("disabled")}})},validate:function(){if(this.disabled){return}this.isValid()},isValid:function(){var a=true;var d=this;var b=this.name;if(d.disabled==true){return true}if(this.checkRegx.length>0){var c=this.radios.filter(":checked").val();if(c==""){a=false;this.showError(d)}else{this.removeError(d)}}return a},showError:function(b){if(!this.msgDiv){this.msgDiv=$('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var a=this.msgDiv;a.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">当前单选选框不能为空</div>');a.css("display","block");b.el.addClass("m-verify-error");b.err=true},removeError:function(c){this.el.removeClass("m-verify-error");this.err=false;var b=this.msgDiv;if(b){b.remove()}var a=this.el.parent().parent(".g-unit-wrap").children(".unit-label");delete this.msgDiv},reset:function(){this.setValue(this.defValue)},addRule:function(e){if(e&&e.indexOf(Horn.Validate.REQUIRED)>-1){var f=this;var b=f.el.children("div").children("label").find("input:radio[check*=required]");if(b&&b.size()>0){return}else{f.err=true;this.checkRegx=e.split(";");var a=f.el.children("div").children("label").find("input:radio");a.each(function(g,i){var h=$(i).attr(Horn.Validate.CHECK);if(h){if(h.indexOf(e)>-1){return}h+=Horn.Validate.CHECKSEP+e}else{h=e}$(i).attr(Horn.Validate.CHECK,h)});if(e&&e.indexOf(Horn.Validate.REQUIRED)>-1){var c=this.el.parent().parent(".g-unit-wrap").children(".unit-label");var d=$("span.m-verify-symbol",c);if(!d.length){d=$("<span>",{"class":"m-verify-symbol",html:"*"});c.prepend(d)}else{d.html("*")}}}}else{return}},removeRule:function(d){var f=this;var a=f.el.children("div").children("label").find("input:radio");a.each(function(g,j){var h=$(j).attr(Horn.Validate.CHECK);if(h&&h.indexOf(d)>-1){var i=h.split(Horn.Validate.CHECKSEP);i=$.grep(i,function(l,k){return l&&l!=d});$(j).attr(Horn.Validate.CHECK,i.join(";"))}});this.checkRegx=[];if(d&&d.indexOf(Horn.Validate.REQUIRED)>-1){this.el.removeClass("m-verify-success");this.el.removeClass("m-verify-error");var b=this.el.parent().parent(".g-unit-wrap").children(".unit-label");var c=$("span.m-verify-symbol",b);if(c){c.remove()}var e=this.msgDiv;if(e){e.remove()}}}});Horn.Field.regFieldType("div.hc_radio-group",Horn.RadioGroup);
Horn.Select=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Select",delimiter:",",bodyclicktype:"click.select",select:null,field:null,hidden:null,listEl:null,multipleline:false,name:null,alias:null,showLabel:true,hasHeadItem:false,tempCheckedKeyArray:[],tempCheckedValue:"",init:function(c){Horn.Select.superclass.init.apply(this,arguments);var j=this;this.select=this.el;this.hidden=this.select.children("input[type='hidden']");this.field=this.hidden.next();this.name=this.hidden.attr("name");this.alias=this.hidden.attr("alias")||"";this.img=this.select.find(".u-select-down");if(this.field.attr("delimiter")!=undefined){this.delimiter=this.field.attr("delimiter")}var h=this.params.headItem;if(h){this.hasHeadItem=true}var f=this.field.attr("ref");this.listEl=f?$("#hc_hide_div").children("div.hc_checkboxdiv[ref_target='"+f+"']"):$("#combox_"+this.params.name);var g=$("div.h_floatdiv-con");if(g){g.mousewheel(function(){j.hideList(j.field,j.listEl)});g.scroll(function(){j.hideList(j.field,j.listEl)})}this.multipleline=this.params.multiple;if(String(this.params.showLabel)=="false"){this.showLabel=false}this.createHeadItem();this.setEditable(this.params.editable);this.setReadonly(this.params.readonly);this.field.bind({focus:Horn.Util.apply(j.onFocus,j),click:Horn.Util.apply(j.onClick,j),keydown:Horn.Util.apply(j.onKeyDown,j),keypress:Horn.Util.apply(j.onKeyPress,j),keyup:Horn.Util.apply(j.onKeyUp,j)});if(!this.params.disabled){this.img.bind({click:Horn.Util.apply(j.onFocus,j)})}var m=this.params.value||this.hidden.val();if(m===""){this.setValue("",undefined,true)}else{var e=this.el.attr("keyfield");var b=this.el.attr("titlefield");var k=this.params.items;if(k&&k.length>0){for(var d=0;d<k.length;d++){var n=k[d];var l=n.code;if(!l){l=n.label}var a=n.text;if(!a){a=n.value}if(e){l=n[""+e+""]}if(b){a=n[""+b+""]}if(n!=null&&l==m){this.field.val(a);this.hidden.val(m)}}}}if(this.params.disabled){this.setDisabled(true)}this.DICT=(function(o){if(o.params.items){var i={};$(o.params.items).each(function(p,q){i[q.label]=q.value});return i}else{return Horn.getDict(o.params.dictName)}})(this);if(this.params.filterBy){this.params.enableFieldSearch=true}else{this.params.filterBy="keyOrValue"}if(this.params.enableFieldSearch){this.enableFieldSearch=true;this.enableFieldQuery(true)}if(this.params.editable){this.field.bind("blur",function(){if(!j.editflag){return}j.editflag=false;var i=j.tempCheckedValue.replace(",",j.delimiter);$(this).attr("value",i)})}},enableFieldQuery:function(b){var g=this;var a;var f=this.getIEVersion();var e=(f=="8"||f=="7");if(e){a="propertychange"}else{a="input"}if(!b){g.enableFieldSearch=false;g.searchField.unbind(a);g.searchField.remove();return}else{this.enableFieldSearch=true}var d=$("<input type='text' value='' name='fieldToSearch' class='u-select' style='display:none'/>");d.appendTo(this.el);this.searchField=d;this.searchField.blur(function(){g.searchField.hide();g.field.show()});this.searchField.click(function(){return false});var c=function(){var h=g.searchField.val();if(h!=""){$("li",g.listEl).each(function(l,n){var m=false;var k=false;var j=false;if(g.params.filterBy=="key"){m=!($(n).attr("key").indexOf(h)!=-1)}else{if(g.params.filterBy=="value"){m=!($(n).attr("title").indexOf(h)!=-1)}else{if(g.params.filterBy=="keyOrValue"){k=!($(n).attr("key").indexOf(h)!=-1);j=!($(n).attr("title").indexOf(h)!=-1);if(k==false||j==false){m=false}else{m=true}}}}if(m){$(n).hide()}else{$(n).show()}})}else{$("li",g.listEl).each(function(j,k){$(k).show()})}};g.searchField.bind(a,c);g.searchField.bind("focus",c);g.searchField.bind("keyup",function(){var h=g.searchField.val();if(h==""){g.field.focus()}});g.searchField.bind({keydown:Horn.Util.apply(g.onKeyDown,g)})},getIEVersion:function(){var c=-1;if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}else{if(navigator.appName=="Netscape"){var a=navigator.userAgent;var b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}}return c},setDisabled:function(a){if(a===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(a){if(!a){a=false}if(a===false){this.el.removeAttr("readonly");this.readonly=false}else{this.el.attr("readonly",true);this.readonly=true;this.setEditable(false)}},setEditable:function(a){if(!a){a=false}if(a===true){this.field.removeAttr("readonly");this.editable=true}else{this.field.attr("readonly",true);this.editable=false}},createHeadItem:function(){var e=this.params.headItem;var a=this.params.multiple;var h=this;if(this.hasHeadItem){var b=true;this.listEl.children("ul").children("li").each(function(){var i=$(this).attr("headItem");if(i&&i==h.name){b=false;return false}});if(b&&!a){var c=e.label?e.label:"";var g=e.pLabel?e.pLabel:"";var f=e.value?e.value:"";var d="<li key='"+c+"' pkey='"+g+"' title='"+f+"' headItem='"+this.name+"' ><label>"+f+"</label></li>";this.listEl.children("ul").prepend(d);this.field.val(f)}}},handerHeadItem:function(){var e=this.name;var a=this.listEl.children("ul");if(a.length>0){if(this.hasHeadItem){var d=false;var c=a.children("li[headItem]");if(c.length>0){c.each(function(f,h){var g=$(h).attr("headItem");if(e!=g){$(h).remove()}else{d=true}});if(d){return}else{this.createHeadItem()}}else{this.createHeadItem()}}else{var b=a.children("li[headItem]");if(b.length>0){b.remove()}}}},setValue:function(l,c,k){if(this.listEl&&this.listEl.length==0){this.listEl=this.field.parent().find("div.hc_checkboxdiv")}this.handerHeadItem();var q=this.hidden;var b=q.val();var a=this.field;if(l===undefined||l===null){a.val("");q.val("");return false}if(l==""){q.val("");this.tempCheckedKeyArray=[]}if($.type(l)=="string"||$.type(l)=="number"){l={key:l+""}}var g=this.listEl.children("ul");if(this.listEl.length>0){if(this.multipleline){if(l.key==null||l.key==""){a.val("")}else{if(l.text){a.val(l.text)}else{var s=[];var d=[];if(this.delimiter!=""){d=l.key.split(this.delimiter)}else{d=l.key.toCharArray()}this.tempCheckedKeyArray=d;if(this.params.dictName){for(var r=0;r<d.length;r++){s.push(Horn.getDict(this.params.dictName)[d[r]])}}else{var h=this.getListData().data;for(var r=0;r<d.length;r++){for(var o=0;o<h.length;o++){if(d[r]==h[o].key){s.push(h[o].value)}}}}s=s.toString().replace(/,/g,this.delimiter);a.val(s);a.attr("title",s)}}q.val(l.key)}else{if(!l.text){var f=g.children("li[key='"+l.key+"']");l.text=jQuery.trim(f.text());if(!this.showLabel){var p=f.find("span");l.text=l.text.replace(p.text(),"")}}if(l.text!=""){var m=l.text;if($.type(l)=="string"){m=m+"";m=m.replace(/(^\s+)|(\s+$)/g,"");m=m.replace(/\s/g,"")}a.val(m);q.val(l.key)}else{if(l.key==""){a.val("")}else{return}}}if(c&&b!=l.key){a.trigger("change",[l.key])}}if(this.multipleline){var t=this.hidden.val();var e=[];var n=this;if(t!=""&&t!=null){$("input[type='checkbox']",this.listEl).each(function(v,A){var u=$(A).parent().parent("li[key]");var y=u.attr("key");var z=t.split(n.delimiter);var j=z.length;for(var x=0;x<j;x++){var w=z[x];if(y==w){e.push(w)}}});this.hidden.val(e.join(this.delimiter))}}this.tempCheckedValue=this.field.val();if(!k){this.validate()}},getValue:function(f){this.handerHeadItem();if(f){var e=this;var d=this.hidden.val();var i=function(j){return e.DICT[j]||null};if(this.multipleline){var a=d.split(this.delimiter);var g=[];$(a).each(function(j,k){var l=i(k);if(l){g.push(l)}});return g.join(this.delimiter)}else{return i(d)}}var b=this.hidden.val();var c=this.listEl.find("ul>li");var h="";if(!this.params.multiple||this.params.multiple==false){if(this.params.value){$.each(c,function(j,k){if($(k).attr("key")==b){h="has"}});if(!h){b=""}}}return b},onClick:function(a){if(this.searchField){this.field.hide();this.searchField.show();this.searchField.focus()}},onFocus:function(h){if(this.disabled){return}var d=$(h.currentTarget);if(d.hasClass("u-select-down")){d=$(h.currentTarget).prev()}var c=i?$("#hc_hide_div").children("div.hc_checkboxdiv[ref_target='"+i+"']"):$("#combox_"+this.params.name);var g=d.data("isFromOuter");if(c.length>0){var f="";if(this.searchField){f=this.searchField.val()}if(f!=""){}else{this.showList(d,c)}}else{var i=this.field.attr("ref");this.listEl=i?$("#hc_hide_div").children("div.hc_checkboxdiv[ref_target='"+i+"']"):$("#combox_"+this.params.name);if(this.listEl.length>0){this.showList(d,this.listEl)}this.multipleline=this.listEl.attr("multiple_line")=="true"}if(this.enableFieldSearch){var b=this.el.find("input[name=fieldToSearch]");if(b.size()==2){b.first().remove()}var a=this.field.val();if(a==""){this.field.hide();this.searchField.show();this.searchField.focus()}}},onKeyDown:function(g){var k=g.keyCode;var f=this.listEl;var h=f.children("ul");var l=h.children("li");var j=h.children("li.h_cur");var a=f.get(0);var i=h.children("li").last().get(0);if(g.ctrlKey&&k===65&&this.multipleline){var d=h.find("input:not(:checked)");if(d.length==0){l.removeClass("h_cur");d=l.children("label").children("input");d.each(function(m,e){e.checked=false});this.setValue("")}else{d.each(function(m,e){var n=$(e).parent("label").parent("li").is(":visible");if(n){e.checked=true;$(e).parent("label").parent("li").addClass("h_cur")}});if(this.searchField){this.searchField.val("");this.searchField.hide();this.field.show()}d.last().parent("label").parent("li").triggerHandler("click.li")}Horn.Util.stopPropagation(g);return false}else{if(k===38){if(!this.multipleline){var b=j.prev();if(b.length){a.scrollTop=b.get(0).offsetTop+(a.scrollHeight-a.clientHeight)-i.offsetTop;j.removeClass("h_cur");b.addClass("h_cur")}}}else{if(k===40){if(!this.multipleline){var c=j.next();if(c.length){a.scrollTop=c.get(0).offsetTop+(a.scrollHeight-a.clientHeight)-i.offsetTop;j.removeClass("h_cur");c.addClass("h_cur")}}}else{if(k===46||k===8){}else{if(k===9){this.hideList(this.field,f)}else{if(k===13||k===32){if(!this.multipleline){j.trigger("click.li");Horn.Util.stopPropagation(g)}return false}else{}}}}}}},onKeyPress:function(f){var m=f.keyCode;var l=String.fromCharCode(m);var c="";var d=this.listEl;var g=d.children("ul");var k=g.children("li");if(m>=65&&m<=90){c=l.toLowerCase()}else{c=l.toUpperCase()}var b=this.selectLi(l,c);var j=k.last().get(0);var a=d.get(0);if(m===38){}else{if(m===46||m===8){}else{if(m===40){}else{if(m===13){}else{if(this.multipleline){var i=this.getValue();if(i.indexOf(l)==-1){if(b){var h=b.children("label").children("input");if(!h.get(0).checked){h.get(0).checked=true}}}else{}}if(b){a.scrollTop=b.get(0).offsetTop+(a.scrollHeight-a.clientHeight)-j.offsetTop}}}}}Horn.Util.stopPropagation(f)},onKeyUp:function(f){var d=this.listEl;var h=this;if(this.multipleline&&!this.params.enableFieldSearch){if(h.params.editable){h.editflag=true}var g=this.field.val();var b=[];var c=[];var a="";$("input[type='checkbox']",d).each(function(l,j){var p=$(j).parent().parent("li[key]");var n=p.attr("title");var e=p.attr("key");$(j).prop("checked",false);var q=g.split(/[\,,\，]/);var m=q.length;for(var k=0;k<m;k++){var o=q[k];if(n==o||o==e){b.push(e);c.push(n);a=a+q[k]+",";$(j).prop("checked",true)}}if($(j).prop("checked")){p.addClass("h_cur")}else{p.removeClass("h_cur")}p.focus()});a=a.substring(0,a.length-1);this.tempCheckedKeyArray=b;this.tempCheckedValue=c.toString();h.hidden.val(b)}Horn.Util.stopPropagation(f)},bodyClick:function(f){var d=this.getEventTarget();if(f.target==f.data.inputEl.get(0)||d.data("isFromOuter")||$(f.target).prev()[0]==f.data.inputEl.get(0)){d.data("isFromOuter",false);var c=f.data.listEl;var b=f.data.inputEl;this.showList(b,c);$(document).one(this.bodyclicktype,f.data,Horn.Util.apply(this.bodyClick,this))}else{var c=f.data.listEl;var b=f.data.inputEl;c.hide();if(!c.data("show_name")){return}var a=$("li[key]",c);a.unbind("click.li");c.data("show_name","");if(this.searchField){this.searchField.val("")}if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-1}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-1}}},listClick:function(f){var h=this;var b=$(f.currentTarget);var d=f.data.listEl;var c={};if(h.multipleline){var g=new Array();var a=new Array();$("input[type='checkbox']:checked",d).each(function(i,k){var j=$(k).parent().parent("li[key]").attr("key");var e=$(k).parent().parent("li[key]").attr("title");if(j){g.push(j);a.push(e)}});this.tempCheckedKeyArray=g;this.field.attr("TITLE",a.toString());c.key=g.join(h.delimiter);c.text=a.join(h.delimiter);if($("input[type='checkbox']",b).get(0).checked){b.addClass("h_cur")}else{b.removeClass("h_cur")}f.stopPropagation();this.setValue(c,true,true)}else{b.addClass("h_cur");b.siblings().removeClass("h_cur");this.setValue(b.attr("key"),true,true)}this.field.trigger("blur");this.tempCheckedValue=this.field.val();if(h.multipleline){this.field.focus()}},hideList:function(c,b){if(!b.data("show_name")){return}b.hide();var a=$("li[key]",b);a.unbind("click.li");b.data("show_name","");if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-1}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-1}},longerList:false,changeToLongerList:function(){this.longerList=true},showList:function(m,g){this.handerHeadItem();var i=this;if(this.readonly==true){return false}if(this.enableFieldSearch){var j=this.searchField.val();if(j!=""){$("li",g).each(function(n,p){$(p).show()})}}var h=m.prev();if(g.data("show_name")==h.attr("name")){return}this.hideAllList(g);var f={inputEl:m,listEl:g};if(g.offsetParent()!=m.offsetParent()){}var k=m.offset(),e=m.outerHeight();g.css("left",k.left+"px");g.css("z-index",Horn.Window.getNextZIndex());g.css("top",(k.top+e)+"px");var d=this.getIEVersion();if(d=="9"){var l=g.children("ul").children("li");if(l.length>3){g.css("width",(m.outerWidth()*(this.longerList?2:1)-2)+18+"px")}else{g.css("width",(m.outerWidth()*(this.longerList?2:1)-2)+"px")}}else{g.css("width",(m.outerWidth()*(this.longerList?2:1)-2)+"px")}g.css("display","block");g.data("show_name",h.attr("name"));$(document).one(i.bodyclicktype,f,Horn.Util.apply(i.bodyClick,i));var c=$("li[key]",g);c.bind("click.li",f,Horn.Util.apply(i.listClick,i));c.removeClass("h_cur");var b=this.tempCheckedKeyArray.toString();if(b==""){b=this.hidden.val()}if(this.multipleline){$("input[type='checkbox']",g).each(function(o,t){var n=$(t).parent().parent("li[key]");var r=n.attr("key");$(t).prop("checked",false);var s=b.split(i.delimiter);for(var q=0;q<s.length;q++){var p=s[q];if(r==p){$(t).prop("checked",true)}}if($(t).prop("checked")){n.addClass("h_cur")}else{n.removeClass("h_cur")}n.focus()})}else{var a=this.hidden.val();var l=g.children("ul").children("li[key='"+a+"']");l.addClass("h_cur");l.focus()}if(this.showLabel){this.listEl.find("span.hce_dictlabel").show()}else{this.listEl.find("span.hce_dictlabel").hide()}},hideAllList:function(a){$("div.hc_checkboxdiv").each(function(b,c){if(a.get(0)!=c){$(c).hide();$(c).data("show_name","")}})},selectLi:function(g,c){var b=this.listEl.children("ul").children("li");var f=null;for(var e=0;e<b.size();e++){var a=$(b.get(e));var d=a.attr("key");if(d&&d.indexOf(g)==0){f=a;break}}if(f==null&&!this.multipleline){for(var e=0;e<b.size();e++){var a=$(b.get(e));var d=a.attr("key");if(d&&d.indexOf(c)==0){f=a;break}}}if(f!=null){if(!this.multipleline){f.siblings().removeClass("h_cur");f.addClass("h_cur")}}return f},bind:function(b,a){this.field.bind(b,[this.hidden],a)},setEnable:function(a){if(a){this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.hidden.attr("disabled","disabled");this.field.attr("disabled","disabled")}},getListData:function(){var a={};var b=[];if(this.listEl&&this.listEl.length==0){this.listEl=this.field.parent().find("div.hc_checkboxdiv")}if(this.multipleline){$("input[type='checkbox']",this.listEl).each(function(d,f){var c=$(f).parent().parent("li[key]");var e={};e.key=c.attr("key");e.value=c.attr("title");b.push(e)})}else{$("li[key!='']",this.listEl).each(function(d,f){var c=$(f);var e={};e.key=c.attr("key");e.value=c.attr("title");b.push(e)})}a.data=b;a.dom=this.listEl;return a}});Horn.Field.regFieldType("div.hc_select",Horn.Select);
Horn.SelectTree=Horn.extend(Horn.Field,{COMPONENT_CLASS:"SelectTree",hidden:null,field:null,ref:null,listEl:null,treeEl:null,_this:null,expandFirst:true,callback:null,init:function(){Horn.SelectTree.superclass.init.apply(this,arguments);var a=this.name;this.field=this.el.children("input[type='text'][ref*='"+a+"']");this.hidden=this.field.prev();this.name=this.hidden.attr("name");this.ref=this.field.attr("ref");this.img=this.el.find(".u-select-down");c=this;expandFirst=false;if(this.hidden.attr("expandFirst")){expandFirst=this.params.expandFirst}this.field.bind({focus:Horn.Util.apply(this.onFocus,this)});if(this.params.afterClear){var b=this.params.afterClear.replace("(","").replace(")","");this.callback=window[b]}var c=this;this.el.children("a").bind({click:Horn.Util.apply(c.delVal,c)});this.initZTree()},delVal:function(){if(this.params.disabled){return}var b=this;var a=this.field.val();if(a!=""){if(this.params.confirm){Horn.Msg.confirm("确认","你确定要清除该值？",function(){b.hidden.val("");b.field.val("");b.field.attr("selectnodes","");b.field.attr("pIds","");if(b.callback){b.callback()}},function(){})}else{b.hidden.val("");b.field.val("");b.field.attr("selectnodes","");b.field.attr("pIds","");if(b.callback){b.callback()}}}},initZTree:function(){var k=Horn.getCurrent();var a=this.hidden.attr("name").replace(/\./,"_");this.listEl=$("#hc_hide-div-tree-"+a).find("div.hc_selectbox-tree-div[ref_target='"+this.ref+"']");if(this.listEl.length==0){var i=[];i.push("<div class='hc_selectbox-tree-div' ref_target='ztree_"+a+"'>");i.push("<div class='hc_selectbox-tree-left'>");i.push("<ul class='ztree' id='ztree_"+a+"'>");i.push("</ul>");i.push("</div>");i.push("</div>");var n=$("#hc_hide-div-tree-"+a);if(n.length==0){n=$('<div class="hc_hide-div-tree-'+a+'" id="hc_hide_div-tree-'+a+'"></div>').appendTo("body");this.listEl=$(i.join("")).appendTo(n)}}var e=this.listEl.children("div.hc_selectbox-tree-left").children("ul.ztree");this.treeEl=e;var j=this;var h=$("div.h_floatdiv-con");if(h){h.mousewheel(function(){$("div.hc_selectbox-tree-div").each(function(){$(this).hide()})});h.scroll(function(){$("div.hc_selectbox-tree-div").each(function(){$(this).hide()})})}var c=false;if(this.params.url&&this.params.url!=""){c=true}var p={view:{nameIsHTML:true,showLine:false,showIcon:true,showTitle:true,selectedMulti:true,dblClickExpand:true,fontCss:this.getFontCss},data:{key:{name:"name",title:"name"},simpleData:{enable:true,idKey:"id",pIdKey:"pId"}},callback:{beforeClick:this.beforeClick,beforeCheck:this.params.beforeCheck?window[this.params.beforeCheck]:null,beforeAsync:this.params.beforeAsync?window[this.params.beforeAsync]:null,onAsyncSuccess:this.params.onAsyncSuccess?window[this.params.onAsyncSuccess]:null,onAsyncError:this.params.onAsyncError?window[this.params.onAsyncError]:null,beforeCollapse:this.params.beforeCollapse?window[this.params.beforeCollapse]:null,beforeDblClick:this.params.beforeDblClick?window[this.params.beforeDblClick]:null,beforeDrag:this.params.beforeDrag?window[this.params.beforeDrag]:null,beforeDragOpen:this.params.beforeDragOpen?window[this.params.beforeDragOpen]:null,beforeDrop:this.params.beforeDrop?window[this.params.beforeDrop]:null,beforeEditName:this.params.beforeEditName?window[this.params.beforeEditName]:null,beforeExpand:this.params.beforeExpand?window[this.params.beforeExpand]:null,beforeMouseDown:this.params.beforeMouseDown?window[this.params.beforeMouseDown]:null,beforeMouseUp:this.params.beforeMouseUp?window[this.params.beforeMouseUp]:null,beforeRemove:this.params.beforeRemove?window[this.params.beforeRemove]:null,beforeRename:this.params.beforeRename?window[this.params.beforeRename]:null,beforeRightClick:this.params.beforeRightClick?window[this.params.beforeRightClick]:null,onCheck:this.onCheck,onCollapse:this.params.onCollapse?window[this.params.onCollapse]:null,onDblClick:this.params.onDblClick?window[this.params.onDblClick]:null,onDrag:this.params.onDrag?window[this.params.onDrag]:null,onDragMove:this.params.onDragMove?window[this.params.onDragMove]:null,onExpand:this.params.onExpand?window[this.params.onExpand]:null,onMouseDown:this.params.onMouseDown?window[this.params.onMouseDown]:null,onMouseUp:this.params.onMouseUp?window[this.params.onMouseUp]:null,onNodeCreated:this.params.onNodeCreated?window[this.params.onNodeCreated]:null,onRemove:this.params.onRemove?window[this.params.onRemove]:null,onRename:this.params.onRename?window[this.params.onRename]:null,onRightClick:this.params.onRightClick?window[this.params.onRightClick]:null,onClick:this.onCheck},async:{enable:c,url:this.params.url?this.params.url:"",autoParam:this.params.otherParam?this.params.otherParam:[],otherParam:this.params.otherParam?this.params.otherParam:{},type:this.params.type?this.params.type:"post",dataFilter:this.params.dataFilter?window[this.params.dataFilter]:null}};var o=this.hidden.attr("checkMode");if(o&&o=="checkbox"){p.check={enable:true,chkStyle:o,chkboxType:{Y:"",N:""}}}var f=this.hidden.attr("data-data");if(f&&f!=""){f=$.parseJSON(f)}else{f=[]}this.treedata=f;if(c){this.zTreeObj=$.fn.zTree.init(e,p)}else{this.zTreeObj=$.fn.zTree.init(e,p,f)}var d=this.treeEl.attr("id");this.treeObj=$.fn.zTree.getZTreeObj(d);this.treeObj.expandAll(expandFirst);var m=this.hidden.attr("value");var g=this.treeObj.getNodesByParam("id",m,null);if(g&&g[0]!=null&&g[0]!={}){this.field.val(g[0].name);this.showLog(g,this.treeObj,true)}else{this.field.val("")}var b=this.treeObj;var l="name";if(this.hidden.attr("filterBy")){l=this.hidden.attr("filterBy")}this.field.bind("keyup",function(r){b.expandAll(true);var q=b.getNodesByParamFuzzy(l,this.value,null);if(this.value!=""){$.each(q,function(s,t){t.highlight=true;b.updateNode(t);b.expandNode(t.getParentNode(),true)})}else{$.each(q,function(s,t){t.highlight=false;b.updateNode(t)});b.expandAll(expandFirst)}this.focus()});this.field.bind({blur:function(){$(this).val($(this).attr("selectNodes"));var q=b.getNodesByParam("highlight",true,null);$.each(q,function(r,s){s.highlight=false;b.updateNode(s)})}})},onBeforeCheck:function(a,c){var b=$.fn.zTree.getZTreeObj(a);var d=b.thisScope;return(function(){var f=this.hidden.attr("isLevelSelect")=="true";var e=this.hidden.attr("checkMode")=="checkbox"||this.hidden.attr("checkbox")=="radio";if(e){if(f){if(this.hidden.data("level")!=undefined&&c.level!=this.hidden.data("level")){return false}this.hidden.data("level",c.level)}}}).apply(d,arguments)},onAsyncSuccess:function(b,e,d,f){var h=this;var a=$.fn.zTree.getZTreeObj(e);a.expandAll(expandFirst);var g=h.hidden.attr("value");var c=a.getNodesByParam("id",g,null);if(c&&c[0]!=null&&c[0]!={}){h.field.val(c[0].name);h.showLog(c,a,true)}else{h.field.val("")}},getFontCss:function(b,a){return(a.highlight)?{color:"rgb(255, 0, 0)","font-weight":"bold"}:{color:"#333","font-weight":"normal"}},onCheck:function(d,c,b){var a=$.fn.zTree.getZTreeObj(c);var f=a.thisScope;return(function(){var g=a.getCheckedNodes();var e=this.hidden.attr("checkMode");var g=new Array();if(e&&e=="checkbox"){g=a.getCheckedNodes()}else{g=a.getSelectedNodes()}this.showLog.call(this,g,a,e,true);if(this.params.onCheck){var h=window[this.params.onCheck];h()}}).apply(f,arguments);this.field.trigger("blur")},showLog:function(a,c,b,j){var i="dark";var d=[];var h=[];var l=[];var k=[];var g=[];var f=this.listEl.children("div.hc_selectbox-tree-left").children("ul.ztree");var e=f.parent().next("div.hc_selectbox-tree-right").children("ul.ztree");$.each(a,function(o,q){var p="ztree_node_"+q.tId;var r=q.name;var n=q.id;var m=q.pId;l.push(r);g.push(n);k.push(m);d.push(p);h.push(q.tId);e.children("li[zid='"+p+"']");if(e.children("li[zid='"+p+"']").length==0){e.append("<li class='"+i+"' zid='"+p+"'>"+r+"</li>")}});e.children("li").each(function(n,m){var o=$(m);if(jQuery.inArray(o.attr("zid"),d)==-1){o.remove()}});this.hidden.val(g.join(","));if(b){this.field.val(l.join(","));this.field.attr("selectNodes",l.join(","));this.field.attr("pIds",k.join(","));this.field.attr("title",l.join(","))}else{this.field.val(l.join(","));this.field.attr("pIds",k.join(","));this.field.attr("selectNodes",l.join(","))}this.hidden.attr("tids",h.join(","));var b=this.hidden.attr("checkMode");if(!b||b=="radio"){if(j!=undefined){if(j){this.hideTree(this.field,this.listEl)}else{this.showTree(this.field,this.listEl)}}}this.validate()},clearLog:function(){var a=this.listEl.children("div.hc_selectbox-tree-right").children("ul.ztree");a.children("li").remove()},onFocus:function(h){var j=Horn.getCurrent();var g=this.field.attr("ref");this.listEl=$("#hc_hide-div-tree-"+this.params.name).children("div.hc_selectbox-tree-div[ref_target='"+g+"']");this.listEl.find("div.hc_selectbox-tree-left").width(this.field.width()+30);var n=$(h.currentTarget);var g=n.attr("ref");var l=$("div.hc_selectbox-tree-div[ref_target='"+g+"']");if(l.length>0){this.showTree(n,l);var k=$.fn.zTree.getZTreeObj(g);k.thisScope=this;k.currentTarget=n;var c=this.hidden.attr("checkMode")=="checkbox"||this.hidden.attr("checkMode")=="radio";this.clearLog(k);k.checkAllNodes(false);k.selectNode(null,false);if(this.hidden.val()){tIdArrs=this.hidden.attr("tids")||"";tIdArrs=tIdArrs.split(",");var b=[];for(var f=0;f<tIdArrs.length;f++){if(tIdArrs[f]){var d=k.getNodeByTId(tIdArrs[f]);b.push(d);if(c){k.checkNode(d,true,true,false)}else{k.selectNode(d,false)}}}this.showLog(b,k,c,false)}}var a=n.prev();var o=a.attr("search");var m=a.attr("filterBy");if(o||m){n.val("");n.removeAttr("readonly")}},hideTree:function(c,b){if(!b.data("show_name")){return}b.hide();b.data("show_name",false);var d=c.attr("ref");var a=$.fn.zTree.getZTreeObj(d);a.thisScope=null;a.currentTarget=null;if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-1}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-1}},showTree:function(e,d){if(d.data("show_name")){return}var c={inputEl:e,listEl:d};var g=e.offset(),b=e.outerHeight();d.css("left",g.left+"px");d.css("z-index",Horn.Window.getNextZIndex());d.css("top",(g.top+b)+"px");var f=this.getIEVersion();if(f=="9"){var a=d.children("ul").children("li");if(a.length>3){d.css("width",(e.outerWidth()*(this.longerList?2:1)-2)+18+"px")}else{d.css("width",(e.outerWidth()*(this.longerList?2:1)-2)+"px")}}else{d.css("width",(e.outerWidth()*(this.longerList?2:1)-2)+"px")}d.show();d.data("show_name",true);d.bind("click.ztree.list",c,function(h){Horn.Util.stopPropagation(h)});$(document).one("click.combo.body",c,Horn.Util.apply(this.bodyClick,this))},hideAllList:function(a){$("div.hc_selectbox-tree-div").each(function(b,c){if(a.get(0)!=c){$(c).hide();$(c).data("show_name","")}})},bodyClick:function(c){var b=c.data.inputEl;if(c.target==b.get(0)){$(document).one("click.combo.body",c.data,Horn.Util.apply(this.bodyClick,this))}else{var a=c.data.listEl;this.hideTree(b,a)}},setEnable:function(a){if(a){this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.field.attr("disabled","disabled");this.hidden.attr("disabled","disabled")}},setValue:function(b){var a=this.treeObj.getNodesByParam("id",b,null);if(a&&a[0]!=null&&a[0]!={}){this.field.val(a[0].name);this.showLog(a,this.treeObj,true)}else{this.field.val("");this.showLog({},this.treeObj,true)}this.validate()},getSelectedNodes:function(){var a=this.hidden.attr("checkMode");if(!a||a=="radio"){return this.treeObj.getSelectedNodes()}else{return this.treeObj.getCheckedNodes()}},getValue:function(){var a=this.get();var b=a.val();return b},getText:function(){var a=this.field;var b=a.attr("selectnodes");return b},getPid:function(){var a=this.field;var b=a.attr("pIds");return b}});Horn.Field.regFieldType("div.hc_select-tree",Horn.SelectTree);
var isFirstClick=true;var firstTab=null;(function(H){Horn.TabPanel=Horn.extend(Horn.Base,{maxTabCn:30,tabWidth:121,minTabHeight:undefined,init:function(){Horn.TabPanel.superclass.init.apply(this,arguments);var _this=this;this.maxTabCn=this.params.maxTabCn?this.params.maxTabCn:this.maxTabCn;var tabWidth=(this.params.width||this.tabWidth||"")+"";this.tabWidth=tabWidth.match(/[px|%]+$/)?tabWidth:tabWidth+"px";this.isFormValidate=this.params.isFormValidate==="false"?false:!!this.params.isFormValidate;var tabPanel=this.el;this.tabsDiv=tabPanel.children("div.h_tabpanel-tabs");this.contentsDiv=tabPanel.children("div.h_tabpanel-contents");this.tabWrap=this.tabsDiv.children("div.h_tabpanel-wrap");this.tabWrapUl=this.tabWrap.children("ul");this.leftScroller=this.tabsDiv.children(".h_tabscroller-left");this.rightScroller=this.tabsDiv.children(".h_tabscroller-right");this.topScroller=this.tabsDiv.children(".h_tabscroller-top");this.bottomScroller=this.tabsDiv.children(".h_tabscroller-bottom");var tempTabsUl=tabPanel.children("ul");if(tempTabsUl.size()>this.maxTabCn){tempTabsUl.splice(this.maxTabCn);Horn.Msg.alert("提示","最多只能添加"+this.maxTabCn+"个页签！")}if(this.params.height&&this.params.height!=""){this.contentsDiv.css("height",this.params.height);this.contentsDiv.css("overflow","auto")}if(this.params.width&&this.params.width!=""){this.topScroller.css("width",this.params.width);this.bottomScroller.css("width",this.params.width)}tempTabsUl.children("li[ref]").appendTo(this.tabWrapUl).each(function(i,o){var tab=$(o);var ref=tab.attr("ref");var content=$("[ref_target="+ref+"]",tabPanel);var contentId=content.attr("id");if(!contentId){contentId=Horn.id("tab-panel-content-");content.attr("id",contentId)}_this.contentsDiv.get(0).appendChild(content.get(0));tab.bind("click",function(){if(!isFirstClick){if($(this).data("content")!=firstTab.data("content")){_this.activate(firstTab)}}_this.activate($(this))}).data({content:content}).css("width",_this.tabWidth);if(_this.tabWidth){var icon=tab.children(".h_tab-icon");var title=tab.children(".h_tab-title");title.css({width:parseInt(_this.tabWidth)-icon.outerWidth()})}});tempTabsUl.remove();this.tabChange=function(){};if(this.params.tabChange){var tabChangeObj=Horn.Util.getFunObj(this.params.tabChange);if($.type(tabChangeObj.fn)=="function"){this.tabChange=tabChangeObj.fn}}initScrollerEvents.call(this);initTabPosition.call(this,this.params.position);firstTab=this.tabWrapUl.children("li:eq(0)");calculateScrollLength.call(this);firstTab.addClass("h_cur").click();isFirstClick=false;firstTab.data("content").show();$(window).bind("resizes",function(){locateScroller.call(_this.tabWrap);moveToCenter.call(_this,_this.getCurrentTab())});locateScroller.call(this.tabWrap)},getCurrentTab:function(){if(!this.currentTabName){var _this=this;this.tabWrapUl.children("li").each(function(i,o){var curTab=$(this).attr("class");if(curTab.indexOf("h_cur")>-1){_this.currentTabName=$(this).attr("ref")}})}return this.getTab(this.currentTabName)},getTab:function(o){if($.type(o)!="object"){return this.tabWrapUl.children("li[ref='"+o+"']")}return o&&o.length?o:$(o)},addTab:function(params){if(!params.url){Horn.Msg.alert("提示","页签url必填，请检查！");return}var _this=this;var maxTabCn=params.maxTabCn?params.maxTabCn:this.maxTabCn;var tabWidth=params.width?params.width:this.tabWidth||"auto";if(params.name&&this.getTab(params.name).length){this.activate(params.name);return}if(this.tabWrapUl.children("li").length>=maxTabCn){Horn.Msg.alert("提示","最多只能添加"+maxTabCn+"个页签");return}var tabPanel=this.el;var tabWrapUl=this.tabWrapUl;var ref=params.name||("h_tab-uldiv-"+new Date().getTime());var refID=Horn.id("tab-uldiv-");if(!params.title){params.title="未命名页签"}var newTab=createTab(ref,params.title,tabWidth).appendTo(tabWrapUl);var newContent=createContent(ref,refID).appendTo(this.contentsDiv);newTab.data("content",newContent).click(function(){_this.activate($(this))});if(this.tabWidth){var icon=newTab.children(".h_tab-icon");var title=newTab.children(".h_tab-title");title.css({width:parseInt(_this.tabWidth)-icon.outerWidth()})}this.position=this.params.position||"top";this.isVertical=this.position=="left"||this.position=="right";this.tabWrap.data("isVertical",this.isVertical);var tabWrapUl=this.tabWrapUl;if(this.isVertical){var liWidth=tabWrapUl.children("li:eq(0)").width();this.contentsDiv.css("margin-"+this.position,this.tabsDiv.outerWidth())}newContent.attr("lazyload",params.url||"");whenTabEdit.call(this);this.activate(ref);return ref},removeTab:function(name){var tab=this.getTab(name);if(!tab||!tab.length){return}if(isActive(tab)){var closestTab=getClosest(tab);if(!closestTab||!closestTab.length){Horn.Msg.alert("提示","至少要有一个页签");return}this.activate(closestTab)}tab.data("content").remove();tab.remove();whenTabEdit.call(this)},closeTab:function(name){this.removeTab(name)},renderTab:function(content,bp){content.children().remove();if((bp.html&&bp.html.length>3)||(bp.jsCode&&bp.jsCode.length>3)){BigPipe.onArrive(bp);Horn.setCurrent(content);BigPipe.start();Horn.init()}content.data("loaded",true)},activate:function(name){var tab=this.getTab(name);if(tab&&tab.length&&tab.is(":visible")){selectTab.call(this,tab)}},locate:function(o){this.activate(o)},enable:function(name){var tab=this.getTab(name).show();whenTabEdit.call(this);this.activate(tab)},disable:function(name){var tab=this.getTab(name);if(!tab||!tab.length){return}if(isActive(tab)){var closestTab=getClosest(tab);if(!closestTab||!closestTab.length){Horn.Msg.alert("提示","至少要有一个页签");return}this.activate(closestTab)}tab.hide().data("content").hide();whenTabEdit.call(this)},doLayout:function(){}});function selectTab(tab){if(!tab||!tab.length){return false}var ref=tab.attr("ref");var currentTab=this.getCurrentTab();if(currentTab&&currentTab.length){if(currentTab.attr("ref")!=ref){var currentContent=currentTab.data("content");if(!whenTabChange.call(this,currentTab,currentContent)){return}currentTab.removeClass("h_cur");currentContent.hide();this.tabChange(currentTab,tab)}else{}}this.currentTabName=ref;tab.addClass("h_cur");var content=tab.data("content").show();var url=content.attr("lazyload");if(url&&!content.data("loaded")){var contentId=content.attr("id");url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+contentId;var _this=this;requestPage.call(this,{id:contentId,url:url,content:content,success:function(){moveToCenter.call(_this,tab)}})}else{moveToCenter.call(this,tab)}}function moveToCenter(tab,noDelay){var tabWrap=this.tabWrap;tabWrap.stop(false,true);scroll.call(this,calculateActualScroll.call(this,tab,tabWrap),noDelay)}function isCoverByScroller(tab){var tabOffset=tab.offset();var d=8;if(this.isVertical){var topScroller=this.topScroller;var bottomScroller=this.bottomScroller;var tabHeight=tab.outerHeight();var coverByTopScroller=topScroller.is(":visible")&&tabOffset.top<=topScroller.offset().top+topScroller.outerHeight()+d;var coverByBottomScroller=bottomScroller.is(":visible")&&tabOffset.top+tabHeight+d>=bottomScroller.offset().top;return coverByTopScroller||coverByBottomScroller}else{var leftScroller=this.leftScroller;var rightScroller=this.rightScroller;var tabWidth=tab.outerWidth();var coverByLeftScroller=leftScroller.is(":visible")&&tabOffset.left<=leftScroller.offset().left+leftScroller.outerWidth()+d;var coverByRightScroller=rightScroller.is(":visible")&&tabOffset.left+tabWidth+d>=rightScroller.offset().left;return coverByLeftScroller||coverByRightScroller}}function calculateActualScroll(tab,tabWrap){var actualScroll=0;var scrollLength=tabWrap.data("scrollLength");if(isCoverByScroller.call(this,tab)){if(this.isVertical){var tabHeight=tab.outerHeight();var wrapHeight=tabWrap.outerHeight();var p1=tab.position().top;var p2=(wrapHeight-tabHeight)/2;var scrollTop=this.tabWrap.scrollTop()+p1-p2;actualScroll=scrollTop+wrapHeight>scrollLength?(scrollLength-wrapHeight):scrollTop}else{var tabWidth=tab.outerWidth();var wrapWidth=tabWrap.outerWidth();var p1=tab.position().left;var p2=(wrapWidth-tabWidth)/2;var scrollLeft=this.tabWrap.scrollLeft()+p1-p2;actualScroll=scrollLeft+wrapWidth>scrollLength?(scrollLength-wrapWidth):scrollLeft}}else{actualScroll=this.isVertical?tabWrap.scrollTop():tabWrap.scrollLeft()}return actualScroll}function scroll(distance,noDelay){if(this.isVertical){scrollTop.call(this.tabWrap,distance,noDelay)}else{scrollLeft.call(this.tabWrap,distance,noDelay)}}function scrollLeft(distance,noDelay){var wrapWidth=this.outerWidth();var scrollLength=this.data("scrollLength");distance=distance!=undefined?distance:this.scrollLeft();distance=distance+wrapWidth>scrollLength?(scrollLength-wrapWidth):distance;this.animate({scrollLeft:distance},noDelay?0:250,function(){locateScroller.call($(this))})}function scrollTop(distance,noDelay){var scrollLength=this.data("scrollLength");var wrapHeight=this.outerHeight();distance=distance!=undefined?distance:this.scrollTop();distance=distance+wrapHeight>scrollLength?(scrollLength-wrapHeight):distance;this.animate({scrollTop:distance},noDelay?0:250,function(){locateScroller.call($(this))})}function locateScroller(){if(this.data("isVertical")){var topScroller=this.siblings(".h_tabscroller-top");var bottomScroller=this.siblings(".h_tabscroller-bottom");var scrollTop=this.scrollTop();if(scrollTop==0){topScroller.hide()}else{topScroller.show()}if((scrollTop+this.outerHeight())<this.data("scrollLength")){bottomScroller.css("top",135);bottomScroller.show()}else{bottomScroller.hide()}}else{var leftScroller=this.siblings(".h_tabscroller-left");var rightScroller=this.siblings(".h_tabscroller-right");var scrollLeft=this.scrollLeft();if(scrollLeft==0){leftScroller.hide()}else{leftScroller.show()}if((scrollLeft+this.outerWidth())<this.data("scrollLength")){rightScroller.show()}else{rightScroller.hide()}}}function calculateScrollLength(){var v=this.isVertical;var tabWrap=this.tabWrap;var tabWrapUl=tabWrap.children("ul");var tabsTotalLength=0;tabWrapUl.children("li:visible").each(function(i,o){var $this=$(this);var margin,size;if(v){margin=parseInt($this.css("margin-top"))+parseInt($this.css("margin-bottom"));size=$this.outerHeight()}else{margin=parseInt($this.css("margin-left"))+parseInt($this.css("margin-right"));size=$this.outerWidth()}tabsTotalLength+=size+margin});tabsTotalLength+=(v?20:40);tabWrap.data("scrollLength",tabsTotalLength);return tabsTotalLength}function initScrollerEvents(){var tabWrap=this.tabWrap;this.leftScroller.click(function(){scrollLeft.call(tabWrap,tabWrap.scrollLeft()-150)});this.rightScroller.click(function(){scrollLeft.call(tabWrap,tabWrap.scrollLeft()+150)});this.topScroller.click(function(){scrollTop.call(tabWrap,tabWrap.scrollTop()-104)});this.bottomScroller.click(function(){scrollTop.call(tabWrap,tabWrap.scrollTop()+104)})}function isActive(tab){return tab.hasClass("h_cur")}function getClosest(jq){if(!jq||!jq.length){return undefined}var closest=jq.nextAll(":visible:first");return closest.length?closest:jq.prevAll(":visible:first")}function requestPage(params){var _this=this;$.ajax(params.url,{type:"get",error:function(xhr,textStatus,errorThrown){_this.renderTab(params.content,{html:"",id:params.id||"",css:[],js:[],jsCode:""});if(params.callback){params.callback()}},success:function(reqData,textStatus,jqXHR){_this.renderTab(params.content,eval("("+reqData+")"));if(params.success){params.success()}if(params.callback){params.callback()}}})}function whenTabChange(tab,content){if(!this.isFormValidate){return true}if(!Horn.Validate.isFormValidate(content)){var title=tab.attr("title");if(title!="该页签下有未验证通过的内容"){tab.attr("title","该页签下有未验证通过的内容").append('<span class="h_tabli-error"></span>')}tab.data("content").show();return false}tab.attr("title",tab.attr("tipMsg")).find("span.h_tabli-error").remove();return true}function whenTabEdit(){calculateScrollLength.call(this);scroll.call(this)}function createTab(ref,title,width){var tab=[];tab.push('<li ref="'+ref+'" title="'+title+'" tipMsg="'+title+'"');tab.push(' class="h_tabpanel-wrap-li" style="width:'+width+'"><a href="javascript:void(0)">');tab.push('<span class="h_tab-arrow"></span>');tab.push('<span class="h_tab-icon"></span>');tab.push('<span class="h_tab-title">'+title+"</span>");tab.push("</a></li>");return $(tab.join(""))}function createContent(ref,refID){return $('<div style="display: block" class="h_tabpanel-content" ref_target="'+ref+'" id="'+refID+'"></div>')}function initTabPosition(p){this.position=p||this.params.position||"top";this.isVertical=this.position=="left"||this.position=="right";this.tabWrap.data("isVertical",this.isVertical);var _this=this;var tabWrapUl=this.tabWrapUl;if(this.isVertical){var liWidth=tabWrapUl.children("li:eq(0)").width();tabWrapUl.children("li").width(liWidth);tabWrapUl.width("auto").width(tabWrapUl.width()-1);this.contentsDiv.css("margin-"+this.position,this.tabsDiv.outerWidth())}var height=(this.params.height||"")+"";if(height){height=height.match(/[px|%]+$/)?height:height+"px";if(this.isVertical){tabWrapUl.height(5000);this.tabWrap.height(parseInt(height)+2)}this.tabWrap.unbind().mousewheel(function(event,delta){event.preventDefault();var $this=$(this);var scrollOffset=_this.isVertical?$this.scrollTop():$this.scrollLeft();if(delta>0){scroll.call(_this,scrollOffset-80,true)}else{scroll.call(_this,scrollOffset+80,true)}})}else{if(this.params.tabFloat){this.tabsDiv.floatTop()}}}$.extend(Horn.TabPanel,{DATANAME:"h_tabpanel",get:function(name){var arr=Horn.data(Horn.TabPanel.DATANAME);var tabPanel=arr[0];return tabPanel},locate:function(obj){Horn.TabPanel.get().locate(obj)},activate:function(obj){Horn.TabPanel.get().activate(obj)},enable:function(obj){Horn.TabPanel.get().enable(obj)},disable:function(obj){Horn.TabPanel.get().disable(obj)}});Horn.regUI("div.h_tabpanel",Horn.TabPanel)})(Horn);(function(d){d.extend(d.fn,{floatLeft:function(){return this._float("left")},floatTop:function(){return this._float("top")},floatRight:function(){return this._float("right")},floatBottom:function(){return this._float("bottom")},floatCenter:function(){return this.floatLeft().floatTop().floatRight().floatBottom()},_float:function(l){return this.each(function(){b.call(d(this),null,l)})},cancelFloat:function(){return k.call(this)}});function a(m){var n=document,l=n.compatMode=="BackCompat"?n.body:n.documentElement;if(m=="width"){return l.clientWidth}else{if(m=="height"){return l.clientHeight}}return undefined}function b(n,m){n=n||d(window);var l=this;n.scroll(d.data(this[0],"scrollOnFloat",function(){if(!l.data("hasFloat")){f.call(l)}var p=d(this);var q=l.data(),u=q.offset;var s=p.scrollTop(),t=p.scrollLeft();var o,r=undefined;switch(m){case"left":o=t-u.left;r="right";break;case"top":o=s-u.top;r="bottom";break;case"right":o=u.left+l.outerWidth()-t-a("width");r="left";break;case"bottom":o=u.top+l.outerHeight()-s-a("height");r="top";break;default:o=t-u.left;r="right"}if(q.fixed[r]){return}if(o>0){g.call(l,m,{left:t,top:s},r)}else{e.call(l,m)}}))}function k(m){var l=this;m=m||["top","left","bottom","right"];d.each(m,function(o,n){e.call(l,n)});d(window).unbind("resize",this.data("resizeOnFloat")).unbind("scroll",this.data("scrollOnFloat"))}function f(){this.data({hasFloat:true,isAbsolute:this.css("position")=="absolute",page:undefined,fixed:{},style:this.attr("style"),offset:this.offset()});var l=this;d(window).resize(d.data(this[0],"resizeOnFloat",function(){if(l.css("position")=="fixed"){var o=l.next(),n=o.offset(),m=l.data("fixed");if(!m.left&&!m.right){l.css("left",n.left)}else{if(!m.top&&!m.bottom){l.css("top",n.top)}}l.css({width:o.width()}).data({offset:o.offset()})}else{l.data({offset:l.offset()})}}))}function g(m,l,q){var p=this.data(),r=p.offset;var o=c(this,m);if(o){this.css(o,0)}else{if(!p.fixed[m]){var n=this.outerWidth();if(!p.isAbsolute){this.clone().css("visibility","hidden").insertAfter(this)}this.css({position:"fixed",marginLeft:"auto",marginTop:"auto",width:n,zIndex:99999})}this.css({left:r.left-l.left,top:r.top-l.top})}p.fixed[m]=true;this.css(m,0);if(q){this.css(q,"auto")}}function e(l){var m=this.data();if(m.fixed&&m.fixed[l]){m.fixed[l]=false;if(c(this,l)==undefined){if(!m.isAbsolute){this.next().remove()}this.removeAttr("style").attr("style",m.style)}}}function c(m,l){var n=undefined;var q=m.data("fixed");for(var o in q){if(l!=o&&q[o]){n=o;break}}return n}function i(l){l+="";l=l?l:"0px";l=l.replace(/^\s+|\s+$/g,"");return l.match(/[px|%|auto]+$/)?l:l+"px"}function j(l){return l?Horn.paramCaches[l.attr("paramcacheid")]||{}:{}}function h(m,l){if(m.currentStyle){return m.currentStyle[l]}else{return getComputedStyle(m,false)[l]}}})(jQuery);(function(n,p,u){var w=n([]),s=n.resizes=n.extend(n.resizes,{}),o,l="setTimeout",m="resizes",t=m+"-special-event",v="delay",r="throttleWindow";s[v]=250;s[r]=true;n.event.special[m]={setup:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.add(a);n.data(this,t,{w:a.width(),h:a.height()});if(w.length===1){q()}},teardown:function(){if(!s[r]&&this[l]){return false}var a=n(this);w=w.not(a);a.removeData(t);if(!w.length){clearTimeout(o)}},add:function(b){if(!s[r]&&this[l]){return false}var c;function a(d,h,g){var f=n(this),e=n.data(this,t);e.w=h!==u?h:f.width();e.h=g!==u?g:f.height();c.apply(this,arguments)}if(n.isFunction(b)){c=b;return a}else{c=b.handler;b.handler=a}}};function q(){o=p[l](function(){w.each(function(){var d=n(this),a=d.width(),b=d.height(),c=n.data(this,t);if(a!==c.w||b!==c.h){d.trigger(m,[c.w=a,c.h=b])}});q()},s[v])}})(jQuery,this);
Horn.TargetSelect=Horn.extend(Horn.Field,{COMPONENT_CLASS:"TargetSelect",field:null,hidden:null,name:null,alias:null,callback:null,init:function(b){Horn.TargetSelect.superclass.init.apply(this,arguments);var c=this;this.select=this.el;this.hidden=this.select.children("input[type='hidden']");this.field=this.hidden.next();this.name=this.hidden.attr("name");this.alias=this.hidden.attr("alias")||"";if(this.params.afterClear){var a=this.params.afterClear.replace("(","").replace(")","");this.callback=window[a]}var c=this;this.el.children("a").bind({click:Horn.Util.apply(c.delVal,c)})},setValue:function(a){var b=this.getValue();if(a==null||a==""){this.field.val("");this.hidden.val("")}else{if(a instanceof Object){this.field.val(a.label);this.hidden.val(a.key)}else{this.field.val(a);this.hidden.val(a)}}if(a&&a.key!=b){this.getEventTarget().trigger("change")}this.validate()},getText:function(){var a=this.field.val();return a},delVal:function(){if(this.params.disabled){return}var b=this;var a=this.field.val();if(a!=""){Horn.Msg.confirm("确认","你确定要清除该值？",function(){b.hidden.val("");b.field.val("");if(b.callback){b.callback()}},function(){})}}});Horn.Field.regFieldType("div.hc_inputsearch",Horn.TargetSelect);


(function(a){a.TipBox=a.extend(a.Base,{init:function(b){Horn.TipBox.superclass.init.apply(this,arguments);this.el.appendTo($("body"))},getTipBox:function(b){return this.children(".hc_tip-"+b)}});Horn.regUI("div.hc_tip-list",Horn.TipBox)})(Horn);(function(c){var d={message:"提示信息",location:"auto",type:"error",event:"hover",style:"",timeout:undefined};c.extend(c.fn,{addTip:function(f){f=f||d;if(typeof f=="string"){f=c.extend({},d,{message:f})}else{f=c.extend({},d,f)}if(this.length>1){return this.each(function(g,h){c(this).addTip(f)})}if(!this.data("tip")){this.data("tip",c.extend({},f,{tipList:c(document.body).children(".hc_tip-list"),timeouts:[]}));if(f.event=="hover"){this.hover(this.tipBoxEnter=function(){var i=c(this);var j=i.offset();var k=i.data("tip");e(k.timeouts);var g=b.call(i);var h=k.tipBox;k.timeouts.push(setTimeout(function(){h.css({left:j.left,top:g=="down"?j.top+i.outerHeight()+"px":j.top-40+"px"});h.find(".hc_tip-content").html(k.message||"");h.fadeIn(200,function(){if(f.timeout){k.timeouts.push(setTimeout(function(){h.fadeOut(300);k.timeouts.splice(k.timeouts.length-1)},f.timeout))}});k.timeouts.splice(k.timeouts.length-1)},300))},this.tipBoxLeave=function(){var g=c(this).data("tip");e(g.timeouts);g.tipBox.fadeOut(260)})}}this.data("tip").message=f.message;return this},removeTip:function(){return this.unbind("mouseenter",this.tipBoxEnter).unbind("mouseleave",this.tipBoxLeave).data({tip:null})},positionTo:function(i){i=i||c("body");var h={left:0,top:0};var m=this.get(0),g=m.tagName.toUpperCase();var j=this.offsetParent();if(j[0]!=i[0]&&g!="HTML"&&g!="BODY"){h=j.positionTo(i);var f=0,l=0;if(j.css("borderWidth")!="medium"&&j.css("boxSizing")!="border-box"){f=parseInt(j.css("borderLeftWidth"));l=parseInt(j.css("borderTopWidth"))}h={left:h.left+f,top:h.top+l}}var k=this.position();return{left:h.left+k.left,top:h.top+k.top}}});function b(){var h=this.data("tip"),f=h.location;if(f=="auto"){var g=document.body.scrollTop||document.documentElement.scrollTop;f=this.offset().top-g<40?"down":"up"}h.tipBox=h.tipList.children(".hc_tip-"+f);return f}function e(f){if(!f){return}if(typeof f=="string"){clearTimeout(f)}else{c.each(f,function(g,h){clearTimeout(h)});f.splice(0)}}function a(g,f){}})(jQuery);
Horn.TypeField=Horn.extend(Horn.Field,{regChars:"-0123456789",suffixNumber:2,init:function(c){Horn.TypeField.superclass.init.apply(this,arguments);this.params.inputType=this.params.inputType?this.params.inputType:"money";this.config={};this.config.bigTips=this.params.bigTips||false;if(this.params.split==""){this.config.split=this.params.split}else{this.config.split=this.params.split||","}if(this.params.suffixNum){var a=/^\d+(\.\d+)?$/;if(a.test(this.params.suffixNum)){this.suffixNumber=this.params.suffixNum}}if(this.params.integerNum){this.integerNum=this.params.integerNum}var b=this;this.field.bind({keypress:Horn.Util.apply(b.onKeyPress,b)});var f=this.el.find("#u-typefield-tip-id").appendTo($("body")).html(this.params.value||"");var e="";if(this.field.width()&&this.field.width()>0){e=this.el.find("#u-typefield-capital-id").width(this.field.width())}else{e=this.el.find("#u-typefield-capital-id").css("width","100px")}this.tipLabel=f;this.tipDiv=e;if(this.params.inputType==="money"){this.maskRe=new RegExp("["+this.regChars+".]");this.check="decmal1;";this.initProcess()}else{if(this.params.inputType==="cardNo"){this.maskRe=new RegExp("["+this.regChars+"]");this.check="num;";this.initProcess()}else{return}}$(window).resize(function(){f.hide()});var d=this.getIEVersion();if(d!=-1&&d<10){if(this.params.emptyText&&this.params.emptyText!=""){this.field.val(this.params.emptyText)}}},setValue:function(f){f=f+"";if(f!=null&&f!=""){f=f+"";f=f.replace(/(^\s*)|(\s*$)/g,"")}var e=this.hidden;var g=this.field;if(f===undefined||f===null||f==""){g.val("");e.val("");this.tipLabel.html("");this.tipDiv.html("")}else{if(f.indexOf(".")==0){f="0"+f}var d=f.substring(0,1);f=f.replace(/[^0-9\.-]/g,"");e.val(f);this.changeTipsVal(f);var b,h="";if(this.params.inputType=="money"){b=spliteByChar(f,this.config.split,this.suffixNumber,this.integerNum);if(d=="-"){b=d+b}g.val(b)}else{if(this.params.inputType=="cardNo"){if(f!=null&&f!=""){if(f.indexOf(".")!=-1){f=f.split(".")[0]}}var c=f,a="";b=c?c.match(/\d{1,4}/g).join("  "):"";g.attr("value",b);g.val(b)}}}if(f!=null&&f!=""){if(this.params.value!=f){this.validate()}}},getValue:function(){var a=this.hidden.val();if(a!=null&&a!=""){a=a+"";a=a.replace(/(^\s*)|(\s*$)/g,"")}return a},onKeyPress:function(b){var a=b.keyCode;var c=String.fromCharCode(a);if(!this.maskRe.test(c)){}},showBigtips:function(){var a=this.field.width(),b=this.field.outerHeight();this.tipLabel.css({top:this.field.offset().top+b,left:this.field.offset().left,"z-index":9999}).show()},hideBigtips:function(){this.tipLabel.hide()},initProcess:function(){var a=this;var b=this.tipLabel;if(this.params.value&&/^[\d|\.-]*$/.test(this.params.value)){this.setValue(this.params.value)}else{this.params.value="";this.setValue("")}if(this.params.defValue&&/^[\d|\.-]*$/.test(this.params.defValue)){}else{this.params.defValue=""}this.field.focusin(function(){$(this).val(a.hidden.val());if(a.params.bigTips==true&&a.hidden.val()&&a.hidden.val()!=""){a.showBigtips()}});this.field.focusout(function(){a.hideBigtips();a.setValue(a.hidden.val())});this.field.keyup(function(c){a.changeTipsVal($(this).val());if(a.hidden.val()&&a.hidden.val()!=""){if(a.params.bigTips==true){a.showBigtips()}}else{a.hideBigtips()}})},changeTipsVal:function(g){var j=g.substring(0,1);g=g.replace(/[^0-9\.-]/g,"");if(this.params.inputType=="cardNo"){if(g!=null&&g!=""){if(g.indexOf(".")!=-1){g=g.split(".")[0]}}}if(g==""||g==null){var e=g.split(".");if(e&&e.length>1){var b=parseFloat(e[1]).toFixed(this.suffixNumber);if(b!=0){g=parseFloat(g).toFixed(this.suffixNumber)}}}this.hidden.val(g);var c,k="";if(this.params.inputType=="money"){var f=g.split(".");if(f.length>0){var a=f[0].substr(0,this.integerNum);if(f.length>1){g=a+"."+f[1]}else{g=a}this.hidden.val(g)}if(g.split(".")[1]&&g.split(".")[1].length>2){g=parseFloat(g).toFixed(this.suffixNumber);this.hidden.val(g)}c=spliteByChar(g,this.config.split,this.suffixNumber,this.integerNum);k=numtochinese(g+"",this.suffixNumber);this.tipLabel.html(k);this.tipDiv.html(k);this.tipDiv.attr("title",k)}else{if(this.params.inputType=="cardNo"){var h=g,d="";c=h?h.match(/\d{1,4}/g).join("  "):"";d=h?h.match(/\d{1,4}/g).join(""):"";this.tipLabel.html(c)}}}});Horn.Field.regFieldType("div.hc_textfield.typefield",Horn.TypeField);function isSpecialKey(a,b){return(b.type=="keypress"&&b.ctrlKey)||(a>=33&&a<=40)||a==13||a==9||a==27||(a==8)||(a>=16&&a<=20)||(a>=44&&a<=46)}function spliteByChar(b,k,j,c){var f=b.substring(0,1);if(f=="-"){b=b.substring(1)}var g=b,e=g.split("."),h=e[0],d="";h=h.replace(/\D{1}/g,"");if(!h){return}h=h.substr(0,c);$.each(h.reverse().match(/\d{1,3}/g).reverse(),function(l,m){d+=m.reverse()+k});if(k!=""){d=d.replace(new RegExp("["+k+"]$"),"")}var a=d+(e.length>1?"."+e[1].substr(0,j):"");return a}function numtochinese(e,l){for(i=e.length-1;i>=0;i--){e=e.replace(",","");e=e.replace(" ","")}e=e.replace("￥","");if(isNaN(e)){return}var b=String(e).split(".");var c="";for(i=b[0].length-1;i>=0;i--){if(b[0].length>17){return"位数过大，无法计算"}var a="";var j=b[0].charAt(i);switch(j){case"0":a="零"+a;break;case"1":a="壹"+a;break;case"2":a="贰"+a;break;case"3":a="叁"+a;break;case"4":a="肆"+a;break;case"5":a="伍"+a;break;case"6":a="陆"+a;break;case"7":a="柒"+a;break;case"8":a="捌"+a;break;case"9":a="玖"+a;break}if(j!=0){switch(b[0].length-i-1){case 1:a=a+"拾";break;case 2:a=a+"佰";break;case 3:a=a+"仟";break;case 5:a=a+"拾";break;case 6:a=a+"佰";break;case 7:a=a+"仟";break;case 9:a=a+"拾";break;case 10:a=a+"百";break;case 11:a=a+"仟";break;case 13:a=a+"拾";break;case 14:a=a+"百";break;case 15:a=a+"仟";break;case 16:a=a+"吉";break}}else{switch(b[0].length-i-1){case 0:a=a+"元";break;case 4:a=a+"万";break;case 8:a=a+"亿";break;case 12:a=a+"兆";break;case 17:a=a+"拾";break}}c=a+c}if(e.indexOf(".")!=-1){if(b[1].length>2){var g=parseFloat(e);e=g.toFixed(l);b=String(e).split(".")}for(i=0;i<b[1].length;i++){a="";j=b[1].charAt(i);switch(j){case"0":a="零"+a;break;case"1":a="壹"+a;break;case"2":a="贰"+a;break;case"3":a="叁"+a;break;case"4":a="肆"+a;break;case"5":a="伍"+a;break;case"6":a="陆"+a;break;case"7":a="柒"+a;break;case"8":a="捌"+a;break;case"9":a="玖"+a;break}if(i==0){a=a+"角"}if(i==1){a=a+"分"}c=c+a}}while(c.search("零零")!=-1){c=c.replace("零零","零")}c=c.replace("零亿","亿");c=c.replace("亿万","亿");c=c.replace("零万","万");c=c.replace("零元","元");c=c.replace("零角","");c=c.replace("零分","");c=c.replace("亿万","亿");c=c.replace("兆亿","兆");c=c.replace("零兆","兆");c=c.replace("吉兆","吉");if(c.charAt(c.length-1)=="元"||c.charAt(c.length-1)=="角"){c=c+"整"}var f=["壹","贰","叁","肆","伍","陆","柒","捌","玖"];var d=0;while(c.length>0){if(f.indexOf(c[0])<0){c=c.substr(1)}else{break}}var h=e.substring(0,1);if(h=="-"){c="负"+c}var k=c.charAt(c.length-1);if("零"==k){c=c.substring(0,c.length-1);c=c+"整"}return c};
(function(a){a.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["1","2","3","4","5","6","7","8","9","10","11","12"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今天",suffix:[],meridiem:["上午","下午"]}}(jQuery));Horn.Calendar=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Calendar",init:function(dom){Horn.Calendar.superclass.init.apply(this,arguments);var input=this.el.children("input:text");var hidden=this.el.children("input:hidden");this.name=hidden.attr("name");this.alias=hidden.attr("alias");var config=this.params.config;var settings={};if(config&&typeof(config)=="string"){settings=eval("("+config+")")}else{if(typeof(config)=="object"){settings=config}else{settings={}}}this.format=settings.format;if(!settings.format){settings.format=Horn.Calendar.DEFAULT_FORMAT;hidden.attr("format","noConfig")}else{hidden.attr("format","yesConfig")}settings.btnBar=false;this.settings=settings;this.minDate=Horn.Util.Format.date(settings.minDate,"yyyy-MM-dd HH:mm");this.maxDate=Horn.Util.Format.date(settings.maxDate,"yyyy-MM-dd HH:mm");this.initDate=function(conf){var lformat=conf.format.toLowerCase();var viewNo=conf.format.indexOf("m")>-1?0:lformat.indexOf("h")>-1?1:lformat.indexOf("d")>-1?2:conf.format.indexOf("M")>-1?3:4;if(viewNo===3){conf.noToday=true}var that=this;this.calobj=input.datetimepicker({format:conf.format,startDate:that.minDate,endDate:that.maxDate,language:"zh-CN",autoclose:true,minView:viewNo,startView:viewNo===3?4:2,todayBtn:conf.noToday===true?false:true}).on("changeDate",function(e){var h=e.date.getHours()-8;e.date.setHours(h);var date=e.date.format(conf.format);this.value=date;that.hidden.val(date);if(that.params.focusShowCalendar==false||that.params.canEditable==false){that._inputValue=date}}).on("hide",function(){input.trigger("blur");if(that._inputValue!=null){var date;if(that._inputValue==""){date=""}else{date=Horn.Util.Format.date(that._inputValue,that.settings.format);if(that.params.focusShowCalendar==false||that.params.canEditable==false){date=that._inputValue}if(date.indexOf("1899")==0){date=that._inputValue}}that.hidden.val(date);this.value=date;that._inputValue=null}else{this.value=that.hidden.val()}});if(this.minDate!=undefined){input.datetimepicker("setStartDate",that.minDate)}if(this.maxDate!=undefined){input.datetimepicker("setEndDate",that.maxDate)}};var that=this;input.focus(function(){var _org=$(this).val();if(_org&&_org.indexOf("/")==-1&&_org.indexOf("-")==-1){var _ttt=Horn.Util.Format.date(_org,"yyyy-MM-dd");$(this).val(_ttt)}return true}).keyup(function(e){that._inputValue=$(this).val();that.hidden.val($(this).val())}).keypress(function(e){that._inputValue=$(this).val();that.hidden.val($(this).val())}).blur(function(e){that.formatValue();that.validate()});var disabled=this.field.attr("disabled");if(disabled&&disabled=="disabled"){return}var $a=input.next("i");var inputNotShow=input.attr("inputNotShow");$a.click(function(){var disabled=that.field.attr("disabled");if(disabled&&disabled=="disabled"){return}input.attr("focusShowCalendar","true");input.attr("canEditable","true");input.focus();input.focus();if(inputNotShow=="false"){input.attr("focusShowCalendar","false");input.attr("canEditable","false")}});this.initDate(settings);if(this.params.readonly){this.setReadonly(true)}if(this.params.disabled){this.setDisabled(true)}var val=hidden.val();if(val!=""){this.setValue(val)}},getEventTarget:function(){return this.el.children("input:text")},setValue:function(a){this.field.val(a);this.hidden.val(a);this.validate()},getValue:function(){var a=this.get().val();if(a!=null&&a!=""){a=a+"";a=a.replace(/(^\s*)|(\s*$)/g,"")}if(a!=""){a=Horn.Util.Format.date(a,this.settings.format)}else{a=""}return a},reset:function(a){this.field.val(a?"":this.defValue);this.hidden.val(a?"":this.defHiddenValue);this.validate()},validate:function(){if(this.disabled){return}this.removeError();this.err=false;var e=true;var c=this;c.formatValue();var a=c.hidden.attr("check");if(a&&a.length>0&&!this.params.config){if(c.calobj.val()!=""){var b=a.split(";");var f="";for(var d=0;d<b.length;d++){var g=b[d];g=g.replace("(","").replace(")","");if(g!=""&&g!="Horn.Validate.validateFmt"&&g!=Horn.Validate.REQUIRED){Horn.Validate.onValid({data:[Horn.Validate,c]});return}}}}if(c.calobj.val()!=""){if(!Horn.Util.Format.validateFmt(c.calobj.val(),c.settings.format)){e=false;this.err=true;c.showError("日期格式不正确,格式为："+c.settings.format);return}}else{if(a&&a.indexOf(Horn.Validate.REQUIRED)>-1){e=false;this.err=true;c.showError("该输入不能为空！");return}}},formatValue:function(){var a=this;var b=a.hidden.val();if(b!=""){date=Horn.Util.Format.date(b,a.settings.format)}else{date=""}if(date.indexOf("1899")==0){date=a.hidden.val()}a.hidden.val(date);a.calobj.val(date);a.value=date},isValid:function(){if(this.disabled){return true}if(this.calobj.val()==null||this.calobj.val()==""){var a=this.hidden.attr("check");if(a&&a.indexOf(Horn.Validate.REQUIRED)>-1){return false}else{return true}}else{return(Horn.Util.Format.validateFmt(this.calobj.val(),this.settings.format)&&!this.err)?true:false}},initEvents:function(){var a=this;a.checkRegx=[];var b=this.field.attr("checkstr");if(b){a.checkRegx=b.split(";")}this.field.blur(function(){var e="yyyy-MM-dd";if(a.settings){var d=a.settings.format;if(d){e=d}}var f=$(this).val();if(f!=""){var c=Horn.Util.Format.date(f,e);$(this).val(c)}setTimeout(function(){var g=a.hidden.attr("check");var k=true;if(g&&g.length>0&&!a.params.config){if(a.calobj.val()!=""){var h=g.split(";");var l="";for(var j=0;j<h.length;j++){var m=h[j];m=m.replace("(","").replace(")","");if(m!=""&&m!="Horn.Validate.validateFmt"&&m!=Horn.Validate.REQUIRED){Horn.Validate.onValid({data:[Horn.Validate,a]});return}}}}if(a.calobj.val()!=""){if(!Horn.Util.Format.validateFmt(a.calobj.val(),a.settings.format)){a.showError("日期格式不正确,格式为："+a.settings.format)}else{a.removeError();Horn.Validate.onValid({data:[Horn.Validate,a]})}}else{a.removeError();var g=a.hidden.attr("check");if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){a.showError("该输入不能为空！")}}},10)})},setEnable:function(a){if(a){this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.field.attr("disabled","disabled");this.hidden.attr("disabled","disabled")}},setReadonly:function(a){Horn.Calendar.superclass.setReadonly.apply(this,arguments);if(this.readonly){this.calobj.datetimepicker("remove")}else{this.initDate(this.settings)}}});Horn.apply(Horn.Calendar,{DEFAULT_FORMAT:"yyyy-MM-dd"});Horn.Field.regFieldType("div.hc_calendar",Horn.Calendar);
Horn.CalendarGroup=Horn.extend(Horn.Field,{COMPONENT_CLASS:"CalendarGroup",cal1:null,cal2:null,hidden1:null,hidden2:null,name1:null,name2:null,calobj1:null,calobj2:null,defValue1:"",defHiddenValue1:"",defValue2:"",defHiddenValue2:"",inValidEle:null,tmpValide:"",init:function(dom){Horn.CalendarGroup.superclass.init.apply(this,arguments);this.el.attr("tabIndex",1000);var cal1=$(this.el.find("input:text")[0]);var cal2=$(this.el.find("input:text")[1]);var hidden1=$(this.el.find("input[type=hidden]")[0]);var hidden2=$(this.el.find("input[type=hidden]")[1]);this.name1=hidden1.attr("name");this.name2=hidden2.attr("name");this.name=this.name1;this.alias=hidden1.attr("alias");var config=this.params.config;var settings={};var _this=this;if(hidden1){this.defHiddenValue1=(this.params.defValue1!=undefined)?this.params.defValue1:hidden1.val()}if(hidden2){this.defHiddenValue2=(this.params.defValue2!=undefined)?this.params.defValue2:hidden2.val()}if(cal1){this.defValue1=(this.params.defValue1!=undefined)?this.params.defValue1:cal1.val()}if(cal2){this.defValue2=(this.params.defValue2!=undefined)?this.params.defValue2:cal2.val()}if(config&&typeof(config)=="string"){settings=eval("("+config+")")}else{if(typeof(config)=="object"){settings=config}else{settings={}}}this.format=settings.format;if(!settings.format){settings.format=Horn.Calendar.DEFAULT_FORMAT}this.settings=settings;$.fn.isValid=function(value,format){return Horn.Util.Format.validateFmt(value,format)};$.fn.getDate=function(){return this.val()};settings.onchange=function(){return cal1.change&&cal1.change()};if(!settings.maxDate){settings.maxDate="2999/12/31"}if(!settings.minDate){settings.minDate="1099/12/31"}this.minDate=this._formatDate(settings.minDate);this.maxDate=this._formatDate(settings.maxDate);var $a_cal1=cal1.next("i");var $a_cal2=cal2.next("i");var inputNotShow=cal1.attr("inputNotShow");$a_cal1.click(function(){var disabled=cal1.attr("disabled");if(disabled&&disabled=="disabled"){return}cal1.attr("focusShowCalendar","true");cal1.attr("canEditable","true");cal1.focus();cal1.focus();if(inputNotShow=="false"){cal1.attr("focusShowCalendar","false");cal1.attr("canEditable","false")}});$a_cal2.click(function(){var disabled=cal1.attr("disabled");if(disabled&&disabled=="disabled"){return}cal2.attr("focusShowCalendar","true");cal2.attr("canEditable","true");cal2.focus();cal2.focus();if(inputNotShow=="false"){cal2.attr("focusShowCalendar","false");cal2.attr("canEditable","false")}});if(!cal1.attr("readonly")||true){cal1.focus(function(event){if(_this.readonly){return false}var _org=cal1.val();if(_org&&_org.indexOf("/")==-1&&_org.indexOf("-")==-1){var _ttt=Horn.Util.Format.date(_org,"yyyy-MM-dd");cal1.val(_ttt)}var config1=Horn.apply({},settings);var maxDate=_this._formatDate(_this.cal2.val());maxDate=maxDate||_this.maxDate;if(!_this.compareDate(_this.minDate,maxDate)||!_this.compareDate(maxDate,_this.maxDate)){maxDate=_this.maxDate}config1=Horn.apply(config1,{minDate:Horn.Util.Format.date(_this.minDate,"yyyy-MM-dd HH:mm"),maxDate:Horn.Util.Format.date(maxDate,"yyyy-MM-dd HH:mm"),real:hidden1,btnBar:false,onSetDate:function(){setTimeout(function(){cal1.evented=true;cal1.blur()},100)}});var conf=config1;var lformat=conf.format.toLowerCase();var viewNo=conf.format.indexOf("m")>-1?0:lformat.indexOf("h")>-1?1:lformat.indexOf("d")>-1?2:conf.format.indexOf("M")>-1?3:4;if(viewNo===3){conf.noToday=true}var that=this;this.config1=conf;if(cal1.evented==undefined){_this.calobj1=cal1.datetimepicker({format:conf.format,startDate:conf.minDate,endDate:conf.maxDate,language:"zh-CN",autoclose:true,minView:viewNo,startView:viewNo===3?4:2,todayBtn:conf.noToday===true?false:true}).on("changeDate",function(e){var h=e.date.getHours()-8;e.date.setHours(h);var date=e.date.format(conf.format);this.value=date;hidden1.val(date)}).on("hide",function(){if(that._inputValue1!=null){var date;if(that._inputValue1==""){date=""}else{date=Horn.Util.Format.date(that._inputValue1,that.config1.format);if(date.indexOf("1899")==0){date=that._inputValue1}}hidden1.val(date);this.value=date;that._inputValue1=null}else{this.value=hidden1.val()}conf.onSetDate()}).keyup(function(){that._inputValue1=$(this).val();hidden1.val($(this).val())}).keypress(function(e){that._inputValue=$(this).val();hidden1.val($(this).val())})}if(conf.minDate!=undefined){_this.calobj1.datetimepicker("setStartDate",conf.minDate)}if(conf.maxDate!=undefined){_this.calobj1.datetimepicker("setEndDate",conf.maxDate)}_this.calobj1.datetimepicker("show");cal1.evented=true;var rv=_this.getIEVersion();if(rv!=-1&&rv<10){if(cal1.attr("placeholder")&&cal1.attr("placeholder")!=""){if(cal1.val()==cal1.attr("placeholder")){cal1.val("")}}}});var _field=this;cal1.blur(function(){_this.tmpValide="";if(!_field.format){$(this).attr("format","noConfig")}else{$(this).attr("format","yesConfig")}var _calendarGroup=_this;_this.formatVal();if(_this.cal1.val()!=""){if(_this.cal2.val()==""){var rule2=_this.cal2.attr("check");if(rule2&&rule2.indexOf(Horn.Validate.REQUIRED)>-1){_this.showError("当前输入不能为空");return}}if(!_field.format){var _validate=Horn.Validate;var comp=_calendarGroup;var obj=comp.cal1;var rules=_validate.getRules.call(_validate,obj);if(rules&&rules.length>0&&obj.attr("disabled")==undefined){_this.tmpValide=_validate.isValide.call(_validate,rules,comp,obj.val())}else{_validate.removeError.call(_validate,comp)}}}else{var rule1=_this.cal1.attr("check");if(rule1&&rule1.indexOf(Horn.Validate.REQUIRED)>-1&&(!_this.cal1.val()||!_this.cal2.val())){_this.showError("当前输入不能为空");return}}if(_this.cal1.val()!=""){_this.valideDateFormat()}var rv=_this.getIEVersion();if(rv!=-1&&rv<10){var placeholder=_this.cal1.attr("placeholder");if(placeholder&&placeholder!=""){if(_this.hidden1.val()==""){_this.cal1.val(placeholder)}}}})}if(!cal2.attr("readonly")||true){cal2.focus(function(event){if(_this.readonly){return false}var _org=cal2.val();if(_org&&_org.indexOf("/")==-1&&_org.indexOf("-")==-1){var _ttt=Horn.Util.Format.date(_org,"yyyy-MM-dd");cal2.val(_ttt)}var config2=Horn.apply({},settings);var minDate=_this._formatDate(_this.cal1.val());minDate=minDate||_this.minDate;if(!_this.compareDate(_this.minDate,minDate)||!_this.compareDate(minDate,_this.maxDate)){minDate=_this.minDate}config2=Horn.apply(config2,{maxDate:Horn.Util.Format.date(_this.maxDate,"yyyy-MM-dd HH:mm"),minDate:Horn.Util.Format.date(minDate,"yyyy-MM-dd HH:mm"),real:hidden2,btnBar:false,onSetDate:function(){setTimeout(function(){cal2.evented=true;cal2.blur()},10)}});var conf=config2;var lformat=conf.format.toLowerCase();var viewNo=conf.format.indexOf("m")>-1?0:lformat.indexOf("h")>-1?1:lformat.indexOf("d")>-1?2:conf.format.indexOf("M")>-1?3:4;if(viewNo===3){conf.noToday=true}var that=this;that.config2=conf;if(cal2.evented==undefined){_this.calobj2=cal2.datetimepicker({format:conf.format,language:"zh-CN",autoclose:true,minView:viewNo,startView:viewNo===3?4:2,todayBtn:conf.noToday===true?false:true}).on("changeDate",function(e){var h=e.date.getHours()-8;e.date.setHours(h);var date=e.date.format(conf.format);this.value=date;hidden2.val(date)}).on("hide",function(){if(that._inputValue2!=null){var date;if(that._inputValue2==""){date=""}else{date=Horn.Util.Format.date(that._inputValue2,that.config2.format);if(date.indexOf("1899")==0){date=that._inputValue2}}hidden2.val(date);this.value=date;that._inputValue2=null}else{this.value=hidden2.val()}conf.onSetDate()}).keyup(function(){that._inputValue2=$(this).val();hidden2.val($(this).val())}).keypress(function(e){that._inputValue2=$(this).val();hidden2.val($(this).val())})}if(conf.minDate!=undefined){_this.calobj2.datetimepicker("setStartDate",conf.minDate)}if(conf.maxDate!=undefined){_this.calobj2.datetimepicker("setEndDate",conf.maxDate)}_this.calobj2.datetimepicker("show");cal2.evented=true;var rv=_this.getIEVersion();if(rv!=-1&&rv<10){if(cal2.attr("placeholder")&&cal2.attr("placeholder")!=""){if(cal2.val()==cal2.attr("placeholder")){cal2.val("")}}}});cal2.blur(function(){_tmpValide="";if(!_field.format){$(this).attr("format","noConfig")}else{$(this).attr("format","yesConfig")}var _calendarGroup=_this;_this.formatVal();if(_this.cal2.val()!=""){if(_this.cal1.val()==""){var rule1=_this.cal1.attr("check");if(rule1&&rule1.indexOf(Horn.Validate.REQUIRED)>-1){_this.showError("当前输入不能为空");return}}if(!_field.format){var _validate=Horn.Validate;var comp=_calendarGroup;var obj=comp.cal2;var rules=_validate.getRules.call(_validate,obj);if(rules&&rules.length>0&&obj.attr("disabled")==undefined){_this.tmpValide=_validate.isValide.call(_validate,rules,comp,obj.val())}else{_validate.removeError.call(_validate,comp)}}}else{var rule2=_this.cal2.attr("check");if(rule2&&rule2.indexOf(Horn.Validate.REQUIRED)>-1&&(!_this.cal2.val()||!_this.cal1.val())){_this.showError("当前输入不能为空");return}}if(_this.cal2.val()!=""){_this.valideDateFormat()}var rv=_this.getIEVersion();if(rv!=-1&&rv<10){var placeholder=_this.cal2.attr("placeholder");if(placeholder&&placeholder!=""){if(_this.hidden2.val()==""){_this.cal2.val(placeholder)}}}})}this.cal1=cal1;this.hidden1=hidden1;this.cal2=cal2;this.hidden2=hidden2;if(this.params.disabled){this.setEnable(false)}if(this.params.readonly){this.setReadonly(true)}this.calobj1=this.cal1;this.calobj2=this.cal2;var rv=this.getIEVersion();if(rv!=-1&&rv<10){var placeholder=this.cal1.attr("placeholder");if(placeholder&&placeholder!=""){if(!this.params.value1||this.params.value1==""){this.cal1.val(this.cal1.attr("placeholder"))}if(!this.params.value2||this.params.value2==""){this.cal2.val(this.cal2.attr("placeholder"))}}}var conf=this.params.config;if(_this.calobj1.val()!=""&&conf&&conf!=""&&!Horn.Util.Format.validateFmt(_this.calobj1.val(),_this.settings.format)){_this.showError("日期格式不正确,格式为："+_this.settings.format);this.err=true;return}if(_this.calobj2.val()!=""&&conf&&conf!=""&&!Horn.Util.Format.validateFmt(_this.calobj2.val(),_this.settings.format)){_this.showError("日期格式不正确,格式为："+_this.settings.format);this.err=true}},getDisabled:function(b){var a=b.attr("disabled");if(a&&a=="disabled"){return true}return false},formatVal:function(){var e=this;var c=e.hidden1.val();var d="";if(c!=""){d=Horn.Util.Format.date(c,e.settings.format)}if(d.indexOf("1899")==0){d=c}e.hidden1.val(d);e.cal1.val(d);this.value=d;var a=e.hidden2.val();var b="";if(a!=""){b=Horn.Util.Format.date(a,e.settings.format)}if(b.indexOf("1899")==0){b=a}e.hidden2.val(b);e.cal2.val(b);this.value=b},valideDateFormat:function(){var c=true;var h=this;var d=true;var f=this.cal1.attr("check");if(f&&f.length>0){if(h.calobj1.val()==""||h.calobj2.val()==""){if(f.indexOf(Horn.Validate.REQUIRED)>-1){h.showError("该输入不能为空");c=false;this.err=true;return}}}if(f&&f.length>0&&!this.params.config){if(h.calobj1.val()!=""||h.calobj2.val()!=""){var a=f.split(";");var e="";for(var b=0;b<a.length;b++){var g=a[b];g=g.replace("(","").replace(")","");if(g!=""&&g!="Horn.Validate.validateFmt"&&g!=Horn.Validate.REQUIRED){Horn.Validate.onValid({data:[Horn.Validate,this]});return}else{this.formatVal()}}if(!d){h.showError(biz_func);d=false;this.err=true;return}}}else{this.formatVal()}if(h.calobj1.val()!=""&&!Horn.Util.Format.validateFmt(h.calobj1.val(),h.settings.format)){h.showError("日期格式不正确,格式为："+h.settings.format);c=false;this.err=true;return}if(h.calobj2.val()!=""&&!Horn.Util.Format.validateFmt(h.calobj2.val(),h.settings.format)){h.showError("日期格式不正确,格式为："+h.settings.format);c=false;this.err=true;return}if(h.calobj1&&(!h.compareDate(h.calobj1.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj1.getDate()))||h.calobj2&&(!h.compareDate(h.calobj2.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj2.getDate()))){if(!h.compareDate(h.calobj1.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj1.getDate())){h.inValidEle=h.cal1}else{if(h.calobj2&&(!h.compareDate(h.calobj2.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj2.getDate()))){h.inValidEle=h.cal2}}c=false;this.err=true;h.showError("日期不在有效区间");return}else{if(h.calobj1&&h.calobj1.isValid(h.calobj1.val(),h.settings.format)&&h.calobj2&&h.calobj2.isValid(h.calobj2.val(),h.settings.format)&&h.calobj1.getDate()&&h.calobj2.getDate()){if(h.calobj1.getDate()&&h.calobj2.getDate()&&!h.compareDate(h.calobj1.getDate(),h.calobj2.getDate())){c=false;this.err=true;h.inValidEle=h.cal1;h.showError("开始日期不能大于结束日期");return}}}if(c){this.err=false;h.removeError()}},getEventTarget:function(){return this.el.find("input:text")},_formatDate:function(a){a=a||"";if(a.indexOf("/")==-1&&a.indexOf("-")==-1&&a.length>=8){return a.substring(0,4)+"/"+a.substring(4,6)+"/"+a.substring(6)}return a.replace(/-/g,"/")},compareDate:function(b,a){b=this._formatDate(b);a=this._formatDate(a);if(!Date.parse(b)||!Date.parse(a)){return true}return Date.parse(b)<=Date.parse(a)},setValue:function(b){var a=this;this.cal1.val(b[this.name1]);this.hidden1.val(b[this.name1]);this.cal2.val(b[this.name2]);this.hidden2.val(b[this.name2]);this.formatVal();this.valideDateFormat()},getValue:function(){var d=this;var b=this.get();var c="";var a;$.each(b,function(e,f){a=$(f).val();if(a){a=Horn.Util.Format.date(a,d.settings.format)}c+=","+a});if(c==",,"){return""}return c.indexOf(",")==0?c.substring(1):c},showError:function(b){var a=this.cal1;var d=this.cal2;a.removeClass("m-verify-success");a.addClass("m-verify-error");d.removeClass("m-verify-success");d.addClass("m-verify-error");b=$.type(b)=="boolean"?"校验错误":b;if(!this.msgDiv){this.msgDiv=$('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">'+b+"</div>");c.css("display","block");this.err=true},removeError:function(){var a=this.cal1;var e=this.cal2;a.removeClass("m-verify-error");e.removeClass("m-verify-error");var c=this.get();var b=a.attr(Horn.Validate.CHECK);if(b){if(this.isValid){if(a.val()!=""||e.val()!=""){a.addClass("m-verify-success");e.addClass("m-verify-success")}}}this.err=false;var d=this.msgDiv;if(d){d.remove()}delete this.msgDiv},addRule:function(g){var d=this.cal1;var b=this.cal2;var c=d.attr(Horn.Validate.CHECK);if(c){if(c.indexOf(g)>-1){return}c+=Horn.Validate.CHECKSEP+g}else{c=g}d.attr(Horn.Validate.CHECK,c);b.attr(Horn.Validate.CHECK,c);if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var a=this.el.parent().parent(".g-unit-wrap");var e=$("label",a);var f=$("span.m-verify-symbol",e);if(!f.length){f=$("<span>",{"class":"m-verify-symbol",html:"*"});e.prepend(f)}else{f.html("*")}}this.removeError();this.field.removeClass("m-verify-success")},removeRule:function(e){var c=this.cal1;var a=this.cal2;var b=c.attr(Horn.Validate.CHECK);if(b&&b.indexOf(e)>-1){var d=b.split(Horn.Validate.CHECKSEP);d=$.grep(d,function(g,f){return g&&g!=e});c.attr(Horn.Validate.CHECK,d.join(";"));a.attr(Horn.Validate.CHECK,d.join(";"));this.removeError();this.setNotRequired()}},mutiName:function(){return[this.name1,this.name2]},validate:function(){if(this.disabled){return}var a=true;var c=this;var f=this;if(c.params.disabled&&c.params.disabled==true){return true}var h=this.cal1.attr("check");var h=this.cal1.attr("check");if(h&&h.indexOf(Horn.Validate.REQUIRED)>-1){if(f.calobj1.val()==""||f.calobj2.val()==""){f.showError("当前输入不能为空");vaid=false;this.err=true;return}}var k=Horn.Validate;var e=this.cal1;var m=k.getRules.call(k,e);if(h&&h.length>0&&!this.params.config){var j=h.split(";");var b="";for(var d=0;d<j.length;d++){var o=j[d];o=o.replace("(","").replace(")","");var g=function(){};if(o!=""&&o!="Horn.Validate.validateFmt"&&o!=Horn.Validate.REQUIRED){Horn.Validate.onValid({data:[Horn.Validate,this]});return}}}var n=this.calobj1.getDate();var l=this.calobj2.getDate();if(this.tmpValide!=undefined&&this.tmpValide!=""){if(!this.tmpValide){c.showError(this.tmpValide);a=false}}else{if(this.msgDiv!=null){a=false}}if(f.calobj1.val()!=""){if(!Horn.Util.Format.validateFmt(f.calobj1.val(),f.settings.format)){a=false;this.err=true;f.showError("日期格式不正确，格式为："+f.settings.format);return}}else{if(f.calobj1&&(!f.compareDate(f.calobj1.getDate(),f.maxDate)||!f.compareDate(f.minDate,f.calobj1.getDate()))||f.calobj2&&(!f.compareDate(f.calobj2.getDate(),f.maxDate)||!f.compareDate(f.minDate,f.calobj2.getDate()))){a=false;this.err=true;f.showError("日期不在有效区间");return}else{if(f.calobj1&&f.calobj1.isValid(f.calobj1.val(),f.settings.format)&&f.calobj2&&f.calobj2.isValid(f.calobj2.val(),f.settings.format)&&f.calobj1.getDate()&&f.calobj2.getDate()){if(f.calobj1.getDate()&&f.calobj2.getDate()&&!f.compareDate(f.calobj1.getDate(),f.calobj2.getDate())){a=false;this.err=true;f.showError("开始日期不能大于结束日期");return}}else{f.removeError();this.err=false;a=true}}}if(f.calobj2.val()!=""){if(!Horn.Util.Format.validateFmt(f.calobj2.val(),f.settings.format)){a=false;this.err=true;f.showError("日期格式不正确，格式为："+f.settings.format);return}}else{if(f.calobj1&&(!f.compareDate(f.calobj1.getDate(),f.maxDate)||!f.compareDate(f.minDate,f.calobj1.getDate()))||f.calobj2&&(!f.compareDate(f.calobj2.getDate(),f.maxDate)||!f.compareDate(f.minDate,f.calobj2.getDate()))){if(!f.compareDate(f.calobj1.getDate(),f.maxDate)||!f.compareDate(f.minDate,f.calobj1.getDate())){f.inValidEle=f.cal1}else{if(f.calobj2&&(!f.compareDate(f.calobj2.getDate(),f.maxDate)||!f.compareDate(f.minDate,f.calobj2.getDate()))){f.inValidEle=f.cal2}}f.showError("日期不在有效区间");return}else{if(f.calobj1&&f.calobj1.isValid(f.calobj1.val(),f.settings.format)&&f.calobj2&&f.calobj2.isValid(f.calobj2.val(),f.settings.format)&&f.calobj1.getDate()&&f.calobj2.getDate()){if(f.calobj1.getDate()&&f.calobj2.getDate()&&!f.compareDate(f.calobj1.getDate(),f.calobj2.getDate())){f.inValidEle=f.cal1;f.showError("开始日期不能大于结束日期");return}}else{f.removeError();this.err=false;a=true}}}if(!a){this.err=true}c.formatVal()},setEnable:function(a){if(a){this.cal1.removeAttr("disabled");this.cal2.removeAttr("disabled");this.hidden1.removeAttr("disabled");this.hidden2.removeAttr("disabled")}else{this.cal1.attr("disabled","disabled");this.cal2.attr("disabled","disabled");this.hidden1.attr("disabled","disabled");this.hidden2.attr("disabled","disabled")}},reset:function(a){this.hidden1.val(a?"":this.defHiddenValue1);this.hidden2.val(a?"":this.defHiddenValue2);var c=a?"":this.defValue1||this.defHiddenValue1;var b=a?"":this.defValue2||this.defHiddenValue2;var d={};d[this.name1]=c;d[this.name2]=b;this.setValue(d);this.validate()},clearValue:function(){this.hidden1.val("");this.hidden2.val("");this.cal1.val("");this.cal2.val("");this.validate()},getInValidEle:function(){return this.inValidEle},setReadonly:function(a){Horn.Calendar.superclass.setReadonly.apply(this,arguments);if(this.readonly){this.cal1.unbind("click").datetimepicker("remove");this.cal2.unbind("click").datetimepicker("remove")}else{this.cal1.evented=undefined;this.cal2.evented=undefined}}});Horn.Field.regFieldType("div.hc_calendargroup",Horn.CalendarGroup);
Horn.Checkbox=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Checkbox",checkbox:null,init:function(){Horn.Checkbox.superclass.init.apply(this,arguments);this.checkbox=this.el.find("input:checkbox")},getEventTarget:function(){return this.el.find("input:checkbox")},initEvents:function(){var b=this;var a=b.el.find("input:checkbox[check*=required]");if(a&&a.size()>0){this.checkRegx=$(a[0]).attr("check").split(";");a.each(function(c,d){$(d).bind("click",function(){var e=b.el.children("div").children("label").find("input:checkbox[checked]");var f=$(this).get(0).checked;if(f){b.removeError()}else{b.showError()}})})}},showError:function(){var b=this;if(!this.msgDiv){this.msgDiv=$('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var a=this.msgDiv;a.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">当前复选框不能为空</div>');a.css("display","block");b.el.addClass("m-verify-error");b.el.removeClass("m-verify-success");b.err=true},removeError:function(){var b=this;b.el.removeClass("m-verify-error");b.el.addClass("m-verify-success");b.err=false;var a=this.msgDiv;if(a){a.remove()}delete this.msgDiv},setValue:function(a){if(this.checkbox.get(0)){this.checkbox.get(0).checked=!!a}if(a&&$.type(a)!="boolean"){this.setStaticValue(a)}this.checkbox.val(a)},setStaticValue:function(a){this.checkbox.val(a)},validate:function(){if(this.disabled){return}var c=this;var a=this.el.find("input:checkbox[check*=required]");if(a&&a.size()>0){if(c.disabled===true){c.err=false;return}var b=this.checkbox.get(0).checked;if(!b){c.err=true;c.showError("该选项不能为空")}else{c.err=false;c.removeError()}}},getValue:function(){return this.checkbox.val()}});Horn.Field.regFieldType("div.hc_checkbox",Horn.Checkbox);
(function(a,b){a.CheckboxGroup=a.extend(Horn.Field,{COMPONENT_CLASS:"CheckboxGroup",checkboxs:null,init:function(){Horn.CheckboxGroup.superclass.init.apply(this,arguments);var f=this;this.name=this.el.attr("name");this.alias=this.el.attr("alias")||"";var e=this.el.children("div").children("label").find("input:checkbox");if(e.length>0){var c=e.first().attr("group");if(c){var d=c.split(";");b(d).each(function(g,h){f.checkGroup[h]=true})}}this.checkboxs={};this.el.children("div").children("label").find("input:checkbox").each(function(g,h){var i=b(h);var j=i.val();f.checkboxs[j]=i}).click(function(){if(b(this).prop("checked")){b(this).attr("checked",true)}else{b(this).attr("checked",false)}var g=b(this).attr(Horn.Validate.CHECK);if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var h=f.el.children("div").children("label").find("input:checkbox[checked]");if(h&&h.size()>0){f.removeError()}else{f.showError()}}});if(this.params.value){this.setValue(this.params.value)}if(this.params.readonly){this.setReadonly(true)}if(this.params.disabled){this.setDisabled(true)}this.defValue=this.params.defValue||this.params.value||""},getEventTarget:function(){return this.el.children("div").children("label").find("input:checkbox")},setValue:function(e){var d=this;if(!b.isArray(e)){e=e.toString().split(",")}for(var c in d.checkboxs){d.checkboxs[c].prop("checked",false)}b(e).each(function(f,g){var h=d.checkboxs[g];if(h){h.prop("checked",true)}});this.validate()},getValue:function(){var c="";this.el.children("div").children("label").find("input:checkbox").each(function(d,g){var f=b(g).attr("value");var e=b(g).prop("checked");if(e){if(d!=0){c+=","}c+=f}});return c},reset:function(){this.setValue(this.defValue)},clearValue:function(){this.setValue("")},setEnable:function(c){var d=this;this.el.children("div").children("label").find("input:checkbox").each(function(e,f){if(c===false){b(f).attr("disabled","disabled")}else{b(f).removeAttr("disabled")}})},setDisabled:function(c){if(c===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(c){var d=this;this.el.children("div").children("label").find("input:checkbox").each(function(e,f){if(c===false){d.readonly=false;b(f).removeAttr("onclick");b(f).bind("click",function(){setTimeout(function(){var g=b(f).attr(Horn.Validate.CHECK);if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var h=d.el.children("div").children("label").find("input:checkbox[checked]");if(h&&h.size()>0){d.removeError()}else{d.showError()}}},10)})}else{d.readonly=true;if(d.el.children("div").children("label").find("input:checkbox[checked]").length==0){b(f).unbind("click")}b(f).get(0).onclick=function(){return false}}})},validate:function(){if(this.disabled){return}if(!this.skipValid&&this.checkRegx&&this.checkRegx.length>0){var d=this;if(d.disabled===true){d.err=false;return}var c=this.el.children("div").children("label").find("input:checkbox[checked]");if(c&&c.size()<1){Horn.Validate.addError(d,Horn.Validate.regexEnum.requiredMessage)}else{Horn.Validate.removeError(d)}}},showError:function(){var d=this;if(!this.msgDiv){this.msgDiv=b('<div class="m-verify-tip bottom" role="m-verify-tip" style="display: none;"></div>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html('<div class="verify-tip-arrow"></div><div class="verify-tip-inner">当前复选框不能为空</div>');c.css("display","block");d.el.addClass("m-verify-error");d.el.removeClass("m-verify-success");d.err=true},removeError:function(){var e=this;e.el.removeClass("m-verify-error");e.el.addClass("m-verify-success");e.err=false;var d=this.msgDiv;if(d){d.remove()}var c=this.el.parent().parent(".g-unit-wrap").children(".unit-label");delete this.msgDiv},addRule:function(g){if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var h=this;var d=h.el.children("div").children("label").find("input:checkbox[check*=required]");if(d&&d.size()>0){return}else{h.err=true;this.checkRegx=g.split(";");var c=h.el.children("div").children("label").find("input:checkbox");c.each(function(i,k){var j=b(k).attr(Horn.Validate.CHECK);if(j){if(j.indexOf(g)>-1){return}j+=Horn.Validate.CHECKSEP+g}else{j=g}b(k).attr(Horn.Validate.CHECK,j)});if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var e=this.el.parent().parent(".g-unit-wrap").children(".unit-label");var f=b("span.m-verify-symbol",e);if(!f.length){f=b("<span>",{"class":"m-verify-symbol",html:"*"});e.prepend(f)}else{f.html("*")}}}}else{return}},removeRule:function(f){var h=this;var c=h.el.children("div").children("label").find("input:checkbox");c.each(function(i,l){var j=b(l).attr(Horn.Validate.CHECK);if(j&&j.indexOf(f)>-1){var k=j.split(Horn.Validate.CHECKSEP);k=b.grep(k,function(n,m){return n&&n!=f});b(l).attr(Horn.Validate.CHECK,k.join(";"))}b(l).unbind("click")});this.checkRegx=[];if(f&&f.indexOf(Horn.Validate.REQUIRED)>-1){this.el.removeClass("m-verify-success");this.el.removeClass("m-verify-error");var d=this.el.parent().parent(".g-unit-wrap").children(".unit-label");var e=b("span.m-verify-symbol",d);if(e){e.remove()}var g=this.msgDiv;if(g){g.remove()}}}});a.Field.regFieldType("div.hc_checkbox-group",a.CheckboxGroup)})(Horn,jQuery);
(function(c){var d={windowWidth:function(){return b()?document.documentElement.clientWidth:window.innerWidth},windowHeight:function(){return b()?document.documentElement.clientHeight:window.innerHeight},scrollTop:function(){return b()?document.documentElement.scrollTop:window.pageYOffset},scrollLeft:function(){return b()?document.documentElement.scrollLeft:window.pageXOffset}};function b(){var e=false;if(navigator.appName=="Microsoft Internet Explorer"){e=true}else{if(navigator.appName=="Netscape"){e=true}}return e}function a(f){f=f||window.event;if("getSelection" in window){window.getSelection().removeAllRanges()}else{try{document.selection.empty()}catch(f){}}if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}}c.fn.drag=function(f){var e=c.extend({handle:null,beforedrag:function(h,g){},ondraging:function(h,g){},enddrag:function(h,g){},unselectClass:"unselect",xdrag:true,ydrag:true},f);return this.each(function(){var q=c(this),o=this,l=e.handle===null?q:q.find(e.handle),g={x:0,y:0},h={x:0,y:0},r=false,k=false;function j(s){s=s||window.event;return{x:(function(){return s.clientX+d.scrollLeft()})(),y:(function(){return s.clientY+d.scrollTop()})()}}function n(){return{x:(function(){return q.css("left")==="auto"?0:parseInt(q.css("left"))})(),y:(function(){return q.css("top")==="auto"?0:parseInt(q.css("top"))})()}}function m(u){u=u||window.event;a(u);if(r){k=true;var t=j(u);var s={};if(e.xdrag===true){s.left=t.x-g.x+h.x+"px"}if(e.ydrag===true){s.top=t.y-g.y+h.y+"px"}q.css(s);e.ondraging(n(),q)}}function i(s){s=s||window.event;r=false;c(document).unbind("mousemove",m);c(document).unbind("selectstart",m);if(k){e.enddrag(n(),q);k=false}}function p(){l.mousedown(function(s){s=s||window.event;r=true;if(c(this).attr("_ismaxed")){return}h=n();g=j(s);e.beforedrag(h,q);c(document).bind("mousemove",m).bind("mouseup",i);c(document).bind("selectstart",m)})}p()})}})(jQuery);
Horn.emptyFn=function(){};(function(d){var b=["DOMMouseScroll","mousewheel"];if(d.event.fixHooks){for(var a=b.length;a;){d.event.fixHooks[b[--a]]=d.event.mouseHooks}}d.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=b.length;e;){this.addEventListener(b[--e],c,false)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var e=b.length;e;){this.removeEventListener(b[--e],c,false)}}else{this.onmousewheel=null}}};d.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}});function c(i){var h=i||window.event,g=[].slice.call(arguments,1),j=0,f=0,e=0;i=d.event.fix(h);i.type="mousewheel";if(h.wheelDelta){j=h.wheelDelta/120}if(h.detail){j=-h.detail/3}e=j;if(h.axis!==undefined&&h.axis===h.HORIZONTAL_AXIS){e=0;f=-1*j}if(h.wheelDeltaY!==undefined){e=h.wheelDeltaY/120}if(h.wheelDeltaX!==undefined){f=-1*h.wheelDeltaX/120}g.unshift(i,j,f,e);return(d.event.dispatch||d.event.handle).apply(this,g)}})(jQuery);Horn.Window=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Window",defConf:{closeable:true,backClickCloseable:false,title:"窗口",width:500,minWidth:250,maxWidth:1000,height:500,minHeight:300,maxHeight:600,scroll:false,isAuto:false},config:{},el:null,isShow:false,backdrop:null,wrapper:null,content:null,header:null,buttonBar:null,beforeClose:null,afterClose:null,beforeCloseFn:function(){return true},afterCloseFn:function(){},init:function(d){Horn.Window.superclass.init.apply(this,arguments);var c=$(d);this.el=c;var f=this;this.config={};this.config=$.extend(this.config,this.defConf);var a=true;if(this.params){$.extend(this.config,this.params||{});if(!isNaN(this.el.attr("h_width"))){this.config.width=this.el.attr("h_width")}else{if(typeof this.el.attr("h_width")=="string"){this.config.width=parseInt(this.el.attr("h_width"))}}if(this.config.width<this.defConf.minWidth){this.config.width=this.defConf.minWidth}if(!isNaN(this.el.attr("h_height"))){this.config.height=this.el.attr("h_height")}else{if(typeof this.el.attr("h_height")=="string"){this.config.height=parseInt(this.el.attr("h_height"))}}if(typeof this.config.closeable=="string"){if(this.config.closeable=="true"){this.config.closeable=true}else{if(this.config.closeable=="false"){this.config.closeable=false}else{this.config.closeable=this.defConf.closeable}}}if(typeof this.config.closeable!="boolean"){this.config.closeable=this.defConf.closeable}if(this.config.beforeClose){this.beforeClose=this.config.beforeClose;var i=Horn.Util.getFunObj(this.beforeClose);if($.type(i.fn)=="function"){this.beforeCloseFn=i.fn}}if(this.config.afterClose){this.afterClose=this.config.afterClose;var e=Horn.Util.getFunObj(this.afterClose);if($.type(e.fn)=="function"){this.afterCloseFn=e.fn}}if(this.params.isDrag==false){a=false}}this.content=c.children(".h_floatdiv-con");this.header=c.children(".m-message-header").children(".h_floatdiv-title");this.buttonBar=c.children(".h_btndiv");if(this.buttonBar.length==0){this.buttonBar=undefined}if(this.buttonBar||true==this.config.scroll||"true"==this.config.scroll){this.config.scroll=true}this.backdrop=$("<div class='h_floatdiv-backdrop'></div>");var g=$("<div></div>");g.append(this.backdrop);g.append(this.el);this.wrapper=g;$(document.body).append(g);g.hide();if(this.config.width){c.css("width",this.config.width+"px")}if(this.config.height){c.css("height",this.config.height+"px")}var h=this.header.children("a");if(this.config.closeable){h.bind("click",function(){f.hide()})}else{h.hide()}if(this.config.autoShow){this.show()}if(this.config.backClickCloseable){this.backdrop.click(function(){f.hide()})}$(window).resize(function(){if(f.isShow&&!f.maximum){f.resize()}});if(a){var b=this.el.attr("id");this.windowDrag(b)}},windowDrag:function(h){$("#"+h).drag({handle:".mod_tt",beforedrag:function(k,i){currentDrag=i;flag=false;$("#opacitynode").remove();var j=i[0];k.x=g(j);k.y=e(j);i.before(b(j)).css({position:"absolute",left:k.x+"px",top:k.y+"px"})},ondraging:function(l,j){var k=null;if(k!=null){if(k!==ele){var i=$(k);i.after(b(k))}}else{}},enddrag:function(m,i){var k=i[0];var j=$("#opacitynode");i.css({position:""});var l=document.createDocumentFragment();l.appendChild(k);j.before(l);l=null;j.hide();flag=true},unselectClass:"unselect",xdrag:true,ydrag:true}).find(".mod_tt").css({cursor:"move"});var g=function(j){var i=0;while(j!==null){i+=j.offsetLeft;j=j.offsetParent}return i},e=function(j){var i=0;while(j!==null){i+=j.offsetTop;j=j.offsetParent}return i},b=function(k){var j=f("div");$(j).attr({id:"opacitynode"});var i=a?k.offsetHeight-2:k.offsetHeight;$(j).css({height:k.offsetHeight+"px",lineHeight:k.offsetHeight+"px"});return j};var d=function(j){var i=0;while(j!==null){i+=j.offsetLeft;j=j.offsetParent}return i},c=function(j){var i=0;while(j!==null){i+=j.offsetTop;j=j.offsetParent}return i},f=function(i){return document.createElement(i)},a=(function(i){return/msie 6/.test(i)})(navigator.userAgent.toLowerCase())},setMaximum:function(a){this.maximum=a},resize:function(j,r){var d=$(window),b=this.el,o=0,i=0;var e=$(".h-overflow-auto").scrollTop();if(e!=null&&e!=0){$(".h-overflow-auto").scrollTop(0)}var m=d.height();var c=d.width();var f=this.config.height;var l=this.config.width;if(j){l=j}if(r){f=r}var q=l;var g=f;o=m-f;i=c-l;if(o<38){o=38;g=m-38}if(i<38){i=38;q=c-38}var n=o/2+$(document).scrollTop();n=n-50;var s=i/2+$(document).scrollLeft();this.backdrop.css({top:$(document).scrollTop(),left:$(document).scrollLeft()});this.el.css({top:n,left:s});if(this.params.isAuto!=false){this.backdrop.css({height:$(window).height(),width:$(window).width()});var a=this.el.find(".h_floatdiv-con").outerHeight();var p=this.el.find(".h_floatdiv-con").width();var t=this.el.find(".h_floatdiv-title").outerHeight();var k=(this.params.scroll==true)?true:false;this.el.css({width:q,height:g});this.el.children("div.h_floatdiv-con").css({height:g-37})}},resetSizeWin:function(a,b){this.resize(a,b)},show:function(a){if(!$("body").hasClass("h-overflow-hidden")){}if(!$("html").hasClass("h-overflow-hidden")){$("html").addClass("h-overflow-hidden")}Horn.Window.getNextOpen();this.wrapper.show();this.resize();this.backdrop.css("width","100%").css("height",2000).css("z-index",Horn.Window.getNextZIndex());this.el.css({"z-index":Horn.Window.getNextZIndex()});this.el.show();this.isShow=true;var b=this.el.height()-this.header.outerHeight()+1;if(this.params.height){b=this.params.height-this.header.outerHeight()}if(this.buttonBar){b=b-this.buttonBar.outerHeight()}if(this.config.scroll){this.el.css("height","auto");this.content.css({padding:0,margin:0,border:0,height:b}).addClass("h-overflow-auto")}else{this.el.mousewheel(function(){return false});this.content.css({padding:0,margin:0,border:0,height:b}).addClass("h-overflow-hidden")}},hide:function(){if(this.beforeCloseFn.call()){if($("body").hasClass("h-overflow-hidden")){$("body").removeClass("h-overflow-hidden")}if($("html").hasClass("h-overflow-hidden")){$("html").removeClass("h-overflow-hidden")}this.wrapper.hide();this.isShow=false;this.afterCloseFn.call();if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX=top.Horn.Window.MAX_ZINDEX-2}else{Horn.Window.MAX_ZINDEX=Horn.Window.MAX_ZINDEX-2}}},setTitle:function(a){this.el.children(".m-message-header").children("h4").text(a);this.el.children(".m-message-header").children("h4").attr("title",a)}});$.extend(Horn.Window,{DATANAME:"h_window",MAX_ZINDEX:100,OPENED:0,getNextOpen:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.OPENED++}else{Horn.Window.OPENED++;return Horn.Window.OPENED}},getPrevOpen:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.OPENED--;return top.Horn.Window.OPENED}else{Horn.Window.OPENED--;return Horn.Window.OPENED}},getOpen:function(){if(top.Horn&&top.Horn.Window){return top.Horn.Window.OPENED}else{return Horn.Window.OPENED}},getNextZIndex:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX++;return top.Horn.Window.MAX_ZINDEX}else{Horn.Window.MAX_ZINDEX++;return Horn.Window.MAX_ZINDEX}},get:function(b){var a=Horn.data(Horn.Window.DATANAME);var c=a[b];return c}});Horn.regUI("div.h_floatdiv",Horn.Window);
Horn.Combox=Horn.extend(Horn.Select,{COMPONENT_CLASS:"Combox",pLabel:"",filterFlag:"",displayField:null,keyAttr:"label",pKeyAttr:"pkey",valueAttr:"value",defaultValue:"",defaultText:"",showLabel:true,init:function(e){Horn.Combox.superclass.init.apply(this,arguments);this.combInit();var d=this.el.find("input[ref]"),a=this.el.attr("keyfield"),b=this.el.attr("pkeyfield"),c=this.el.attr("titlefield");if(a){this.keyAttr=a}if(b){this.pkeyAttr=b}if(c){this.valueAttr=c}var f=this.params.dictName;if(f){this.field.attr("ref",f.split(",")[0]+(this.multipleline?"_m":"_s"))}this.displayField=d;this.defaultValue=this.params.value||this.hidden.val();if(this.params.readonly){this.setReadonly(true)}},combInit:function(){var a=this.hidden.attr("refname");if(a){this.field.bind("change",Horn.Util.apply(this.onCombChange,this))}},onCombChange:function(g,h){var b=this.hidden.attr("refname");var f=b.split(";");for(var c=0;c<f.length;c++){var d=f[c];if(d){var a=d.split(",");Horn.getComp(a[0],a[1]).filterByPLabel(this.hidden.val())}}},changeDict:function(b){var d=b;this.clearFliter();var f=Horn.getDict(d);var c=$('<div class="hc_checkboxdiv">');var a=$("<ul></ul>");var e=this;if((this.field.get(0)).getAttribute("multiple")=="true"){b+="_m";c.attr("multiple_line","true");$.each(f,function(g,j){if(e.params.showLabel){var h=$("<li title="+j+" key="+g+'><label><input type="checkbox" class="combox_input"><span class="hce_dictlabel" >'+g+":</span>"+j+"</label></li>")}else{var h=$("<li title="+j+" key="+g+'><label><input type="checkbox" class="combox_input">'+j+"</label></li>")}a.append(h)})}else{b+="_s";c.attr("multiple_line","false");$.each(f,function(g,j){if(e.params.showLabel){var h=$("<li title="+j+" key="+g+'><label><span class="hce_dictlabel" >'+g+":</span>"+j+"</label></li>")}else{var h=$("<li title="+j+" key="+g+"><label>"+j+"</label></li>")}a.append(h)})}c.append(a);this.field.attr("ref",b);this.listEl=c;this.multipleline=this.listEl.attr("multiple_line")=="true";if((this.field.get(0)).getAttribute("multiple")=="true"){this.field.val("")}else{this.field.val("请选择...")}this.hidden.val("")},selectFirst:function(){if(this.listEl&&this.listEl.length==0){this.listEl=this.field.parent().find("div.hc_checkboxdiv")}var a=this.listEl.children("ul").children("li[key]");var c="";var d="";for(var b=0;b<a.length;b++){if($(a.get(b)).css("display")!="none"){c=$(a.get(b)).attr("key");d=jQuery.trim($(a.get(b)).text());if(c!=""){break}}}this.setValue({key:c,text:d},true)},getPos:function(){return{left:0,top:0}},hideAllList:function(){var a=this.listEl;$("div.hc_checkboxdiv").each(function(b,c){if(a.get(0)!=c){$(c).hide();$(c).data("show_name","")}})},showList:function(d,c){var b=d.prev();var a=b.data("filter");if(a){this[a.name].apply(this,a.params)}else{this.clearFliter(b)}Horn.Combox.superclass.showList.apply(this,arguments)},filterByPLabel:function(a){if(this.pLabel!=a){this.reset(true);this.pLabel=a;this.hidden.data("filter",{name:"_filterByPLabel",params:arguments})}},_filterByPLabel:function(c,a){if(!c){return false}var b=this.listEl.children("ul");b.children("li[key][pKey!='"+c+"']").css("display","none");b.children("li[key][pKey='"+c+"']").css("display","block");if(this.defaultValue){this.setValue(this.defaultValue)}else{if(!(a===false)&&(!this.multipleline)){this.selectFirst()}else{this.setValue("")}}},filter:function(g,a,c){this.clearFliter();var e={name:"_filter",params:arguments};var d=this.hidden.data("filter");if(e!=d){this.hidden.data("filter",e);if(c){this.field.trigger("change",e)}}var h=this.hidden.val();var b=this;if(h){this._filter(g,a);setTimeout(function(){$(h.split(",")).each(function(f,i){if(b.listEl.children("ul").children("li[key="+i+"]").css("display")=="none"){b.reset(true)}})},200)}else{this._filter(g,a);setTimeout(function(){b.setValue("")},200)}},_filter:function(e,b){b=!!b;var d="block",c="none";if(b){d="none";c="block"}if(this.listEl&&this.listEl.length==0){this.listEl=this.field.parent().find("div.hc_checkboxdiv")}var a=this.listEl.children("ul").children("li[key]");a.css("display",d);var g=",";if($.type(e)=="string"){e+=g}a.each(function(h,j){var f=$(j);var i=f.attr("key");if($.type(e)=="function"){if(e.call(this,i)){f.css("display",c)}}else{if($.type(e)=="array"){if(jQuery.inArray(i,e)>=0){f.css("display",c)}}else{if($.type(e)=="string"){if(e.indexOf(i+g)>-1){f.css("display",c)}}}}})},clearFliter:function(){if(this.listEl&&this.listEl.length==0){this.listEl=this.field.parent().find("div.hc_checkboxdiv")}this.listEl.children("ul").children("li[key]").css("display","block");this.hidden.data("filter",null)},clearList:function(){if(this.listEl&&this.listEl.length==0){this.listEl=this.field.parent().find("div.hc_checkboxdiv")}this.reset(true);this.listEl.children("ul").children("li[key]").remove()},addItems:function(b,a){this.addDatas(b,a)},addDatas:function(w,q){var v=[],j=this.listEl,a=this.keyAttr,g=this.valueAttr,u=this.showLabel;var p=this.hidden;var b=this.field;var n=this;if(j&&j.length==0){j=this.field.parent().find("div.hc_checkboxdiv")}var c={inputEl:this.field,listEl:j};if(jQuery.type(w)=="array"){v=w}else{if(jQuery.type(w)=="object"){if(jQuery.isPlainObject(w)){if(jQuery.isEmptyObject(w)){return}v.push(w)}}else{if(q===true){this.clearList()}return}}if(q===true){this.clearList()}if(v.length>0){var k=j.children("ul");var d=(j.attr("multiple_line")=="true");$.each(v,function(y,A){var z=A[a],B=A[g];if(!z){z=A.code;B=A.text}if(z){var i=k.children("li[key='"+z+"']");if(i.length==0){var i=$("<li key='"+z+"' title='"+B+"'></li>");var x=$("<label></label>");x.text((u?z+":":"")+B);if(d){x.prepend('<input type="checkbox" class="combox_input"/>')}i.append(x);k.append(i);if(j.data("show_name")==p.attr("name")){i.bind("click.li",c,Horn.Util.apply(n.listClick,n))}}}})}var e=n.params.value;var h=p.attr("value");var l=b.val();var s=",";if(n.params.delimiter){s=n.params.delimiter}var t=h;var r=l;var m=[];if(e&&e!=""){m=e.split(",")}var f=[];for(var o=0;o<m.length;o++){e=m[o];if(b.attr("selectMode")){if(b.attr("selectMode")=="true"){$.each(v,function(x,y){if(r.indexOf(y.text)<0){if(y.code==e){if(!f.Contains(y.code)){f.push(y.code)}r=r+(r?s:"")+y.text}}})}else{$.each(v,function(x,y){if(y.code==e){t=y.code;r=y.text}})}}else{$.each(v,function(x,y){if(y.code==e){t=y.code;r=y.text}})}}this.setValue(t);b.val(r)},showError:function(){Horn.Combox.superclass.showError.apply(this,arguments);var a=this.msgDiv}});Horn.Field.regFieldType("div.hc_combox",Horn.Combox);Array.prototype.Contains=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return true}}return false};
var expandfirst=false;Horn.ZtreePanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"ZtreePanel",el:null,url:null,params:{},treedata:null,beforeClick:function(){return true},onClick:function(){},onExpand:function(){},check:false,chkStyle:"checkbox",init:function(g){Horn.ZtreePanel.superclass.init.apply(this,arguments);Horn.apply(this,this.params);this.treeEl=this.el.find(".ztree");var k=this;if(this.el.attr("treeclick")){var l=this.el.attr("treeclick");if(l){l=window[l]}this.onClick=l}else{if(this.params.onClick){this.onClick=window[this.params.onClick]}}if(this.el.attr("beforetreeclick")){var l=this.el.attr("beforetreeclick");if(l){l=window[l]}this.beforeClick=l}else{if(this.params.beforeClick){this.beforeClick=window[this.params.beforeClick]}}if(this.el.attr("reRenderFn")){var l=this.el.attr("reRenderFn");if(l){l=window[l]}this.reRender=l}if(this.el.attr("onExpand")){var l=this.el.attr("onExpand");if(l){l=window[l]}this.onExpand=l}var d=false;if(this.params.async&&this.params.async==true){d=true}var o={data:{simpleData:{enable:true}},view:{nameIsHTML:true,showLine:false,showIcon:true,showTitle:true,selectedMulti:true,dblClickExpand:true,addDiyDom:function(r,q){var p="_a";var s=$("#"+q.tId+p);k.reRender(q,s)},fontCss:this.getFontCss},async:{enable:d,url:this.params.url?this.params.url:"",autoParam:this.params.otherParam?this.params.otherParam:[],otherParam:this.params.otherParam?this.params.otherParam:{},type:this.params.type?this.params.type:"post",dataFilter:this.params.dataFilter?window[this.params.dataFilter]:null},callback:{beforeClick:this.beforeClick,beforeCheck:this.params.beforeCheck?window[this.params.beforeCheck]:null,beforeAsync:this.params.beforeAsync?window[this.params.beforeAsync]:null,onAsyncSuccess:this.params.onAsyncSuccess?window[this.params.onAsyncSuccess]:this.onAsyncSuccess,onAsyncError:this.params.onAsyncError?window[this.params.onAsyncError]:null,beforeCollapse:this.params.beforeCollapse?window[this.params.beforeCollapse]:null,beforeDblClick:this.params.beforeDblClick?window[this.params.beforeDblClick]:null,beforeDrag:this.params.beforeDrag?window[this.params.beforeDrag]:null,beforeDragOpen:this.params.beforeDragOpen?window[this.params.beforeDragOpen]:null,beforeDrop:this.params.beforeDrop?window[this.params.beforeDrop]:null,beforeEditName:this.params.beforeEditName?window[this.params.beforeEditName]:null,beforeExpand:this.params.beforeExpand?window[this.params.beforeExpand]:null,beforeMouseDown:this.params.beforeMouseDown?window[this.params.beforeMouseDown]:null,beforeMouseUp:this.params.beforeMouseUp?window[this.params.beforeMouseUp]:null,beforeRemove:this.params.beforeRemove?window[this.params.beforeRemove]:null,beforeRename:this.params.beforeRename?window[this.params.beforeRename]:null,beforeRightClick:this.params.beforeRightClick?window[this.params.beforeRightClick]:null,onCheck:this.params.onCheck?window[this.params.onCheck]:null,onCollapse:this.params.onCollapse?window[this.params.onCollapse]:null,onDblClick:this.params.onDblClick?window[this.params.onDblClick]:null,onDrag:this.params.onDrag?window[this.params.onDrag]:null,onDragMove:this.params.onDragMove?window[this.params.onDragMove]:null,onExpand:this.params.onExpand?window[this.params.onExpand]:this.onExpand,onMouseDown:this.params.onMouseDown?window[this.params.onMouseDown]:null,onMouseUp:this.params.onMouseUp?window[this.params.onMouseUp]:null,onNodeCreated:this.params.onNodeCreated?window[this.params.onNodeCreated]:null,onRemove:this.params.onRemove?window[this.params.onRemove]:null,onRename:this.params.onRename?window[this.params.onRename]:null,onRightClick:this.params.onRightClick?window[this.params.onRightClick]:null,onClick:this.onClick}};var n=this.el.attr("checkMode");if(n&&n=="checkbox"){o.check={enable:true,chkStyle:n}}var h=this.el.attr("items");if(h){h=$.parseJSON(h)}else{h=[]}var c=this.treeEl;var f=this.treeEl.attr("id");if(!f){f=Horn.id();this.treeEl.attr("id",f)}if(d){$.fn.zTree.init(c,o)}else{$.fn.zTree.init(c,o,h)}this.treedata=h;this.treeObj=$.fn.zTree.getZTreeObj(f);if(this.el.attr("expandfirst")){expandfirst=true;this.treeObj.expandAll(true)}var b=this.el.attr("name");var e=this.el.parent().parent().find("#expand_"+b);var m=this.el.parent().parent().find("#unexpand_"+b);var a=this.el.parent().parent().find("#refresh_"+b);var j=this.el.parent().parent().find("#search_"+b);var i=this;e.bind("click",function(q){var p=i.getCheckedNodes(true);if(p!=null&&p.length>0){$.each(p,function(r,s){i.treeObj.expandNode(s.getParentNode(),true)})}else{i.expandAll(true)}});m.bind("click",function(q){var p=i.getCheckedNodes(true);if(p!=null&&p.length>0){$.each(p,function(r,s){i.treeObj.expandNode(s.getParentNode(),false)})}else{i.expandAll(false)}});a.bind("click",function(p){i.refresh()});j.bind("keyup",function(q){var p=i.getNodesByParamFuzzy("name",this.value,null);if(this.value!=""){$.each(p,function(r,s){s.highlight=true;i.treeObj.updateNode(s);i.treeObj.expandNode(s.getParentNode(),true)})}else{$.each(p,function(r,s){s.highlight=false;i.treeObj.updateNode(s)});i.expandAll(false)}this.focus()})},getFontCss:function(b,a){return(!!a.highlight)?{"font-weight":"bold"}:{color:"#333","font-weight":"normal"}},reRender:function(b,a){},onAsyncSuccess:function(b,d,c,e){if(expandfirst){var a=$.fn.zTree.getZTreeObj(d);a.expandAll(true)}},getTreeObj:function(){return this.treeObj},getNodes:function(){var a=this.treeObj.getNodes();return a},addNodes:function(a,c,b,d){this.treeObj.addNodes(a,c,b,d)},cancelEditName:function(a){this.treeObj.cancelEditName(a)},cancelSelectedNode:function(a){this.treeObj.cancelSelectedNode(a)},checkAllNodes:function(a){this.treeObj.checkAllNodes(a)},checkNode:function(c,b,d,a){this.treeObj.checkNode(c,b,d,a)},copyNode:function(c,b,a,d){this.treeObj.copyNode(c,b,a,d)},destroy:function(){this.treeObj.destroy()},editName:function(a){this.treeObj.editName(a)},expandAll:function(a){this.treeObj.expandAll(a)},expandNode:function(d,e,c,a,b){this.treeObj.expandNode(d,e,c,a,b)},getChangeCheckedNodes:function(){return this.treeObj.getChangeCheckedNodes()},getCheckedNodes:function(a){return this.treeObj.getCheckedNodes(a)},getNodesByParam:function(b,c,a){return this.treeObj.getNodeByParam(b,c,a)},getNodesByParamFuzzy:function(b,c,a){return this.treeObj.getNodesByParamFuzzy(b,c,a)},getSelectedNodes:function(){return this.treeObj.getSelectedNodes()},hideNode:function(a){this.treeObj.hideNode(a)},hideNodes:function(a){this.treeObj.hideNodes(a)},moveNode:function(c,b,a,d){return this.treeObj.moveNode(c,b,a,d)},reAsyncChildNodes:function(a,b,c){this.treeObj.reAsyncChildNodes(a,b,c)},refresh:function(){this.treeObj.refresh()},removeChildNodes:function(a){this.treeObj.removeChildNodes(a)},removeNode:function(b,a){this.treeObj.removeNode(b,a)},selectNode:function(b,a,c){this.treeObj.selectNode(b,a,c)},setChkDisabled:function(b,a,c,d){this.treeObj.setChkDisabled(b,a,c,d)},setEditable:function(a){this.treeObj.setEditable(a)},showNode:function(a){this.treeObj.showNode(a)},showNodes:function(a){this.treeObj.showNodes(a)},transformToArray:function(a){return this.treeObj.transformToArray(a)},transformTozTreeNodes:function(a){return this.treeObj.transformToArray(a)},updateNode:function(a,b){this.treeObj.updateNode(a,b)},getCheckedNodes:function(){return this.treeObj.getCheckedNodes()}});Horn.regUI("div.h_ztree",Horn.ZtreePanel);function jresplusUIZtreeOnExpand(a,c,b){$("#"+c).children("li").children("ul").removeAttr("style")};
